<!DOCTYPE html>
<html>
<head>
    <title>Ingress Model Sandbox</title>
    <script src="../node_modules/gl-matrix/dist/gl-matrix.js"></script>
    <script src="../dist/ingress-model-viewer.js"></script>
    <style>
      html, body {
        height: 100%;
        width: 100%;
        position: relative;
        margin: 0;
      }
    </style>
</head>
<body>
<canvas id="screen" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0;"></canvas>
<div style="width: 100%; text-align: center; color: #ccc; position: fixed; top: 0;height: 50px; line-height: 50px"
     id="controls"></div>
<script type="text/javascript">
  var canvas = document.getElementById('screen'), engine;
  canvas.width = document.body.offsetWidth;
  canvas.height = document.body.offsetHeight;

  window.addEventListener('resize', function() {
    engine.resize(document.body.offsetWidth, document.body.offsetHeight);
  });

  var minifest = {
    "texture": {
      "FlipCardTexture": {
        "path": "scanner/genericModTexture.png",
        "minFilter": "Linear",
        "magFilter": "Linear",
        "wrapS": "ClampToEdge",
        "wrapT": "ClampToEdge"
      },
      "ObjectXMTexture": {
        "path": "scanner/objectXMTexture.tga",
        "minFilter": "MipMapLinearLinear",
        "magFilter": "Linear",
        "wrapS": "Repeat",
        "wrapT": "Repeat"
      }
    },
    "mesh": {
      "InterestCapsuleMesh": {
        "path": "scanner/interestCapsuleResource.obj"
      },
      "CapsuleXmMesh": {
        "path": "scanner/capsuleResourceXM.obj"
      }
    },
    "rawProgram": {},
    "program": {
      "bicolor_textured": {
        "vertex": "shaders/bicolor_textured.glsl.vert",
        "fragment": "shaders/bicolor_textured.glsl.frag",
        "program": "Opaque"
      },
      "xm": {
        "vertex": "shaders/xm.glsl.vert",
        "fragment": "shaders/xm.glsl.frag",
        "program": "Opaque"
      }
    }
  };

  var init = function(assets) {
    engine = new IMV.Engine(canvas, assets);
    engine.preload(function() {
      engine.camera.setPosition([0.0, 6, 12]).lookAt([0, 0, 0]);
      engine.updateView();
      var parent = new IMV.Drawables.Drawable();
      var ic = new IMV.Drawables.Drawable();
      ic.addChild(new IMV.Drawables.Inventory.InterestCapsule());
      ic.addChild(new IMV.Drawables.Inventory.CapsuleXm());
      parent.addChild(ic);
      var anim = new IMV.Utilities.Animation(4000, rotate, IMV.Utilities.Ease.linear, true);
      anim.start();
      ic.addAnimation(anim);
      parent.addAnimation((new IMV.Utilities.Animation(4000, orbit, IMV.Utilities.Ease.linear, true)).start());
      var ic2 = new IMV.Drawables.Drawable();
      ic2.addChild(new IMV.Drawables.Inventory.InterestCapsule());
      ic2.addChild(new IMV.Drawables.Inventory.CapsuleXm());
      engine.objectRenderer.addDrawable(ic2);
      engine.objectRenderer.addDrawable(parent);
    });
  };

  var rotate = function(t, drawable) {
    var q = quat.create();
    quat.rotateY(q, q, t * Math.PI * 2);
    drawable.setRotation(q);
  };

  var orbit = function(t, drawable) {
    var t = vec3.fromValues(
      2 * Math.sin(t * Math.PI * 2),
      0,
      2 * Math.cos(t * Math.PI * 2)
    );
    drawable.setTranslation(t);
  };

  init(minifest);
  engine.render();

  var findConstant = function(gl, num)
  {
    for(var i in gl)
    {
      if(gl.hasOwnProperty(i) && gl[i] === num)
      {
        console.log(i);
      }
    }
  };

</script>
</body>
</html>
