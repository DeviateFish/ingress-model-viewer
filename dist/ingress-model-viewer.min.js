/*! ingress-model-viewer 18-02-2015 */

!function(a,b){"use strict";var c={};if(!JavaDeserializer||!glMatrix||!libtga)throw"Missing dependencies";var d=window.console||{log:function(){},warn:function(){},info:function(){}};!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var e={teamColors:{RESISTANCE:vec4.fromValues(0,.7607843137254902,1,1),ENLIGHTENED:vec4.fromValues(.1568627450980392,.9568627450980393,.1568627450980392,1),NEUTRAL:vec4.fromValues(.9764705882352941,.9764705882352941,.9764705882352941,1),LOKI:vec4.fromValues(1,.1568627450980392,.1568627450980392,1)},qualityColors:{EXTREMELY_RARE:vec4.fromValues(.9803921568627451,.39215686274509803,.39215686274509803,1),VERY_RARE:vec4.fromValues(.9568627450980393,.5215686274509804,.9254901960784314,1),MORE_RARE:vec4.fromValues(.7647058823529411,0,1,1),RARE:vec4.fromValues(.6666666666666666,.5372549019607843,.984313725490196,1),LESS_COMMON:vec4.fromValues(.45098039215686275,.6588235294117647,1,1),COMMON:vec4.fromValues(.5098039215686274,.9529411764705882,.7058823529411765,1),VERY_COMMON:vec4.fromValues(.6980392156862745,.6980392156862745,.6980392156862745,1),L1:vec4.fromValues(.996078431372549,.807843137254902,.35294117647058826,1),L2:vec4.fromValues(1,.6509803921568628,.18823529411764706,1),L3:vec4.fromValues(1,.45098039215686275,.08235294117647059,1),L4:vec4.fromValues(.8941176470588236,0,0,1),L5:vec4.fromValues(.9921568627450981,.1607843137254902,.5725490196078431,1),L6:vec4.fromValues(.9215686274509803,.14901960784313725,.803921568627451,1),L7:vec4.fromValues(.7568627450980392,.1411764705882353,.8784313725490196,1),L8:vec4.fromValues(.5882352941176471,.15294117647058825,.9568627450980393,1)},anomalyColors:{1:vec4.fromValues(1,.5686274509803921,.21176470588235294,1),2:vec4.fromValues(1,.3215686274509804,.9058823529411765,1),3:vec4.fromValues(.6196078431372549,.35294117647058826,1,1),4:vec4.fromValues(.8431372549019608,.27058823529411763,.27058823529411763,1),5:vec4.fromValues(1,.9450980392156862,0,1),6:vec4.fromValues(.6509803921568628,1,.9019607843137255,1),7:vec4.fromValues(.5725490196078431,.5803921568627451,.592156862745098,1)},artifactColors:{Helios:{RedGlow:vec4.fromValues(.92,.51,.14,1),PurpleGlow:vec4.fromValues(1,.87,.55,1),TargetGlow:vec4.fromValues(1,.72,0,1)},Amar:{TargetGlow:vec4.fromValues(.62,.22,.62,1),RedGlow:vec4.fromValues(.79,.11,.49,1),PurpleGlow:vec4.fromValues(.58,.17,1,1)},Jarvis:{TargetGlow:vec4.fromValues(.62,.22,.62,1),RedGlow:vec4.fromValues(.79,.11,.49,1),PurpleGlow:vec4.fromValues(.58,.17,1,1)}},xmColors:{coreGlow:vec4.fromValues(.92,.7,.89,1),coreGlowAlt:vec4.fromValues(.6,.4,.6,.8),coreGlowAda:vec4.fromValues(0,.7607843137254902,1,1),coreGlowJarvis:vec4.fromValues(.1568627450980392,.9568627450980393,.1568627450980392,1)},Mesh:{Inventory:{Xmp:"XmpMesh",XmpXm:"XmpXMMesh",Ultrastrike:"UltrastrikeMesh",UltrastrikeXm:"UltrastrikeXMMesh",ResShield:"ResShieldMesh",ResShieldXm:"ResShieldXMMesh",PowerCube:"PowerCubeMesh",PowerCubeXm:"PowerCubeXmMesh",LinkAmp:"LinkAmpMesh",LinkAmpXm:"LinkAmpXmMesh",HeatSink:"HeatSinkMesh",HeatSinkXm:"HeatSinkXmMesh",MultiHack:"MultiHackMesh",MultiHackXm:"MultiHackXmMesh",ForceAmp:"ForceAmpMesh",ForceAmpXm:"ForceAmpXmMesh",Turret:"TurretMesh",TurretXm:"TurretXmMesh",FlipCardAda:"FlipCardMeshAda",FlipCardJarvis:"FlipCardMeshJarvis",FlipCardXm:"FlipCardXmMesh",Resonator:"ResonatorMesh",ResonatorXm:"ResonatorXMMesh",Capsule:"CapsuleMesh",CapsuleXm:"CapsuleXmMesh",ExtraShield:"ExtraShieldMesh",MediaCube:"MediaCubeMesh",MediaPlaneMesh:"MediaPlaneMesh"},Resource:{Xmp:"XmpResourceUnitMesh",PortalKeyResourceUnit:"PortalKeyResourceUnit",Ultrastrike:"UltrastrikeResourceUnitMesh",PowerCube:"PowerCubeResourceUnitMesh",LinkAmp:"LinkAmpResourceUnitMesh",HeatSink:"HeatSinkResourceUnitMesh",MultiHack:"MultiHackResourceUnitMesh",ForceAmp:"ForceAmpResourceUnitMesh",Turret:"TurretResourceUnitMesh",FlipCardAda:"FlipCardResourceUnitMeshAda",FlipCardJarvis:"FlipCardResourceUnitMeshJarvis",Resonator:"ResonatorResourceUnitMesh",PortalShield:"PortalShieldResourceUnitMesh",Capsule:"CapsuleResourceUnitMesh",ExtraShield:"ExtraShieldResourceUnitMesh"},Player:{Player:"PlayerMesh",PlayerEdge:"PlayerMeshEdge",PlayerReflection:"PlayerMeshReflection",PlayerGlow:"PlayerMeshGlow",BreadCrumb:"BreadCrumbMesh",Compass:"CompassMesh"},Ornament:{MeetupPoint:"OrnamentMeetupPointMesh",FinishPoint:"OrnamentFinishPointMesh",Cluster:"OrnamentClusterMesh",Volatile:"OrnamentVolatileMesh"},Artifact:{Helios:{Helios1:"Helios1",HeliosFrozen1:"HeliosFrozen1",Helios2:"Helios2",HeliosFrozen2:"HeliosFrozen2",Helios3:"Helios3",HeliosFrozen3:"HeliosFrozen3",Helios4:"Helios4",HeliosFrozen4:"HeliosFrozen4",Helios5:"Helios5",HeliosFrozen5:"HeliosFrozen5",Helios6:"Helios6",HeliosFrozen6:"HeliosFrozen6",Helios7:"Helios7",HeliosFrozen7:"HeliosFrozen7",Helios8:"Helios8",HeliosFrozen8:"HeliosFrozen8",Helios9:"Helios9",HeliosFrozen9:"HeliosFrozen9",Helios10:"Helios10",HeliosFrozen10:"HeliosFrozen10",Helios11:"Helios11",HeliosFrozen11:"HeliosFrozen11",Helios12:"Helios12",HeliosFrozen12:"HeliosFrozen12",Helios13:"Helios13",HeliosFrozen13:"HeliosFrozen13",Helios14:"Helios14",HeliosFrozen14:"HeliosFrozen14",Helios15:"Helios15",HeliosFrozen15:"HeliosFrozen15",Helios16:"Helios16",HeliosFrozen16:"HeliosFrozen16",Helios17:"Helios17",HeliosFrozen17:"HeliosFrozen17",Helios18:"Helios18",HeliosFrozen18:"HeliosFrozen18",Helios19:"Helios19",HeliosFrozen19:"HeliosFrozen19",Helios20:"Helios20",HeliosFrozen20:"HeliosFrozen20",Helios21:"Helios21",HeliosFrozen21:"HeliosFrozen21",Helios22:"Helios22",HeliosFrozen22:"HeliosFrozen22",Helios23:"Helios23",HeliosFrozen23:"HeliosFrozen23",Helios24:"Helios24",HeliosFrozen24:"HeliosFrozen24",Helios25:"Helios25",HeliosFrozen25:"HeliosFrozen25",Helios26:"Helios26",HeliosFrozen26:"HeliosFrozen26",Helios27:"Helios27",HeliosFrozen27:"HeliosFrozen27",Helios28:"Helios28",HeliosFrozen28:"HeliosFrozen28",Helios29:"Helios29",HeliosFrozen29:"HeliosFrozen29",Helios30:"Helios30",HeliosFrozen30:"HeliosFrozen30",Helios31:"Helios31",HeliosFrozen31:"HeliosFrozen31",Helios32:"Helios32",HeliosFrozen32:"HeliosFrozen32",Helios33:"Helios33",HeliosFrozen33:"HeliosFrozen33",Helios34:"Helios34",HeliosFrozen34:"HeliosFrozen34",Helios35:"Helios35",HeliosFrozen35:"HeliosFrozen35",Helios36:"Helios36",HeliosFrozen36:"HeliosFrozen36",Helios37:"Helios37",HeliosFrozen37:"HeliosFrozen37",Helios38:"Helios38",HeliosFrozen38:"HeliosFrozen38",Helios39:"Helios39",HeliosFrozen39:"HeliosFrozen39",Helios40:"Helios40",HeliosFrozen40:"HeliosFrozen40"},Amar:{Amar1:"Amar1",AmarFrozen1:"AmarFrozen1",Amar2:"Amar2",AmarFrozen2:"AmarFrozen2",Amar3:"Amar3",AmarFrozen3:"AmarFrozen3",Amar4:"Amar4",AmarFrozen4:"AmarFrozen4",Amar5:"Amar5",AmarFrozen5:"AmarFrozen5",Amar6:"Amar6",AmarFrozen6:"AmarFrozen6",Amar7:"Amar7",AmarFrozen7:"AmarFrozen7",Amar8:"Amar8",AmarFrozen8:"AmarFrozen8",Amar9:"Amar9",AmarFrozen9:"AmarFrozen9",Amar10:"Amar10",AmarFrozen10:"AmarFrozen10",Amar11:"Amar11",AmarFrozen11:"AmarFrozen11",Amar12:"Amar12",AmarFrozen12:"AmarFrozen12",Amar13:"Amar13",AmarFrozen13:"AmarFrozen13",Amar14:"Amar14",AmarFrozen14:"AmarFrozen14",Amar15:"Amar15",AmarFrozen15:"AmarFrozen15",Amar16:"Amar16",AmarFrozen16:"AmarFrozen16",Amar17:"Amar17",AmarFrozen17:"AmarFrozen17"},Jarvis:{Jarvis1:"Jarvis1",Jarvis2:"Jarvis2",Jarvis3:"Jarvis3",Jarvis4:"Jarvis4",Jarvis5:"Jarvis5",Jarvis6:"Jarvis6",Jarvis7:"Jarvis7",Jarvis8:"Jarvis8",Jarvis9:"Jarvis9",Jarvis10:"Jarvis10",Jarvis11:"Jarvis11",Jarvis12:"Jarvis12",Jarvis13:"Jarvis13"}},World:{Shield:"PortalShieldMesh",Portal:"TexturedPortalMesh",Waypoint:"TexturedScannerFTMesh",Resonator:"ResonatorUnitLowResMesh",XmpRing:"XmpRingMesh",UltraStrikeRing:"UltraStrikeRingMesh",UltraStrikeColumn:"UltraStrikeColumnMesh",ArtifactsRedGlow:"ArtifactsRedGlow",ArtifactsGreenGlow:"ArtifactsGreenGlow",ArtifactsPurpleGlow:"ArtifactsPurpleGlow",ArtifactsTargetGlow:"ArtifactsTargetGlow",SingleResonator:"SingleResonatorMesh"}},Program:{Bicolored:"bicolor_textured",Textured:"textured",Glowramp:"portal_scanner",Xm:"xm",ShieldEffect:"shield"},Texture:{FlipCard:"FlipCardTexture",Xm:"ObjectXMTexture",Glowramp:"GlowrampTexture",Media:"MediaCubeTexture",Waypoint:"FtWaypointTexture",ShieldEffect:"PortalShieldTexture",MediaCube:"MediaCubeTexture",ColorGlow:"ColorGlowTexture",TargetGlow:"TargetGlowTexture",ArtifactHelios:"ArtifactHeliosTexture",ArtifactAmar:"ArtifactAmarTexture",ArtifactJarvis:"ArtifactJarvisTexture"}};c.Constants=e;var f=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a};c.Utilities=c.Utilities||{},c.Utilities.inherits=f;var g=function(a,b,c){if("image"===b||"image.co"===b)if(/\.tga$/.test(a))libtga.loadFile(a,function(a,b){if(a)return void c(a,null);var d=document.createElement("canvas"),e=d.getContext("2d"),f=e.createImageData(b.width,b.height);f.data.set(b.imageData),d.height=b.height,d.width=b.width,e.putImageData(f,0,0);var g=new Image;g.onload=function(){c(null,this)},g.onerror=function(a){c(a,null)},g.src=d.toDataURL()});else{var d=new Image;"image.co"===b&&(d.crossOrigin="anoymous"),d.onload=function(){c(null,this)},d.onerror=function(a){c(a,null)},d.src=a}else{var e=new XMLHttpRequest;e.open("GET",a),e.responseType=b,e.onload=function(){c(null,this.response)},e.onerror=function(a){c(a,null)},e.send()}},h=function(){var a={},c={};this.loadAsset=function(b,d,e){var f="_"+encodeURIComponent(b);return c[f]?void e(null,c[f]):(a[f]=a[f]||[],a[f].push(e),void(c.hasOwnProperty(f)||(c[f]=!1,g(b,d,function(b,d){b||(c[f]=d);for(var e;e=a[f].shift();)e(b,d)}))))},this.loadAssetGroup=function(a,c,d){if(a.length!==c.length)throw"Incompatible types: types.length = "+c.length+"; urls.length = "+a.length;for(var e=a.length,f=new Array(e),g=function(a,b,c){if(b)return void d(b,null);f[a]=c;var g,h=!0;for(g=0;e>g;g++)h=h&&f[g];h&&d(null,f)},h=0;h<a.length;h++)this.loadAsset(a[h],c[h],g.bind(b,h))},this.getAsset=function(a){return c[a]}};c.AssetLoader=h,c.Utilities=c.Utilities||{},c.Utilities.loadResource=g;var i=function(a){this._gl=a};c.GLBound=i;var j=function(a,b,c){i.call(this,a),this.info=b;var d={MipMapLinearLinear:a.LINEAR_MIPMAP_LINEAR,Linear:a.LINEAR,MipMapLinearNearest:a.LINEAR_MIPMAP_NEAREST,MipMapNearestLinear:a.NEAREST_MIPMAP_LINEAR,Repeat:a.REPEAT,ClampToEdge:a.CLAMP_TO_EDGE},e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d[b.minFilter]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d[b.magFilter]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d[b.wrapS]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d[b.wrapT]),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),/MipMap/.test(b.minFilter)&&a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null),this.texture=e};j.prototype.use=function(a){var b=this._gl;a=a||0,b.bindTexture(b.TEXTURE_2D,this.texture),b.activeTexture(b.TEXTURE0+a)},c.Texture=j;var k=function(a,b){this.name=a,this.size=b};c.VertexAttribute=k;var l=function(a,b,c){i.call(this,a),this.attributes=b,this.values=c,this.glBuf=this.size=this.count=null};f(l,i),l.prototype.init=function(){var a=this._gl;this.glBuf=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.glBuf),a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.values),a.STATIC_DRAW),this.size=0;for(var b,c=0,e=0;e<this.attributes.length;e++)b=this.attributes[e],this.size+=4*b.size,c+=b.size;this.values.length%c!==0&&d.warn("values array length is not an even multiple of the total size of the attributes"),this.count=Math.floor(this.values.length/c)},l.prototype.draw=function(a){var b,c=this._gl,d=0;this.glBuf||this.init(),c.bindBuffer(c.ARRAY_BUFFER,this.glBuf);for(var e=0;e<this.attributes.length;e++)b=this.attributes[e],b.name in a&&(c.enableVertexAttribArray(a[b.name]),c.vertexAttribPointer(a[b.name],b.size,c.FLOAT,!1,this.size,d),d+=4*b.size)},c.AttributeBuffer=l;var m=function(a,b,c,d){i.call(this,a),this.attributes=new l(a,c,b),this.faces=d,this.indexBuf=null};f(m,i),m.prototype.init=function(){var a=this._gl;this.attributes.init(),this.indexBuf=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuf),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.faces),a.STATIC_DRAW)},m.prototype.draw=function(a){var b=this._gl;this.indexBuf||this.init(),this.attributes.draw(a),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuf),b.drawElements(b.TRIANGLES,this.faces.length,b.UNSIGNED_SHORT,0)},c.Mesh=m;var n=function(){var a=function(a){var b,c,e,f,g,h=new DataView(a),i=0,j=h.getUint32(i);i+=4;for(var l=[],m=0;j>m;m++){for(b=h.getUint32(i),1!=b&&16!=b&&d.warn("unknown type "+b),i+=4,c=h.getUint32(i),i+=4,e=h.getUint16(i),i+=2,g="",f=0;e>f;f++)g+=String.fromCharCode(h.getUint8(i+f));i+=e,l.push(new k(g,c))}return l},b=function(b,c){var d=new JavaDeserializer(c),e=d.getStream(),f=e.getContents(),g=f[0].contents.toArray(),h=f[3].contents.toArray(),i=a(h),j=f[1].contents.toArray();m.call(this,b,g,i,j)};return f(b,m),b}(),o=function(){var a=function(a){if(/precision mediump float/g.test(a))return a;var b=a.split("\n");return b.splice(1,0,"#ifdef GL_ES","precision mediump float;","#endif"),b.join("\n")},b=function(a,b,c,d){var e,f,g=c.name,h=a.getUniformLocation(b,g),i=c.type,j=!1,k=!0;if(c.size>1&&d)switch(i){case a.FLOAT:e=a.uniform1fv,f=Float32Array,k=!1;break;case a.INT:case a.BOOL:case a.SAMPLER_2D:case a.SAMPLER_CUBE:e=a.uniform1iv,f=Uint16Array,k=!1}if(k)switch(i){case a.FLOAT:e=a.uniform1f;break;case a.FLOAT_VEC2:e=a.uniform2fv,f=d?Float32Array:new Float32Array(2);break;case a.FLOAT_VEC3:e=a.uniform3fv,f=d?Float32Array:new Float32Array(3);break;case a.FLOAT_VEC4:e=a.uniform4fv,f=d?Float32Array:new Float32Array(4);break;case a.INT:case a.BOOL:case a.SAMPLER_2D:case a.SAMPLER_CUBE:e=a.uniform1i;break;case a.INT_VEC2:case a.BOOL_VEC2:e=a.uniform2iv,f=d?Uint16Array:new Uint16Array(2);break;case a.INT_VEC3:case a.BOOL_VEC3:e=a.uniform3iv,f=d?Uint16Array:new Uint16Array(3);break;case a.INT_VEC4:case a.BOOL_VEC4:e=a.uniform4iv,f=d?Uint16Array:new Uint16Array(4);break;case a.FLOAT_MAT2:j=!0,e=a.uniformMatrix2fv;break;case a.FLOAT_MAT3:j=!0,e=a.uniformMatrix3fv;break;case a.FLOAT_MAT4:j=!0,e=a.uniformMatrix4fv}if(e.bind)e=e.bind(a);else{var l=e;e=function(){l.apply(a,arguments)}}return d&&f?function(a){e(h,new f(a))}:j?function(a){e(h,!1,a)}:f?function(a){f.set(a.toFloat32Array?a.toFloat32Array():a),e(h,f)}:function(a){e(h,a)}},c=function(b,c,d){i.call(this,b),this.program=null,this.vertexSource=a(c),this.fragmentSource=d,this.attributes={},this.uniforms={}};return f(c,i),c.prototype.setupLocations=function(){for(var a,c,d=this._gl,e=this.program,f=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES),g=0;f>g;g++)a=d.getActiveAttrib(e,g),this.attributes[a.name]=d.getAttribLocation(e,a.name);for(f=d.getProgramParameter(e,d.ACTIVE_UNIFORMS),g=0;f>g;g++)a=d.getActiveUniform(e,g),c=a.name,c="]"==c[c.length-1]?c.substr(0,c.length-3):c,this.uniforms[c]=b(d,e,a,a.name!=c)},c.prototype.init=function(){var a,b,c=this._gl;if(a=c.createShader(c.VERTEX_SHADER),c.shaderSource(a,this.vertexSource),c.compileShader(a),!c.getShaderParameter(a,c.COMPILE_STATUS))throw d.warn(c.getShaderInfoLog(a)),d.error("could not compile vertex shader: "+this.vertexSource),"Vertex shader compile error!";if(b=c.createShader(c.FRAGMENT_SHADER),c.shaderSource(b,this.fragmentSource),c.compileShader(b),!c.getShaderParameter(b,c.COMPILE_STATUS))throw d.warn(c.getShaderInfoLog(b)),d.error("could not compile fragment shader: "+this.fragmentSource),"Fragment shader compile error!";if(this.program=c.createProgram(),c.attachShader(this.program,a),c.attachShader(this.program,b),c.linkProgram(this.program),!c.getProgramParameter(this.program,c.LINK_STATUS))throw"Could not link program";c.useProgram(this.program),this.setupLocations()},c.prototype.use=function(a){var b=this._gl;this.program?b.useProgram(this.program):this.init(),a(this.attributes,this.uniforms)},c}();c.Program=o;var p=function(){var a=function(a,b,c){o.call(this,a,b,c)};return f(a,o),a.prototype.use=function(a){this.program||this.init();var b=this._gl;b.useProgram(this.program),b.enable(b.DEPTH_TEST),b.enable(b.CULL_FACE),b.frontFace(b.CCW),b.cullFace(b.BACK),b.depthMask(!0),a(this.attributes,this.uniforms)},a}();c.Programs=c.Programs||{},c.Programs.Opaque=p;var q=function(){var a=function(a,b,c){o.call(this,a,b,c)};return f(a,o),a.prototype.use=function(a){this.program||this.init();var b=this._gl;b.useProgram(this.program),b.disable(b.CULL_FACE),b.enable(b.BLEND),b.depthMask(!1),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.SRC_ALPHA,b.ONE),a(this.attributes,this.uniforms)},a}();c.Programs=c.Programs||{},c.Programs.Glowramp=q;var r=function(a){this.programName=a,this.program=null,this.uniforms={},this.drawfn=null,this.elapsed=0,this.ready=!1};r.prototype.init=function(a){return this.program=a.getProgram(this.programName),this.program?(this.ready=!0,!0):(d.warn("missing program "+this.programName),!1)},r.prototype.setDrawFn=function(a){this.drawfn=a},r.prototype.draw=function(){return this.ready?void this.program.use(this.drawfn):(d.warn("drawable is not initialized"),!1)},r.prototype.setUniform=function(a,b){this.uniforms[a]=b},r.prototype.updateTime=function(a){return this.elapsed+=a,this.onUpdate?this.onUpdate(a,this.elapsed):!0},c.Drawable=r;var s=function(){var a=function(a,b){for(var c in this.uniforms)this.uniforms.hasOwnProperty(c)&&c in b&&b[c](this.uniforms[c]);this.mesh.draw(a)},b=function(b,c){r.call(this,b),this.meshName=c,this.mesh=null,this.drawfn=a.bind(this)};return f(b,r),b.prototype.init=function(a){return this.mesh=a.getMesh(this.meshName),this.mesh?r.prototype.init.call(this,a):(d.warn("missing mesh "+this.meshName),!1)},b}();c.MeshDrawable=s;var t=function(){var a=function(a,b){s.call(this,a,b),this.viewProject=mat4.create(),this.model=mat4.create()};return f(a,s),a.prototype.updateMatrix=function(){var a=mat4.create();mat4.multiply(a,this.viewProject,this.model),this.uniforms.u_modelViewProject=a},a.prototype.updateView=function(a){this.viewProject=a,this.updateMatrix()},a.prototype.setMatrix=function(a){this.model=a,this.updateMatrix()},a}();c.Drawables=c.Drawables||{},c.Drawables.Model=t;var u=function(a,b,c){t.call(this,a,b),this.textureName=c,this.texture=null};f(u,t),u.prototype.draw=function(){this.texture.use(0),this.uniforms.u_texture=0,t.prototype.draw.call(this)},u.prototype.init=function(a){return this.texture=a.getTexture(this.textureName),this.texture?t.prototype.init.call(this,a):(d.warn("missing texture "+this.textureName),!1)},c.Drawables=c.Drawables||{},c.Drawables.Textured=u;var v=function(){var a=c.Constants.Program.Bicolored,b=vec4.clone(e.qualityColors.VERY_RARE),d=vec4.clone(e.xmColors.coreGlow),g=function(c,e){u.call(this,a,c,e),this.uniforms.u_color0=vec4.clone(b),this.uniforms.u_color1=vec4.clone(d)};return f(g,u),g}();c.Drawables=c.Drawables||{},c.Drawables.Bicolored=v;var w=function(){var a=c.Constants.Program.Glowramp,b=vec4.clone(c.Constants.teamColors.NEUTRAL),d=function(c,d){u.call(this,a,c,d),this.uniforms.u_baseColor=vec4.clone(b),this.uniforms.u_rotation=0,this.uniforms.u_rampTarget=0,this.uniforms.u_alpha=.6};return f(d,u),d.prototype.updateTime=function(a){var b=t.prototype.updateTime.call(this,a),c=this.elapsed/5e3;return this.uniforms.u_rotation=c,this.uniforms.u_rampTarget=Math.sin(Math.PI/2*(c-Math.floor(c))),this.uniforms.u_alpha=.05*Math.sin(c)+.75,b},d}();c.Drawables=c.Drawables||{},c.Drawables.Glowramp=w;var x=function(){var a=c.Constants.Program.Xm,b=vec4.clone(e.xmColors.coreGlow),d=vec4.clone(e.xmColors.coreGlowAlt),g=function(c,e,f){u.call(this,a,c,e),this.uniforms.u_elapsedTime=0,this.uniforms.u_teamColor=vec4.clone(f||b),this.uniforms.u_altColor=vec4.clone(d)};return f(g,u),g.prototype.updateTime=function(a){var b=s.prototype.updateTime.call(this,a);return this.uniforms.u_elapsedTime=this.elapsed/1e3%300*.1,b},g}();c.Drawables=c.Drawables||{},c.Drawables.Xm=x;var y=function(){var a=c.Constants.Program.ShieldEffect,b=vec4.clone(c.Constants.teamColors.NEUTRAL),d=vec2.fromValues(.5,1.3),e=vec3.fromValues(.5,.5,.5),g=function(c,f){u.call(this,a,c,f),this.uniforms.u_color=vec4.clone(b),this.uniforms.u_rampTargetInvWidth=vec2.clone(d),this.uniforms.u_contributionsAndAlpha=vec3.clone(e)};return f(g,u),g.prototype.updateTime=function(a){var b=t.prototype.updateTime.call(this,a),c=this.elapsed/1e4;return this.uniforms.u_rampTargetInvWidth[0]=-2*(c-Math.floor(c))+1,this.uniforms.u_rampTargetInvWidth[1]=2*(c-Math.floor(c)),b},g}();c.Drawables=c.Drawables||{},c.Drawables.ShieldEffect=y,function(){var a=c.Constants.Mesh.Inventory,b=c.Constants.Texture;c.Drawables=c.Drawables||{},c.Drawables.Inventory=c.Drawables.Inventory||{};var d=function(c){var d=function(){v.call(this,a[c],b.FlipCard)};return f(d,v),d},e=function(c){var d=function(){x.call(this,a[c],b.Xm)};return f(d,x),d},g=function(b){var d=function(){u.call(this,c.Constants.Program.Textured,a[b],c.Constants.Texture.MediaCube)};return f(d,u),d};for(var h in a)if(/^Media/.test(h)){if("MediaPlane"===h)continue;c.Drawables.Inventory[h]=g(h)}else c.Drawables.Inventory[h]=/Xm$/.test(h)?e(h):d(h)}(),function(){var a=c.Constants.Mesh.Resource;c.Drawables=c.Drawables||{},c.Drawables.Resource=c.Drawables.Resource||{};var b=function(b){var d=function(){v.call(this,a[b],c.Constants.Texture.FlipCard)};f(d,v),c.Drawables.Resource[b]=d};for(var d in a)b(d)}(),function(){var a=c.Constants.Mesh.World,b=c.Constants.Texture;c.Drawables=c.Drawables||{},c.Drawables.World=c.Drawables.World||{};var d=function(){w.call(this,a.Portal,b.Glowramp)};f(d,w),c.Drawables.World.Portal=d;var e=function(){y.call(this,a.Shield,b.ShieldEffect)};f(e,y),c.Drawables.World.Shield=e;var g=function(){w.call(this,a.Waypoint,b.Waypoint)};f(g,w),c.Drawables.World.Waypoint=g;var h=function(){v.call(this,a.Resonator,b.FlipCard)};f(h,v),c.Drawables.World.Resonator=h;var i=function(){w.call(this,a.ArtifactsRedGlow,b.ColorGlow)};f(i,w),c.Drawables.World.ArtifactsRedGlow=i;var j=function(){w.call(this,a.ArtifactsGreenGlow,b.ColorGlow)};f(j,w),c.Drawables.World.ArtifactsGreenGlow=j;var k=function(){w.call(this,a.ArtifactsPurpleGlow,b.ColorGlow)};f(k,w),c.Drawables.World.ArtifactsPurpleGlow=k;var l=function(){w.call(this,a.ArtifactsTargetGlow,b.TargetGlow)};f(l,w),c.Drawables.World.ArtifactsTargetGlow=l}(),function(){var a,b,d=c.Constants.Mesh.Artifact,e=c.Constants.Texture;c.Drawables=c.Drawables||{},c.Drawables.Artifact=c.Drawables.Artifact||{};var g=function(a,b){var d=function(){u.call(this,c.Constants.Program.Textured,b,e["Artifact"+a])};return f(d,u),d};for(a in d){var h=d[a];c.Drawables.Artifact[a]=c.Drawables.Artifact[a]||{};for(b in h)c.Drawables.Artifact[a][b]=g(a,b)}}();var z=function(){var a=function(a,b){i.call(this,a),this.manifest=b,this.loader=new h,this.textures={},this.meshes={},this.programs={},this.queues={texture:[],mesh:[],program:[]},this.path="/assets/"};f(a,i),a.prototype.handleTexture=function(a,b,c,e,f){if(e)throw this.queues.texture[a]=-1,d.error(e),"Could not load "+b;this.textures[b]=new j(this._gl,c,f),this.queues.texture[a]=1,d.info("loaded texture "+b)},a.prototype.handleMesh=function(a,b,c,e,f){if(e)throw this.queues.mesh[a]=-1,d.error(e),"Could not load "+b;this.meshes[b]=new n(this._gl,f),this.queues.mesh[a]=1,d.info("loaded mesh "+b)},a.prototype.handleProgram=function(a,b,e,f,g){if(f)throw this.queues.program[a]=-1,d.error(f),"Could not load "+b;var h=o;e.program in c.Programs&&(h=c.Programs[e.program]),this.programs[b]=new h(this._gl,g[0],g[1]),this.queues.program[a]=1,d.info("loaded program "+b)},a.prototype.getTexture=function(a){return this.textures[a]},a.prototype.getMesh=function(a){return this.meshes[a]},a.prototype.getProgram=function(a){return this.programs[a]},a.prototype.loadAll=function(){var a,b,c=this.manifest;for(a in c.texture)!c.texture.hasOwnProperty(a)||a in this.textures||(this.textures[a]=null,b=c.texture[a],this.loader.loadAsset(this.path+b.path,"image",this.handleTexture.bind(this,this.queues.texture.length,a,b)),this.queues.texture.push(0));for(a in c.mesh)!c.mesh.hasOwnProperty(a)||a in this.meshes||(this.meshes[a]=null,b=c.mesh[a],this.loader.loadAsset(this.path+b.path,"arraybuffer",this.handleMesh.bind(this,this.queues.mesh.length,a,b)),this.queues.mesh.push(0));for(a in c.program)!c.program.hasOwnProperty(a)||a in this.programs||(this.programs[a]=null,b=c.program[a],this.loader.loadAssetGroup([this.path+b.vertex,this.path+b.fragment],["text","text"],this.handleProgram.bind(this,this.queues.program.length,a,b)),this.queues.program.push(0));return this.getStatus.bind(this)};var b=function(a,b){return 0===b&&a++,a},e=function(a,b){return b>0&&a++,a},g=function(a,b){return 0>b&&a++,a},k=function(a){return{total:a.length,loading:a.reduce(b,0),loaded:a.reduce(e,0),error:a.reduce(g,0)}};return a.prototype.getStatus=function(){return{textures:k(this.queues.texture),meshes:k(this.queues.meshes),programs:k(this.queues.programs)}},a}();c.AssetManager=z;var A=function(a,b){i.call(this,a),this.manager=b,this.viewProject=mat4.create(),this.elapsed=0};f(A,i),A.prototype.updateView=function(a,b){mat4.multiply(this.viewProject,b,a)},A.prototype.render=function(){d.warn("base class renders nothing.")},A.prototype.updateTime=function(a){this.elapsed+=a},c.Renderer=A;var B=function(a,b){A.call(this,a,b),this.drawables=[]};f(B,A),B.prototype.addDrawable=function(a){if(!a instanceof r)throw"Drawables must always inherit from the base Drawable";return a.init(this.manager)?(a.updateView&&a.updateView(this.viewProject),void this.drawables.push(a)):(d.warn("could not initialize drawable: ",a),!1)},B.prototype.removeDrawable=function(a){for(var b=0;b<this.drawables.length;b++)if(this.drawables[b]===a)return void this.drawables.splice(b,1)},B.prototype.addEntity=function(a){for(var b in a.drawables)this.addDrawable(a.drawables[b])},B.prototype.updateView=function(a,b){A.prototype.updateView.call(this,a,b);var c,d=this.drawables.length;for(c=0;d>c;c++)this.drawables[c].updateView&&this.drawables[c].updateView(this.viewProject,a,b)},B.prototype.render=function(){var a,b=this.drawables.length;for(a=0;b>a;a++)this.drawables[a].draw()},B.prototype.updateTime=function(a){A.prototype.updateTime.call(this,a);var b,c=this.drawables.length;for(b=0;c>b;b++)this.drawables[b].updateTime(a)||(this.drawables.splice(b,1),b--,c--)},c.Renderers=c.Renderers||{},c.Renderers.Object=B;var C=function(a,b){A.call(this,a,b),this.portals=[],this.links=null,this.particles=null};f(C,A),C.prototype.updateView=function(a,b){A.prototype.updateView.call(this,a,b);var c,d=this.portals.length;for(c=0;d>c;c++)this.portals[c].updateView(this.viewProject,a,b)},C.prototype.render=function(){var a,b=this.portals.length;for(a=0;b>a;a++)this.portals[a].draw()},C.prototype.updateTime=function(a){A.prototype.updateTime.call(this,a);var b,c=this.portals.length;for(b=0;c>b;b++)this.portals[b].updateTime(a)||(this.portals.splice(b,1),b--,c--)},c.Renderers=c.Renderers||{},c.Renderers.Portal=C;var D=function(){this.drawables={},this.transform=mat4.create()};D.prototype.addDrawable=function(a,b){this.drawables[a]=b},D.prototype.removeDrawable=function(){},D.prototype.applyTransform=function(){for(var a in this.drawables)this.drawables[a].setMatrix(this.transform)},D.prototype.translate=function(a){mat4.translate(this.transform,this.transform,a),this.applyTransform()},D.prototype.rotate=function(a){var b=mat4.create();mat4.fromQuat(b,a),mat4.multiply(this.transform,this.transform,b),this.applyTransform()},D.prototype.setAnimation=function(a){for(var b in this.drawables)this.drawables[b].onUpdate=a},c.Entity=D,function(){c.Entities=c.Entities||{},c.Entities.Inventory=c.Entities.Inventory||{};var a={Xmp:"L8",Ultrastrike:"L8",ResShield:"VERY_RARE",PowerCube:"L8",LinkAmp:"EXTREMELY_RARE",HeatSink:"VERY_RARE",MultiHack:"VERY_RARE",ForceAmp:"RARE",Turret:"RARE",Resonator:"L8",Capsule:"RARE"},b=function(a,b){var d=function(){D.call(this),this.addDrawable(a,new c.Drawables.Inventory[a]),this.addDrawable(a+"Xm",new c.Drawables.Inventory[a+"Xm"]),this.drawables[a].uniforms.u_color0=vec4.clone(b)};return f(d,D),d};for(var d in a)c.Entities.Inventory[d]=b(d,c.Constants.qualityColors[a[d]]);var e=function(){D.call(this),this.addDrawable("FlipCardAda",new c.Drawables.Inventory.FlipCardAda),this.addDrawable("FlipCardXm",new c.Drawables.Inventory.FlipCardXm),this.drawables.FlipCardXm.uniforms.u_teamColor=vec4.clone(c.Constants.teamColors.RESISTANCE),this.drawables.FlipCardAda.uniforms.u_color1=vec4.clone(c.Constants.teamColors.RESISTANCE),this.drawables.FlipCardAda.uniforms.u_color0=vec4.clone(c.Constants.qualityColors.VERY_RARE)};f(e,D),c.Entities.Inventory.FlipCardAda=e;var g=function(){D.call(this),this.addDrawable("FlipCardJarvis",new c.Drawables.Inventory.FlipCardJarvis),this.addDrawable("FlipCardXm",new c.Drawables.Inventory.FlipCardXm),this.drawables.FlipCardXm.uniforms.u_teamColor=vec4.clone(c.Constants.teamColors.ENLIGHTENED),this.drawables.FlipCardJarvis.uniforms.u_color1=vec4.clone(c.Constants.teamColors.ENLIGHTENED),this.drawables.FlipCardJarvis.uniforms.u_color0=vec4.clone(c.Constants.qualityColors.VERY_RARE)};f(g,D),c.Entities.Inventory.FlipCardJarvis=g;var h=function(){D.call(this),this.addDrawable("ExtraShield",new c.Drawables.Inventory.ExtraShield),this.addDrawable("ResShieldXm",new c.Drawables.Inventory.ResShieldXm),this.drawables.ExtraShield.uniforms.u_color0=vec4.clone(c.Constants.qualityColors.VERY_RARE)};f(h,D),c.Entities.Inventory.ExtraShield=h}();var E=function(a,b){this.canvas=a;var c=a.getContext("webgl")||a.getContext("experimental-webgl");if(!c)throw"Could not initialize webgl";c.clearColor(0,0,0,1),this.gl=c,this.view=mat4.create(),mat4.lookAt(this.view,[0,4,10],[0,0,0],[0,1,0]),this.project=mat4.create(),this.assetManager=new z(this.gl,b),this.objectRenderer=new B(this.gl,this.assetManager),this.resize(a.width,a.height),this.start=this.last=null,this.paused=!1,this.cleared=!1,this.frame=null};E.prototype.resize=function(a,b){this.gl.viewport(0,0,a,b),mat4.perspective(this.project,45,a/b,.1,100),this.objectRenderer.updateView(this.view,this.project)},E.prototype.stop=function(){this.paused=!0,this.cleared=!1,this.frame&&window.cancelAnimationFrame(this.frame)},E.prototype.start=function(){this.resize(this.canvas.width,this.canvas.height),this.render(0)},E.prototype.demoEntities=function(){var a,b,e=-5,f=0,g=4;for(a in c.Entities.Inventory)b=new c.Entities.Inventory[a],b&&(b.translate(vec3.fromValues(e,f,g)),e++,e>5&&(e=-5,g--),this.objectRenderer.addEntity(b),d.log("added "+a))},E.prototype.demo=function(){var a,b,e,f=-5,g=0,h=4;for(a in c.Drawables.Inventory)e=new c.Drawables.Inventory[a],e&&(mat4.translate(e.model,e.model,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a));for(a in c.Drawables.Resource)e=new c.Drawables.Resource[a],e&&(mat4.translate(e.model,e.model,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a));for(a in c.Drawables.World)e=new c.Drawables.World[a],e&&(mat4.translate(e.model,e.model,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a));for(a in c.Drawables.Artifact)for(b in c.Drawables.Artifact[a])e=new c.Drawables.Artifact[a][b],e&&(mat4.translate(e.model,e.model,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a+": "+b))},E.prototype.render=function(a){if(this.paused)return this.cleared=!0,void(this.paused=!1);var b=0;this.start?(b=a-this.last,this.last=a):(this.start=a,this.last=a);var c=this.gl;c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.lineWidth(1),c.enable(c.CULL_FACE),c.frontFace(c.CCW),c.cullFace(c.BACK),c.enable(c.DEPTH_TEST),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.disable(c.BLEND),c.depthMask(!0),this.objectRenderer.render(),this.objectRenderer.updateTime(b),this.frame=window.requestAnimationFrame(this.render.bind(this))
},E.prototype.preload=function(){this.assetManager.load()},c.Engine=E,c.VERSION="0.12.0",a.IMV=c}(this);
//# sourceMappingURL=ingress-model-viewer.min.js.map