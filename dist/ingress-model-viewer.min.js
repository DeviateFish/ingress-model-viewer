/*! ingress-model-viewer 08-12-2014 */

!function(a,b){"use strict";if(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),!JavaDeserializer||!THREE||!libtga)throw"Missing dependencies";var c=c||{log:function(){},warn:function(){},info:function(){}},d={teamColors:{RESISTANCE:new THREE.Vector4(0,.7607843137254902,1,1),ENLIGHTENED:new THREE.Vector4(.1568627450980392,.9568627450980393,.1568627450980392,1),NEUTRAL:new THREE.Vector4(.9764705882352941,.9764705882352941,.9764705882352941,1),LOKI:new THREE.Vector4(1,.1568627450980392,.1568627450980392,1)},qualityColors:{EXTREMELY_RARE:new THREE.Vector4(.9803921568627451,.39215686274509803,.39215686274509803,1),VERY_RARE:new THREE.Vector4(.9568627450980393,.5215686274509804,.9254901960784314,1),MORE_RARE:new THREE.Vector4(.7647058823529411,0,1,1),RARE:new THREE.Vector4(.6666666666666666,.5372549019607843,.984313725490196,1),LESS_COMMON:new THREE.Vector4(.45098039215686275,.6588235294117647,1,1),COMMON:new THREE.Vector4(.5098039215686274,.9529411764705882,.7058823529411765,1),VERY_COMMON:new THREE.Vector4(.6980392156862745,.6980392156862745,.6980392156862745,1),L1:new THREE.Vector4(.996078431372549,.807843137254902,.35294117647058826,1),L2:new THREE.Vector4(1,.6509803921568628,.18823529411764706,1),L3:new THREE.Vector4(1,.45098039215686275,.08235294117647059,1),L4:new THREE.Vector4(.8941176470588236,0,0,1),L5:new THREE.Vector4(.9921568627450981,.1607843137254902,.5725490196078431,1),L6:new THREE.Vector4(.9215686274509803,.14901960784313725,.803921568627451,1),L7:new THREE.Vector4(.7568627450980392,.1411764705882353,.8784313725490196,1),L8:new THREE.Vector4(.5882352941176471,.15294117647058825,.9568627450980393,1)},anomalyColors:{1:new THREE.Vector4(1,.5686274509803921,.21176470588235294,1),2:new THREE.Vector4(1,.3215686274509804,.9058823529411765,1),3:new THREE.Vector4(.6196078431372549,.35294117647058826,1,1),4:new THREE.Vector4(.8431372549019608,.27058823529411763,.27058823529411763,1),5:new THREE.Vector4(1,.9450980392156862,0,1),6:new THREE.Vector4(.6509803921568628,1,.9019607843137255,1),7:new THREE.Vector4(.5725490196078431,.5803921568627451,.592156862745098,1)},artifactColors:{Helios:{artifactsRedGlow:new THREE.Vector4(.92,.51,.14,1),artifactsPurpleGlow:new THREE.Vector4(1,.87,.55,1),artifactTargetGlow:new THREE.Vector4(1,.72,0,1)},Amar:{artifactTargetGlow:new THREE.Vector4(.62,.22,.62,1),artifactsRedGlow:new THREE.Vector4(.79,.11,.49,1),artifactsPurpleGlow:new THREE.Vector4(.58,.17,1,1)},Jarvis:{artifactTargetGlow:new THREE.Vector4(.62,.22,.62,1),artifactsRedGlow:new THREE.Vector4(.79,.11,.49,1),artifactsPurpleGlow:new THREE.Vector4(.58,.17,1,1)}}},e=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a},f=function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(a[d]=c&&"object"==typeof a[d]&&"object"==typeof b[d]?f(a[d],b[d],c):b[d]);return a},g=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]="object"==typeof a[c]&&"object"==typeof b[c]?g(a[c],b[c]):b[c]);return a},h=function(a,b,c){if("image"===b||"image.co"===b)if(/\.tga$/.test(a))libtga.loadFile(a,function(a,b){if(a)return void c(a,null);var d=document.createElement("canvas"),e=d.getContext("2d"),f=e.createImageData(b.width,b.height);f.data.set(b.imageData),d.height=b.height,d.width=b.width,e.putImageData(f,0,0),c(null,d)});else{var d=new Image;"image.co"===b&&(d.crossOrigin="anoymous"),d.onload=function(){c(null,this)},d.onerror=function(a){c(a,null)},d.src=a}else{var e=new XMLHttpRequest;e.open("GET",a),e.responseType=b,e.onload=function(){c(null,this.response)},e.onerror=function(a){c(a,null)},e.send()}},i=function(a,b){var c={};for(var d in a)if(!(!a.hasOwnProperty(d)||b&&d in b)){var e=a[d];c[d]="object"==typeof e.value&&"clone"in e.value?{type:e.type,value:e.value.clone()}:{type:e.type,value:e.value}}return c},j=function(a,b){var c={};for(var d in a)!a.hasOwnProperty(d)||b&&d in b||(c[d]=a[d]);return c},k=function(a,b,c,d){d=d||0;var e=0,f=a.length,g=function(){return e>=f?void c():(b(a[e],e),e++,void setTimeout(g,d))};setTimeout(g,0)},l=function(a,b){a=a||"text",b=b||function(a){return a};var c={},d={};this.loadAsset=function(e,f,g,i){return d[e]?void g(null,d[e]):(c[e]=c[e]||[],c[e].push(g),void(d.hasOwnProperty(e)||(d[e]=!1,h(f,a,function(a,f){a||(f=b(f,i),d[e]=f);for(var g;g=c[e].shift();)g(a,f)}))))},this.getAsset=function(a){return d[a]}},m=function(){var a=Math.PI/2,b=5,d=function(a){return{identifier:a.identifier,x:a.clientX,y:a.clientY}},e=function(a,b){for(var c=0;c<a.length;c++)if(a[c].identifier==b.identifier)return c;return-1},g=function(a,b,c){c=c||{},this.canvas=a,this.distance=b||2,this.distanceTarget=this.distance;var d={zoomDamp:.5,distanceScale:.25,distanceMax:1e3,distanceMin:1,touchScale:.1,wheelScale:.01,friction:.1,target:new THREE.Vector3,allowZoom:!0};this.options=f(d,c),this.mouse={x:0,y:0},this.mouseOnDown={x:0,y:0},this.rotation={x:0,y:0},this.target={x:3*Math.PI/2,y:Math.PI/6},this.targetOnDown={x:0,y:0},this.overRenderer=!1,this.mouseMove=this.onMouseMove.bind(this),this.mouseUp=this.onMouseUp.bind(this),this.mouseOut=this.onMouseOut.bind(this),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.options.allowZoom&&this.canvas.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.touches=[],this.touchDelta=0,this.touchMove=this.onTouchMove.bind(this),this.touchEnd=this.onTouchEnd.bind(this),this.touchLeave=this.onTouchLeave.bind(this),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this),!1);var e=this;this.canvas.addEventListener("mouseover",function(){e.overRenderer=!0},!1),this.canvas.addEventListener("mouseout",function(){e.overRenderer=!1},!1)};return g.prototype.updateTargets=function(){var c=this.distance<b?this.distance:Math.log(this.distance),d=c/this.options.zoomDamp;this.target.x=this.targetOnDown.x+.005*(this.mouse.x-this.mouseOnDown.x)*d,this.target.y=this.targetOnDown.y+.005*(this.mouse.y-this.mouseOnDown.y)*d,this.target.y=this.target.y>a?a:this.target.y,this.target.y=this.target.y<-a?-a:this.target.y},g.prototype.onMouseDown=function(a){a.preventDefault(),this.canvas.addEventListener("mousemove",this.mouseMove,!1),this.canvas.addEventListener("mouseup",this.mouseUp,!1),this.canvas.addEventListener("mouseout",this.mouseOut,!1),this.mouseOnDown.x=-a.clientX,this.mouseOnDown.y=a.clientY,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y,this.canvas.style.cursor="move"},g.prototype.onMouseMove=function(a){this.mouse.x=-a.clientX,this.mouse.y=a.clientY,this.updateTargets()},g.prototype.onMouseUp=function(a){this.onMouseOut(a),this.canvas.style.cursor="auto"},g.prototype.onMouseOut=function(){this.canvas.removeEventListener("mousemove",this.mouseMove,!1),this.canvas.removeEventListener("mouseup",this.mouseUp,!1),this.canvas.removeEventListener("mouseout",this.mouseOut,!1)},g.prototype.updateCamera=function(a){this.rotation.x+=(this.target.x-this.rotation.x)*this.options.friction,this.rotation.y+=(this.target.y-this.rotation.y)*this.options.friction,this.distance+=(this.distanceTarget-this.distance)*this.options.distanceScale,a.position.x=this.distance*Math.sin(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target.x,a.position.y=this.distance*Math.sin(this.rotation.y)+this.options.target.y,a.position.z=this.distance*Math.cos(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target.z,a.lookAt(this.options.target)},g.prototype.onMouseWheel=function(a){return a.preventDefault(),this.overRenderer&&this.zoom(a.wheelDeltaY*this.options.wheelScale*(this.distance<b?this.distance:Math.log(this.distance))),!1},g.prototype.onTouchStart=function(a){a.preventDefault(),0===this.touches.length&&(this.canvas.addEventListener("touchmove",this.touchMove,!1),this.canvas.addEventListener("touchend",this.touchEnd,!1),this.canvas.addEventListener("touchleave",this.touchLeave,!1));for(var b=0;b<a.changedTouches.length;b++)this.touches.push(d(a.changedTouches[b]));if(1===this.touches.length)this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y;else if(2===this.touches.length&&this.options.allowZoom){var c=Math.abs(this.touches[0].x-this.touches[1].x),e=Math.abs(this.touches[0].y-this.touches[1].y);this.touchDelta=Math.sqrt(c*c+e*e)}this.canvas.style.cursor="move"},g.prototype.onTouchMove=function(a){for(var b=a.changedTouches,f=b.length,g=0;f>g;g++){var h=e(this.touches,b[g]);h>=0?this.touches.splice(h,1,d(b[g])):c.log("could not find event ",b[g])}if(1===this.touches.length)this.mouse.x=-this.touches[0].x,this.mouse.y=this.touches[0].y,this.updateTargets();else if(2===this.touches.length&&this.options.allowZoom){var i=this.touches[0].x-this.touches[1].x,j=this.touches[0].y-this.touches[1].y,k=Math.sqrt(i*i+j*j);this.zoom((k-this.touchDelta)*this.options.touchScale),this.touchDelta=k}},g.prototype.removeTouches=function(a){for(var b=a.changedTouches,c=b.length,d=0;c>d;d++){var f=e(this.touches,b[d]);f>=0&&this.touches.splice(f,1)}0===this.touches.length?(this.canvas.removeEventListener("touchmove",this.touchMove,!1),this.canvas.removeEventListener("touchend",this.touchEnd,!1),this.canvas.removeEventListener("touchleave",this.touchLeave,!1)):1===this.touches.length&&(this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y)},g.prototype.onTouchEnd=function(a){this.removeTouches(a),this.canvas.style.cursor="auto"},g.prototype.onTouchLeave=function(a){this.removeTouches(a)},g.prototype.onTouchCancel=function(a){this.removeTouches(a)},g.prototype.zoom=function(a){this.distanceTarget-=a,this.distanceTarget=Math.min(this.distanceTarget,this.options.distanceMax),this.distanceTarget=Math.max(this.distanceTarget,this.options.distanceMin)},g}(),n=function(a){this.geometry=new THREE.BufferGeometry,this.transparent=a&&a.transparent||!1,this.attributes={}};n.prototype.getAttributeNames=function(){return Object.keys(this.attributes)};var o=function(){var a=function(a,b,c){for(var d=0;d<Math.floor(a.length/b);d++)c(a.subarray(d*b,(d+1)*b),d)},b=function(a){var b,d,e,f,g,h=new DataView(a),i=0,j=h.getUint32(i);i+=4;for(var k=[],l=0;j>l;l++){for(b=h.getUint32(i),1!=b&&16!=b&&c.warn("unknown type "+b),i+=4,d=h.getUint32(i),i+=4,e=h.getUint16(i),i+=2,g="",f=0;e>f;f++)g+=String.fromCharCode(h.getUint8(i+f));i+=e,k.push({name:g,type:b,size:d})}return k},d=function(c){var d,e,f,g=new JavaDeserializer(c.buf),h=g.getStream(),i=h.getContents(),j=i[3].contents.toArray(),k=0,l=b(j),m=l.length,n=i[0].contents.toArray(),o=[];for(d=0;m>d;d++)e=l[d],f="v"+e.size,k+=e.size,c.attributes[e.name]={type:f,values:null};var p=Math.floor(n.length/k);for(d=0;m>d;d++)o.push(new Float32Array(l[d].size*p));var q=new Float32Array(3*p);for(a(n,k,function(a,b){var c,d=0;for(c=0;m>c;c++){for(var e=l[c].size,f=0;e>f;f++)o[c][b*e+f]=a[d+f];d+=e}for(c=0;3>c;c++)q[b+c]=a[c]}),d=0;m>d;d++)e=l[d],c.geometry.addAttribute(e.name,new THREE.BufferAttribute(o[d],e.size));c.geometry.addAttribute("position",new THREE.BufferAttribute(q,3));var r=i[1].contents.toArray(),s=new Uint16Array(r.length);s.set(r),c.geometry.addAttribute("index",new THREE.BufferAttribute(s,1))},f=function(a,b){return n.call(this,b),this.buf=a,d(this),this};return e(f,n),f}(),p=function(){for(var a=9,b=6*a,c=new Array(a),d=new Array(a),f=new Array(a),g=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},h=0;a>h;h++){var i=h/8;c[h]=i,f[h]=3+-1.5*Math.pow(g(2*Math.abs(i-.5)),4),d[h]=g(1-2*Math.abs(i-.5))}var j=new THREE.Vector4(.46,.18,.18,1),k=new THREE.Vector3,l=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=4*e;a[3*e+0]=f,a[3*e+1]=g,a[3*e+2]=h,b[n+0]=f,b[n+1]=g,b[n+2]=h,b[n+3]=l,c[n+0]=i,c[n+1]=j,c[n+2]=k.x,c[n+3]=k.z,d[n+0]=m.x,d[n+1]=m.y,d[n+2]=m.z,d[n+3]=m.w},m=function(a){a=a||{},a.transparent=!0,n.call(this,a),this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,4),this.a_texCoord0=new THREE.BufferAttribute(new Float32Array,4),this.a_color=new THREE.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_texCoord0:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.linkCount=0};return e(m,n),m.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},m.prototype.addLink=function(e,g,h,i){i=i||Math.sqrt((g.x-e.x)*(g.x-e.x)+(g.y-e.y)*(g.y-e.y));for(var m=k.y,n=m+Math.min(30,.08*i),o=e.percent,p=g.percent,q=(o+p)/2,r=.01*i,s=.1+.3*q,t=new THREE.Vector3(g.x,0,g.y).sub(new THREE.Vector3(e.x,0,e.y)),u=new THREE.Vector3(0,1,0),v=t.clone().cross(u).normalize(),w=this.extendBuffer(this.a_position,b),x=this.extendBuffer(this.a_texCoord0,b),y=this.extendBuffer(this.a_color,b),z=this.extendBuffer(this.position,b),A=this.linkCount*b,B=2*a,C=0;a>C;C++){var D=c[C],E=o+D*(p-o),F=.6+.35*E,G=D*r,H=e.x+D*t.x,I=e.y+D*t.z,J=m+d[C]*(n-m),K=f[C],L=j.clone();L.lerp(h,.25+.75*E),L.w=F,l(z,w,x,y,A+2*C,H+K*v.x,J,I+K*v.z,0,G,u,s,L),l(z,w,x,y,A+2*C+1,H-K*v.x,J,I-K*v.z,.5,G,u,s,L),l(z,w,x,y,A+B+2*C,H,J+K,I,0,G,v,s,L),l(z,w,x,y,A+B+2*C+1,H,J-K,I,.5,G,v,s,L),l(z,w,x,y,A+2*B+2*C,H,J-K,I,.5,G,v,s,L),l(z,w,x,y,A+2*B+2*C+1,H,0,I,1,G,v,s,L)}var M=new Uint16Array(144*(this.linkCount+1));M.set(this.index.array);var N=this.linkCount*b,O=144*this.linkCount;for(C=0;3>C;C++){for(var P=0;a-1>P;P++)M[O+0]=N+1,M[O+1]=N+0,M[O+2]=N+2,M[O+3]=N+1,M[O+4]=N+2,M[O+5]=N+3,N+=2,O+=6;N+=2}return this.linkCount++,this.index.array=M,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this},m}(),q=function(){for(var a=5,b=4*a,c=new Array(a),d=new Array(a),f=new Array(a),g=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},h=0;a>h;h++){var i=h/4;c[h]=i,f[h]=3.5*Math.max(1-Math.pow(g(2*Math.abs(i-.5)),4),.2),d[h]=g(1-2*Math.abs(i-.5))}var j=new THREE.Vector4(.78,.31,.31,1),k=new THREE.Vector3,l=new THREE.Vector3,m=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=4*e;a[3*e+0]=f,a[3*e+1]=g,a[3*e+2]=h,b[n+0]=f,b[n+1]=g,b[n+2]=h,b[n+3]=l,c[n+0]=i,c[n+1]=j,c[n+2]=k.x,c[n+3]=k.z,d[n+0]=m.x,d[n+1]=m.y,d[n+2]=m.z,d[n+3]=m.w},o=function(a){a=a||{},a.transparent=!0,n.call(this,a),this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,4),this.a_texCoord0=new THREE.BufferAttribute(new Float32Array,4),this.a_color=new THREE.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_texCoord0:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.linkCount=0};return e(o,n),o.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},o.prototype.addLink=function(e,g,h){var i=Math.sqrt((g.x-e.x)*(g.x-e.x)+(g.y-e.y)*(g.y-e.y)),n=l.y,o=k.y,p=g.percent,q=2/30*i,r=.9+.1*p,s=.65+.35*p,t=.75+.25*p,u=.1+.3*p,v=j.clone();v.lerp(h,.1+.85*p),v.w=t*v.w;for(var w=new THREE.Vector3(g.x,0,g.y).sub(new THREE.Vector3(e.x,0,e.y)),x=new THREE.Vector3(0,1,0),y=w.clone().cross(x).normalize(),z=this.extendBuffer(this.a_position,b),A=this.extendBuffer(this.a_texCoord0,b),B=this.extendBuffer(this.a_color,b),C=this.extendBuffer(this.position,b),D=this.linkCount*b,E=2*a,F=5*(e.x+e.y-Math.floor(e.x+e.y)),G=0;a>G;G++){var H=c[G],I=e.x+H*w.x,J=e.y+H*w.z,K=o+H*(n-o)+r*d[G],L=s*f[G],M=H*q;m(C,z,A,B,D+2*G+0,I+L*y.x,K,J+L*y.z,0,M+F,x,u,v),m(C,z,A,B,D+2*G+1,I-L*y.x,K,J-L*y.z,1,M+F,x,u,v),m(C,z,A,B,D+E+2*G+0,I,K+L,J,0,M+F,y,u,v),m(C,z,A,B,D+E+2*G+1,I,K-L,J,1,M+F,y,u,v)}var N=new Uint16Array(48*(this.linkCount+1));N.set(this.index.array);var O=this.linkCount*b,P=48*this.linkCount;for(G=0;2>G;G++){for(var Q=0;a-1>Q;Q++)N[P+0]=O+1,N[P+1]=O+0,N[P+2]=O+2,N[P+3]=O+1,N[P+4]=O+2,N[P+5]=O+3,O+=2,P+=6;O+=2}return this.linkCount++,this.index.array=N,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this},o}(),r=function(){var a=function(a,b,c,d,e,f,g,h){var i=4*d;return a[3*d+0]=e.x,a[3*d+1]=0,a[3*d+2]=e.y,b[i+0]=e.x,b[i+1]=e.y,b[i+2]=f,b[i+3]=g,c[i+0]=h.x,c[i+1]=h.y,c[i+2]=h.z,c[i+3]=h.w,d+1},b=function(b,c,d,e,f,g,h,i,j,k,l){return a(b,c,d,a(b,c,d,a(b,c,d,e,f,0,g,l),h,0,i,l),j,((h.x-f.x)*(f.y-j.y)-(h.y-f.y)*(f.x-j.x))/f.distanceTo(h),k,l)},c=function(a){a=a||{},a.transparent=!0,n.call(this,a),this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,4),this.a_color=new THREE.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.fieldCount=0,this.lastOffset=0};return e(c,n),c.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},c.prototype.addField=function(a,c,d,e,f){f=1;var g=1.1,h=a.percent,i=c.percent,j=d.percent,k=this.extendBuffer(this.position,9),l=this.extendBuffer(this.a_position,9),m=this.extendBuffer(this.a_color,9);if(1>f){var n=Math.max(0,f);g=1.1*n;var o=n*n;h*=o,i*=o,j*=o}var p=new THREE.Vector2(a.x,a.y),q=new THREE.Vector2(c.x,c.y),r=new THREE.Vector2(d.x,d.y),s=p.clone().add(q).add(r).multiplyScalar(.333333333333),t=this.lastOffset;this.lastOffset=b(k,l,m,this.lastOffset,p,h,q,i,s,g,e),this.lastOffset=b(k,l,m,this.lastOffset,q,i,r,j,s,g,e),this.lastOffset=b(k,l,m,this.lastOffset,r,j,p,h,s,g,e);var u=new Uint16Array(9*(this.fieldCount+1));u.set(this.index.array);for(var v=0;9>v;v++)u[t+v]=t+v;return this.index.array=u,this.index.needsUpdate=!0,this.position.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this.fieldCount++,this.fieldCount},c}(),s=function(){var a=function(a,b){return[a,0,b]},b=function(b,c){n.call(this,c),b=b||a,c=c||{};var d={slices:1,paramSize:3};this.options=f(d,c);var e=b(0,0);if(!e.length||e.length!=this.options.paramSize)throw"Parametric function returned invalid results, must be array of length "+this.options.paramSize;this.attributes={a_position:{type:"v"+this.options.paramSize,values:null},a_texCoord0:{type:"v2",values:null}};for(var g=this.options.slices,h=this.options.paramSize,i=(g+1)*(g+1),j=new Float32Array(3*i),k=new Float32Array(i*h),l=new Float32Array(2*i),m=new Uint16Array(g*g*3*2),o=0,p=0;g>=p;p++)for(var q=0;g>=q;q++){var r=p/g,s=q/g,t=b(r,s),u=p*(g+1)+q;l[2*u]=r,l[2*u+1]=s;for(var v=0;h>v;v++)k[u*h+v]=t[v],3>v&&(j[u*h+v]=t[v]);3>h&&(j[3*u+2]=0),g>p&&g>q&&(m[o++]=u,m[o++]=u+1,m[o++]=u+g+1,m[o++]=u+g+1,m[o++]=u+1,m[o++]=u+g+2)}this.geometry.addAttribute("a_position",new THREE.BufferAttribute(k,h)),this.geometry.addAttribute("a_texCoord0",new THREE.BufferAttribute(l,2)),this.geometry.addAttribute("position",new THREE.BufferAttribute(j,3)),this.geometry.addAttribute("index",new THREE.BufferAttribute(m,1))};return e(b,n),b}(),t=function(a,b){this.base=a,b=b||n,this.geometries=new l("arraybuffer",function(a,c){return new b(a,c)})};t.prototype.loadAsset=function(a,b,c){this.geometries.loadAsset(a,this.base+b.path,c,b)},t.prototype.getAsset=function(a){return this.geometries.getAsset(a)};var u=function(){var a={mat4:"m4",vec4:"v4",vec3:"v3",vec2:"v2","float":"f",sampler2D:"t","int":"i"},b=function(b){for(var d,e=/uniform ([^ ]+) ([^;]+);/gi,f={};null!==(d=e.exec(b));){var g=d[1];a.hasOwnProperty(g)?g=a[g]:c.warn("no known conversion from "+g),f[d[2]]={type:g}}return f},d=function(b){for(var d,e=/attribute ([^ ]+) ([^;]+);/gi,f={};null!==(d=e.exec(b));){var g=d[1];a.hasOwnProperty(g)?g=a[g]:c.warn("no known conversion from "+g),f[d[2]]={type:g}}return f},e=function(a,c){this.vertex=a,this.fragment=c,this.uniforms=b(a+"\n"+c),this.attributes=d(a+"\n"+c)};return e.prototype.getUniformsList=function(){return Object.keys(this.uniforms)},e.prototype.getAttributesList=function(){return Object.keys(this.attributes)},e}(),v=function(a){this.base=a,this.vertex=new l("text"),this.fragment=new l("text")};v.prototype.loadAsset=function(a,b,c){var d={},e=!1,f=function(){!e&&d.fragment&&d.vertex&&(e=!0,c(null,new u(d.vertex,d.fragment)))};this.vertex.loadAsset(a,this.base+b.vertex,function(a,b){return a?void c(a,null):(d.vertex=b,void f())}),this.fragment.loadAsset(a,this.base+b.fragment,function(a,b){return a?void c(a,null):(d.fragment=b,void f())})},v.prototype.getAsset=function(a){var b=this.vertex.getAsset(a),c=this.fragment.getAsset(a);return b&&c?new u(b,c):null};var w=function(){var a={MipMapLinearLinear:THREE.LinearMipMapLinearFilter,Linear:THREE.LinearFilter,MipMapLinearNearest:THREE.LinearMipMapNearestFilter,MipMapNearestLinear:THREE.NearestMipMapLinearFilter,Nearest:THREE.NearestFilter,Repeat:THREE.RepeatWrapping,ClampToEdge:THREE.ClampToEdgeWrapping},d=function(b){return a.hasOwnProperty(b)?b=a[b]:c.warn("unknown type "+b),b},e=function(a){this.base=a,this.metadata={},this.textures=new l("image",function(a,c){var e=d(c.magFilter),f=d(c.minFilter),g=d(c.wrapS),h=d(c.wrapT),i=new THREE.Texture(a,b,g,h,e,f);return i.flipY=!1,i.needsUpdate=!0,i})};return e.prototype.loadAsset=function(a,b,c){this.textures.loadAsset(a,this.base+b.path,c,b)},e.prototype.getAsset=function(a){return this.textures.getAsset(a)},e}(),x=function(){var a=function(a,b,c){this.geometry=a,this.texture=b,this.texture.needsUpdate=!0,this.shaders=c,this.uniforms={},this.uniforms.u_texture={type:"t",value:this.texture};var d={uniforms:this.uniforms,attributes:this.geometry.attributes,vertexShader:this.shaders.vertex,fragmentShader:this.shaders.fragment,transparent:this.geometry.transparent,side:THREE.DoubleSide,depthWrite:!this.geometry.transparent};this.material=new THREE.RawShaderMaterial(d),this.mesh=new THREE.Mesh(this.geometry.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.updateMatrix(),this.mesh.matrixAutoUpdate=!1,this.id=null};return a.prototype.setUniform=function(a,b){return a in this.material.uniforms&&b.type!=this.material.uniforms[a].type?(c.warn("uniform type mismatch"),!1):(this.uniforms[a]=b,this.material.needsUpdate=!0,this)},a.prototype.clone=function(){var b=j(this.uniforms,{u_texture:1,u_modelViewProject:1});return new a(this.geometry,this.texture,this.shaders,b,this.options)},a}(),y=function(a,b){var d=b||{},e={model:new t(a,o),texture:new w(a),shaders:new v(a)},f=Object.keys(e);return this.loadModel=function(a,b){var g,h={},i=!1,j=function(){!i&&h.model&&h.texture&&h.shaders&&(i=!0,b(null,new x(h.model,h.texture,h.shaders)))};for(g=0;g<f.length;g++){var k=f[g];if(!(a[k]in d[k]))return c.warn("unknown "+k+": "+a[k]),!1}var l=function(c){e[c].loadAsset(a[c],d[c][a[c]],function(a,d){return a?void b(a,null):(h[c]=d,void j())})};for(g=0;g<f.length;g++)l(f[g]);return this},this.setAssets=function(a){return d=a,this},this.addAssets=function(a){d=g(d,a)},this.getAsset=function(a,b){return a in e?e[a].getAsset(b):null},this.getModel=function(a,b,c){var d=e.model.getAsset(a),f=e.texture.getAsset(b),g=e.shaders.getAsset(c);return d&&f&&g?new x(d,f,g):null},this.getRawShader=function(a){return d&&"rawShaders"in d&&a in d.rawShaders?new u(d.rawShaders[a].vertex,d.rawShaders[a].fragment):void 0},this.preloadAssets=function(a){for(var b={},g=function(){for(var c=!0,d=0;d<f.length;d++)c=c&&b[f[d]].i>=b[f[d]].n;c&&setTimeout(a,0)},h=function(a){var f=Object.keys(d[a]);b[a]={i:0,n:f.length};var h=function(){if(b[a].i>=b[a].n)return void g();var i=b[a].i++;e[a].loadAsset(f[i],d[a][f[i]],function(a){a&&c.warn("Unable to load asset: "+a),setTimeout(h,0)})};h()},i=0;i<f.length;i++)h(f[i]);return function(){for(var a=Object.keys(b),c=a.length,d=0,e=0;c>e;e++)d+=b[a[e]].i/b[a[e]].n/c;return d}},this},z=function(a,b){b=b||{};var e={cameraOptions:{fov:75,aspect:1,near:.01,far:50},shaderPrecision:"mediump",premultipliedAlpha:!0,alpha:!1,preserveDrawingBuffer:!1,assetsBase:"/assets/"};this.options=f(e,b,!0);var g=new THREE.Matrix4,h=new THREE.Vector3,i={u_color0:{type:"v4",value:new THREE.Vector4},u_color1:{type:"v4",value:new THREE.Vector4(235/256,179/256,.890625,1)},u_rotation:{type:"f",value:0},u_rampTarget:{type:"f",value:.5},u_alpha:{type:"f",value:.6},u_baseColor:{type:"v4",value:(new THREE.Vector4).copy(d.teamColors.RESISTANCE)},u_altColor:{type:"v4",value:new THREE.Vector4(.6,.4,.6,.8)},u_teamColor:{type:"v4",value:new THREE.Vector4(235/256,179/256,.890625,1)},u_elapsedTime:{type:"f",value:0},u_color:{type:"v4",value:(new THREE.Vector4).copy(d.teamColors.RESISTANCE)},u_rampTargetInvWidth:{type:"v2",value:new THREE.Vector2(.5,1.5)},u_contributionsAndAlpha:{type:"v3",value:new THREE.Vector3(.5,.5,.5)},u_modelViewProject:{type:"m4",value:g},u_cameraFwd:{type:"v3",value:h},u_modelToTexScale:{type:"v2",value:new THREE.Vector2(.00666666667,.00666666667)},u_modelToTexOrigin:{type:"v2",value:new THREE.Vector2(0,0)},u_texCoordOffset0:{type:"v2",value:new THREE.Vector2(0,0)},u_texCoordOffset1:{type:"v2",value:new THREE.Vector2(0,0)},u_texture:{type:"t",value:null}};this.getUniform=function(a){return i[a]},this.setUniform=function(a,b){return a in i&&(i[a].value=b),this},this.replaceGlobalUniform=function(a,b){return a in i&&i[a].type==b.type&&(i[a]=b),this.updateModels(),this};var j={};this.updateModels=function(){for(var a in j)j.hasOwnProperty(a)&&(j[a].material.needsUpdate=!0)};var k=0;this.ensureDefaultUniforms=function(a){for(var b=a.shaders.getUniformsList(),d=0;d<b.length;d++){var e=b[d];i.hasOwnProperty(e)?a.uniforms.hasOwnProperty(e)||a.setUniform(e,i[e]):c.log("unknown uniform: "+e)}},this.addModel=function(a,b){if(!(a instanceof x))throw"Object must be of type Model";if(a.id)j[a.id]=a;else{var c=k++;j[c]=a,a.id=c,a.setUniform("u_modelViewProject",{type:"m4",value:new THREE.Matrix4}),this.ensureDefaultUniforms(a)}b||this.scene.add(a.mesh)},this.removeModel=function(a){var b=a.id;return b in j&&(this.scene.remove(j[b].mesh),delete j[b]),this},this.hideModel=function(a){var b=a.id;return b in j&&this.scene.remove(j[b].mesh),this},this.showModel=function(a){var b=a.id;return b in j&&this.scene.add(j[b].mesh),this},this.clearScene=function(){for(var a in j)j.hasOwnProperty(a)&&this.scene.remove(j[a].mesh);return this},this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(this.options.cameraOptions.fov,this.options.cameraOptions.aspect,this.options.cameraOptions.near,this.options.cameraOptions.far),this.renderer=new THREE.WebGLRenderer({canvas:a,precision:this.options.shaderPrecision,premultipliedAlpha:this.options.premultipliedAlpha,alpha:this.options.alpha,preserveDrawingBuffer:this.options.preserveDrawingBuffer,antialias:!0}),this.updateViewport=function(a,b){this.camera.aspect=a/b,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,b)};var l=0,m=this,n=[];this.getTick=function(){return l},this.registerPeriodic=function(a){return n.push(a),this},this.unregisterPeriodic=function(a){for(var b=0;b<n.length;b++)n[b]===a&&n.splice(b,1);return this};var o=!1,p=!1,q=function(){if(o)return void(p=!0);window.requestAnimationFrame(q),g.multiplyMatrices(m.camera.projectionMatrix,m.camera.matrixWorldInverse),h.set(0,0,-1).applyQuaternion(m.camera.quaternion);var a;for(a in j)j.hasOwnProperty(a)&&"u_modelViewProject"in j[a].uniforms&&(j[a].uniforms.u_modelViewProject.value.copy(g),j[a].uniforms.u_modelViewProject.value.multiply(j[a].mesh.matrixWorld),j[a].material.needsUpdate=!0);m.renderer.render(m.scene,m.camera);var b=n.length;for(a=0;b>a;a++)n[a](l);l++};return this.suspend=function(){o||(o=!0,p=!1)},this.resume=function(){o=!1,p&&(p=!1,q())},q(),this},A={AssetLoader:l,Geometry:{IngressGeometry:o,ParametricGeometry:s,Geometry:n,ResonatorLinkGeometry:q,PortalLinkGeometry:p,FieldGeometry:r},Model:x,Controls:{OrbitControls:m},ShaderSet:u,AssetManager:y,Engine:z,Constants:d,Utilities:{cloneUniforms:i,copyUniforms:j,loadResource:h,asyncForeach:k,setParams:f,inherits:e},VERSION:"0.9.1"};a.IMV=A}(this);
//# sourceMappingURL=ingress-model-viewer.min.js.map