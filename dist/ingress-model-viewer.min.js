var IMV;(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{t.r(e),t.d(e,{default:()=>Wa});var r={};t.r(r),t.d(r,{ARRAY_TYPE:()=>o,EPSILON:()=>n,RANDOM:()=>i,equals:()=>s,setMatrixArrayType:()=>a,toRadian:()=>c});var n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random;function a(t){o=t}var u=Math.PI/180;function c(t){return t*u}function s(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))}function f(){var t=new o(4);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function l(t){var e=new o(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function p(t,e,r,n){var i=new o(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function y(t,e,r,n){var o=e[0],i=e[1],a=e[2],u=e[3];return t[0]=o+n*(r[0]-o),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t[3]=u+n*(r[3]-u),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),f();const b={teamColors:{RESISTANCE:p(0,.7607843137254902,1,1),ENLIGHTENED:p(.1568627450980392,.9568627450980393,.1568627450980392,1),NEUTRAL:p(.9764705882352941,.9764705882352941,.9764705882352941,1),LOKI:p(1,.1568627450980392,.1568627450980392,1)},qualityColors:{EXTREMELY_RARE:p(.9803921568627451,.39215686274509803,.39215686274509803,1),VERY_RARE:p(.9568627450980393,.5215686274509804,.9254901960784314,1),MORE_RARE:p(.7647058823529411,0,1,1),RARE:p(.6666666666666666,.5372549019607843,.984313725490196,1),LESS_COMMON:p(.45098039215686275,.6588235294117647,1,1),COMMON:p(.5098039215686274,.9529411764705882,.7058823529411765,1),VERY_COMMON:p(.6980392156862745,.6980392156862745,.6980392156862745,1),L1:p(.996078431372549,.807843137254902,.35294117647058826,1),L2:p(1,.6509803921568628,.18823529411764706,1),L3:p(1,.45098039215686275,.08235294117647059,1),L4:p(.8941176470588236,0,0,1),L5:p(.9921568627450981,.1607843137254902,.5725490196078431,1),L6:p(.9215686274509803,.14901960784313725,.803921568627451,1),L7:p(.7568627450980392,.1411764705882353,.8784313725490196,1),L8:p(.5882352941176471,.15294117647058825,.9568627450980393,1)},anomalyColors:{1:p(1,.5686274509803921,.21176470588235294,1),2:p(1,.3215686274509804,.9058823529411765,1),3:p(.6196078431372549,.35294117647058826,1,1),4:p(.8431372549019608,.27058823529411763,.27058823529411763,1),5:p(1,.9450980392156862,0,1),6:p(.6509803921568628,1,.9019607843137255,1),7:p(.5725490196078431,.5803921568627451,.592156862745098,1)},artifactGlowColors:{Helios:{Red:p(.92,.51,.14,1),Purple:p(1,.87,.55,1),Target:p(1,.72,0,1)},Amar:{Target:p(.62,.22,.62,1),Red:p(.79,.11,.49,1),Purple:p(.58,.17,1,1)},Jarvis:{Target:p(.62,.22,.62,1),Red:p(.79,.11,.49,1),Purple:p(.58,.17,1,1)},Shonin:{Red:p(.78,.84,1,1),Purple:p(.25,.81,1,1),Target:p(.7,.7,.7,1)},Lightman:{Red:p(1,.44,.45,1),Purple:p(1,.24,.25,1),Target:p(.74,0,.02,1)},Abaddon1:{Red:p(1,.7,.86,1),Purple:p(.82,.7,1,1),Target:p(0,.95,.4,1)},Abaddon2:{Red:p(.7,1,.87,1),Purple:p(.86,.7,1,1),Target:p(0,.59,1,1)},Shard2017:{Red:p(.7,1,.87,1),Purple:p(.86,.7,1,1),Target:p(0,.59,1,1)}},keyCapsuleColors:{blue:[p(.3686274509803921,.6784313725490196,1,1),p(.3568627450980392,.4705882352941176,.6470588235294117,1)],green:[p(.2117647058823529,1,.4705882352941176,1),p(.2980392156862745,.5607843137254901,.4117647058823529,1)],red:[p(1,.0431372549019607,.3764705882352941,1),p(.6784313725490196,.2078431372549019,.3607843137254901,1)],white:[p(1,1,1,1),p(.592156862745098,.588235294117647,.584313725490196,1)],yellow:[p(.9019607843137254,.9411764705882352,.1647058823529411,1),p(.6862745098039215,.6509803921568627,.3607843137254901,1)]},xmColors:{coreGlow:p(.92,.7,.89,1),coreGlowAlt:p(.6,.4,.6,.8),coreGlowAda:p(0,.7607843137254902,1,1),coreGlowJarvis:p(.1568627450980392,.9568627450980393,.1568627450980392,1),coreGlowChaotic:p(1,.35,0,1),coreGlowChaoticAlt:p(.66,.1,.09,1)},Mesh:{Inventory:{Xmp:"XmpMesh",XmpXm:"XmpXMMesh",Ultrastrike:"UltrastrikeMesh",UltrastrikeXm:"UltrastrikeXMMesh",ResShield:"ResShieldMesh",ResShieldXm:"ResShieldXMMesh",PowerCube:"PowerCubeMesh",PowerCubeXm:"PowerCubeXmMesh",LinkAmp:"LinkAmpMesh",LinkAmpXm:"LinkAmpXmMesh",UltraLinkAmp:"UltraLinkAmpMesh",UltraLinkAmpXm:"UltraLinkAmpXmMesh",HeatSink:"HeatSinkMesh",HeatSinkXm:"HeatSinkXmMesh",MultiHack:"MultiHackMesh",MultiHackXm:"MultiHackXmMesh",ForceAmp:"ForceAmpMesh",ForceAmpXm:"ForceAmpXmMesh",Turret:"TurretMesh",TurretXm:"TurretXmMesh",FlipCardAda:"FlipCardMeshAda",FlipCardJarvis:"FlipCardMeshJarvis",FlipCardXm:"FlipCardXmMesh",Resonator:"ResonatorMesh",ResonatorXm:"ResonatorXMMesh",Capsule:"CapsuleMesh",InterestCapsule:"InterestCapsuleMesh",KeyCapsule:"KeyCapsuleMesh",KeyCapsuleXm:"KeyCapsuleXmMesh",CapsuleXm:"CapsuleXmMesh",Fracker:"FrackerMesh",FrackerXm:"FrackerXmMesh",TransmuterAttack:"TransmuterAttackMesh",TransmuterAttackXm:"TransmuterAttackXmMesh",TransmuterDefense:"TransmuterDefenseMesh",TransmuterDefenseXm:"TransmuterDefenseXmMesh",Mysterious:"MysteriousMesh",MysteriousXm:"MysteriousXmMesh",Niantic:"NianticMesh",ExtraShield:"ExtraShieldMesh",BoostedPowerCube:"BoostedPowerCubeMesh",BoostedPowerCubeXm:"BoostedPowerCubeXmMesh",BoostedPowerCubeK:"BoostedPowerCubeKMesh",BoostedPowerCubeKXm:"BoostedPowerCubeKXmMesh",MediaCube:"MediaCubeMesh",MediaPlaneMesh:"MediaPlaneMesh",PortalKeyResourceUnit:"PortalKeyResourceUnit"},Resource:{Xmp:"XmpResourceUnitMesh",PortalKeyResourceUnit:"PortalKeyResourceUnit",Ultrastrike:"UltrastrikeResourceUnitMesh",PowerCube:"PowerCubeResourceUnitMesh",LinkAmp:"LinkAmpResourceUnitMesh",UltraLinkAmp:"UltraLinkAmpResourceUnitMesh",HeatSink:"HeatSinkResourceUnitMesh",MultiHack:"MultiHackResourceUnitMesh",ForceAmp:"ForceAmpResourceUnitMesh",Turret:"TurretResourceUnitMesh",FlipCardAda:"FlipCardResourceUnitMeshAda",FlipCardJarvis:"FlipCardResourceUnitMeshJarvis",Resonator:"ResonatorResourceUnitMesh",PortalShield:"PortalShieldResourceUnitMesh",Capsule:"CapsuleResourceUnitMesh",InterestCapsule:"InterestCapsuleResourceUnitMesh",Fracker:"FrackerResourceUnitMesh",TransmuterAttack:"TransmuterAttackResourceUnitMesh",TransmuterDefense:"TransmuterDefenseResourceUnitMesh",Mysterious:"MysteriousResourceUnitMesh",ExtraShield:"ExtraShieldResourceUnitMesh",KeyCapsule:"KeyCapsuleResourceUnitMesh",BoostedPowerCube:"BoostedPowerCubeResourceUnitMesh",BoostedPowerCubeK:"BoostedPowerCubeKResourceUnitMesh"},Player:{Player:"PlayerMesh",PlayerEdge:"PlayerMeshEdge",PlayerReflection:"PlayerMeshReflection",PlayerGlow:"PlayerMeshGlow",BreadCrumb:"BreadCrumbMesh",Compass:"CompassMesh"},Ornament:{MeetupPoint:"OrnamentMeetupPointMesh",FinishPoint:"OrnamentFinishPointMesh",Cluster:"OrnamentClusterMesh",Volatile:"OrnamentVolatileMesh"},World:{Shield:"PortalShieldMesh",Portal:"TexturedPortalMesh",Waypoint:"TexturedScannerFTMesh",Resonator:"ResonatorUnitLowResMesh",XmpRing:"XmpRingMesh",UltraStrikeRing:"UltraStrikeRingMesh",UltraStrikeColumn:"UltraStrikeColumnMesh",ArtifactsRedGlow:"ArtifactsRedGlow",ArtifactsGreenGlow:"ArtifactsGreenGlow",ArtifactsPurpleGlow:"ArtifactsPurpleGlow",ArtifactsTargetGlow:"ArtifactsTargetGlow",SingleResonator:"SingleResonatorMesh",OrnamentMeetupPoint:"OrnamentMeetupPointMesh",OrnamentFinishPoint:"OrnamentFinishPointMesh",OrnamentCluster:"OrnamentClusterMesh",OrnamentVolatile:"OrnamentVolatileMesh"}},Program:{Bicolored:"bicolor_textured",Textured:"textured",RegionTextured:"region_textured",Glowramp:"portal_scanner",Xm:"xm",ShieldEffect:"shield",Atmosphere:"atmosphere",Link:"LinkShader",SphericalLink:"link3d",ParticlePortal:"particle_portals"},Texture:{FlipCard:"FlipCardTexture",Xm:"ObjectXMTexture",Glowramp:"GlowrampTexture",Media:"MediaCubeTexture",Waypoint:"FtWaypointTexture",ShieldEffect:"PortalShieldTexture",ColorGlow:"ColorGlowTexture",TargetGlow:"TargetGlowTexture",PortalLink:"PortalLinkTexture",ResonatorLink:"ResonatorLinkTexture",OrnamentMeetupPoint:"OrnamentMeetupPointTexture",OrnamentFinishPoint:"OrnamentFinishPointTexture",OrnamentCluster:"OrnamentClusterTexture",OrnamentVolatile:"OrnamentVolatileTexture",Particle:"ParticleTexture"}};function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}const v=m((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e}));class w{constructor(t){this.dataview=new DataView(t),this.header=w.readHeader(this.dataview),this.width=this.header.imageSpec.width,this.height=this.header.imageSpec.height,this.compressed=!!(8&this.header.imageType),this.imageId=w.readImageId(this.dataview,this.header),this.colorMap=w.readColorMap(this.dataview,this.header),this.imageData=w.readImage(this)}}w.HEADER_SIZE=18,w.IMAGE_TYPE_NONE=0,w.IMAGE_TYPE_COLORMAPPED=1,w.IMAGE_TYPE_TRUECOLOR=2,w.IMAGE_TYPE_GREYSCALE=3,w.IMAGE_RUNLENGTH_ENCODED=8,w.readHeader=function(t){return{idLength:t.getUint8(0,!0),mapType:t.getUint8(1,!0),imageType:t.getUint8(2,!0),colorMapSpec:w.readColorMapSpec(t,3),imageSpec:w.readImageSpec(t,8)}},w.readColorMapSpec=function(t,e){var r=t.getUint8(e+4,!0);return{firstEntry:t.getUint16(e,!0),length:t.getUint16(e+2,!0),entrySizeBits:r,entrySizeBytes:Math.floor((r+7)/8)}},w.readImageSpec=function(t,e){var r=t.getUint8(e+9);return{xOrigin:t.getUint16(e,!0),yOrigin:t.getUint16(e+2,!0),width:t.getUint16(e+4,!0),height:t.getUint16(e+6,!0),pixelDepth:t.getUint8(e+8),descriptor:r,attributeBits:15&r,origin:(48&r)>>4,interleave:(192&r)>>6}},w.readImageId=function(t,e){return new Uint8Array(t.buffer,18,e.idLength)},w.readColorMap=function(t,e){if(e.colorMapSpec.length<=0)return null;var r=new Uint8ClampedArray(4*e.colorMapSpec.length),n=null,o=18+e.idLength;switch(e.colorMapSpec.entrySizeBits){case 8:n=w.readPixel8;break;case 16:n=w.readPixel15;break;case 15:n=w.readPixel16;break;case 24:n=w.readPixel24;break;case 32:n=w.readPixel32;break;default:throw"Unsupported pixel depth"}for(var i=0;i<e.colorMapSpec.length;i++)n(t,o,i,r,i);return r},w.readPixel8=function(t,e,r,n,o){var i=t.getUint8(e+r);n[4*o+2]=i,n[4*o+1]=i,n[4*o+0]=i,n[4*o+3]=255},w.readPixel15=function(t,e,r,n,o){var i=t.getUint16(e+2*r,!0);n[4*o+2]=(31&i)<<3,n[4*o+1]=(i>>5&31)<<3,n[4*o+0]=(i>>10&31)<<3,n[4*o+3]=255},w.readPixel16=function(t,e,r,n,o){var i=t.getUint16(e+2*r,!0);n[4*o+2]=(31&i)<<3,n[4*o+1]=(i>>5&31)<<3,n[4*o+0]=(i>>10&31)<<3,n[4*o+3]=128==(128&i)?255:0},w.readPixel24=function(t,e,r,n,o){n[4*o+2]=t.getUint8(e+3*r+0),n[4*o+1]=t.getUint8(e+3*r+1),n[4*o+0]=t.getUint8(e+3*r+2),n[4*o+3]=255},w.readPixel32=function(t,e,r,n,o){n[4*o+2]=t.getUint8(e+4*r+0),n[4*o+1]=t.getUint8(e+4*r+1),n[4*o+0]=t.getUint8(e+4*r+2),n[4*o+3]=255},w.readMappedPixel8=function(t,e,r,n,o,i,a){var u=t.getUint8(n+o)+r;i[4*a+0]=e[4*u+0],i[4*a+1]=e[4*u+1],i[4*a+2]=e[4*u+2],i[4*a+3]=e[4*u+3]},w.readMappedPixel15=function(t,e,r,n,o,i,a){var u=t.getUint16(n+2*o,!0)+r;i[4*a+0]=e[4*u+0],i[4*a+1]=e[4*u+1],i[4*a+2]=e[4*u+2],i[4*a+3]=e[4*u+3]},w.readMappedPixel16=function(t,e,r,n,o,i,a){var u=t.getUint16(n+2*o,!0)+r;i[4*a+0]=e[4*u+0],i[4*a+1]=e[4*u+1],i[4*a+2]=e[4*u+2],i[4*a+3]=e[4*u+3]},w.readMappedPixel24=function(t,e,r,n,o,i,a){var u=t.getUint16(n+2*o,!0)+r;i[4*a+0]=e[4*u+0],i[4*a+1]=e[4*u+1],i[4*a+2]=e[4*u+2],i[4*a+3]=e[4*u+3]},w.readMappedPixel32=function(t,e,r,n,o,i,a){var u=t.getUint16(n+2*o,!0)+r;i[4*a+0]=e[4*u+0],i[4*a+1]=e[4*u+1],i[4*a+2]=e[4*u+2],i[4*a+3]=e[4*u+3]},w.readRLEImage=function(){throw"NYI"},w.readColormappedImage=function(t){var e,r,n,o,i=t.dataview,a=t.header,u=t.colorMap,c=a.imageSpec.width,s=a.imageSpec.height,f=new Uint8ClampedArray(c*s*4),l=a.imageSpec.pixelDepth,p=18+a.idLength+a.colorMapSpec.length*a.colorMapSpec.entrySizeBytes,h=a.colorMapSpec.firstEntry,y=null,b=2==(2&a.imageSpec.origin)?1:-1,d=1==(1&a.imageSpec.origin)?-1:1;if(!u)throw"Image is described as color-mapped, but has no map";switch(l){case 8:y=w.readMappedPixel8;break;case 16:y=w.readMappedPixel15;break;case 15:y=w.readMappedPixel16;break;case 24:y=w.readMappedPixel24;break;case 32:y=w.readMappedPixel32;break;default:throw"Unsupported pixel depth"}b>0?(e=0,r=s):(e=s-1,r=-1),d>0?(n=0,o=c):(n=c-1,o=-1);for(var m,v=0,O=e;O!=r;O+=b){m=0;for(var g=n;g!=o;g+=d)y(i,u,h,p,O*c+g,f,v*c+m++);v++}return f},w.readTruecolorImage=function(t){var e,r,n,o,i=t.header,a=t.dataview,u=i.imageSpec.width,c=i.imageSpec.height,s=new Uint8ClampedArray(u*c*4),f=i.imageSpec.pixelDepth,l=18+i.idLength+i.colorMapSpec.length*i.colorMapSpec.entrySizeBytes,p=null,h=2==(2&i.imageSpec.origin)?1:-1,y=1==(1&i.imageSpec.origin)?-1:1;switch(f){case 8:p=w.readPixel8;break;case 16:p=w.readPixel15;break;case 15:p=w.readPixel16;break;case 24:p=w.readPixel24;break;case 32:p=w.readPixel32;break;default:throw"Unsupported pixel depth"}h>0?(e=0,r=c):(e=c-1,r=-1),y>0?(n=0,o=u):(n=u-1,o=-1);for(var b,d=0,m=e;m!=r;m+=h){b=0;for(var v=n;v!=o;v+=y)p(a,l,m*u+v,s,d*u+b++);d++}return s},w.readImage=function(t){if(t.header.compressed)return w.readRLEImage(t);if(0===t.header.mapType)return w.readTruecolorImage(t);if(1===t.header.mapType)return w.readColormappedImage(t);throw"Unsupported map type"};var O={readFile:function(t){return new w(t)},loadFile:function(t,e){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="arraybuffer",r.onload=function(){e(null,new w(this.response))},r.onerror=function(t){e(t,null)},r.send()},TGA:w,VERSION:"0.3.1"};const g=O;function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._callbacks={},this._assets={}}var e,r,n;return e=t,r=[{key:"loadAsset",value:function(e,r){var n=this,o="_"+encodeURIComponent(e);return this._assets[o]?Promise.resolve(this._assets[o]):new Promise((function(i,a){n._callbacks[o]=n._callbacks[o]||[],n._callbacks[o].push({resolve:i,reject:a}),n._assets.hasOwnProperty(o)||(n._assets[o]=!1,t.loadResource(e,r).then((function(t){var e;for(n._assets[o]=t;e=n._callbacks[o].shift();)e.resolve(t)})).catch((function(t){for(var e;e=n._callbacks[o].shift();)e.reject(t)})))}))}},{key:"loadAssetGroup",value:function(t,e){var r=this;if(t.length!==e.length)throw"Incompatible types: types.length = "+e.length+"; urls.length = "+t.length;return Promise.all(t.map((function(t,n){return r.loadAsset(t,e[n])})))}},{key:"getAsset",value:function(t){return this._assets[t]}}],n=[{key:"loadResource",value:function(t,e){return new Promise((function(r,n){if("image"===e||"image.co"===e)if(/\.tga$/.test(t))g.loadFile(t,(function(t,e){if(t)n(t);else{var o=document.createElement("canvas"),i=o.getContext("2d"),a=i.createImageData(e.width,e.height);a.data.set(e.imageData),o.height=e.height,o.width=e.width,i.putImageData(a,0,0);var u=new Image;u.onload=function(){r(this)},u.onerror=function(t){n(t)},u.src=o.toDataURL()}}));else{var o=new Image;"image.co"===e&&(o.crossOrigin="anoymous"),o.onload=function(){r(this)},o.onerror=function(t){n(t)},o.src=t}else{var i=new XMLHttpRequest;i.open("GET",t),i.responseType=e,i.onload=function(){r(this.response)},i.onerror=function(t){n(t)},i.send()}}))}}],r&&P(e.prototype,r),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();const R=_;function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function E(t,e){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},E(t,e)}function S(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}var k="triangles",x="lines",C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&E(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=T(n);if(o){var r=T(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return S(this,t)});function a(t,e,r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,t)).attributes=e,o.faces=r,o.lines=n,o.bounds=null,o.center=null,o}return e=a,r=[{key:"draw",value:function(t,e){e=e||k,this.attributes.draw(t),e===k?this.faces.draw():e===x&&this.lines.draw()}},{key:"boundingBox",value:function(t){if(!this.bounds){t=void 0===t?0:t;var e={max:null,min:null};this.attributes.eachAttribute(t,(function(t){e.max?e.max=e.max.map((function(e,r){return Math.max(e,t[r])})):e.max=Array.prototype.slice.call(t),e.min?e.min=e.min.map((function(e,r){return Math.min(e,t[r])})):e.min=Array.prototype.slice.call(t)})),this.bounds=e}return this.bounds}},{key:"centerOfMass",value:function(t){if(!this.center){t=void 0===t?0:t;var e=null,r=0;this.attributes.eachAttribute(t,(function(t){r++,e=e?e.map((function(e,r){return e+t[r]})):Array.prototype.slice.call(t)})),this.center=e.map((function(t){return t/r}))}return this.center}},{key:"boundingBoxCenter",value:function(t){return this.bounds||this.boundingBox(t),this.bounds.max.map(function(t,e){return(t-this.bounds.min[e])/2}.bind(this))}}],r&&M(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(v);C.MODE_LINES=x,C.MODE_TRIANGLES=k;const A=C;function D(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function U(t,e,r){return e&&D(t.prototype,e),r&&D(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}const I=U((function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.size=r,this.type=n}));function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(t,e){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},B(t,e)}function N(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return X(t)}function X(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=G(n);if(o){var r=G(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return N(this,t)});function a(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t)).target=e||t.ARRAY_BUFFER,n.usage=r||t.STATIC_DRAW,n.glBuf=null,n.values=null,N(n,X(n))}return e=a,r=[{key:"bindBuffer",value:function(){if(!this.values)throw new Error("trying to update a buffer with no values.");return this.glBuf||(this.glBuf=this._gl.createBuffer()),this._gl.bindBuffer(this.target,this.glBuf),this}},{key:"unbindBuffer",value:function(){return this}},{key:"update",value:function(){return this.bindBuffer(),this._gl.bufferData(this.target,this.values,this.usage),this}},{key:"setValues",value:function(t,e){return this.values?this.values.set(t,e):this.values=t,this.update(),this}},{key:"deleteWithin",value:function(t,e){if(!this.values)throw new Error("Trying to splice a buffer that has no values.");var r=e-t,n=new this.values.constructor(r);return this.values.set(this.values.subarray(e),t),this.values.set(n,this.values.length-r),this.update(),this}},{key:"map",value:function(t,e,r){e=void 0===e?0:e,r=void 0===r?this.values.length:r;for(var n=e;n<r;n++)this.values[n]=t(this.values[n],n);return this}},{key:"updateBuffer",value:function(t){return this.values=t,this.update()}}],r&&F(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(v);const q=V;function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}function z(t,e){if(e&&("object"===H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Y(t)}function Y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function J(t){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},J(t)}const Z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=J(n);if(o){var r=J(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return z(this,t)});function a(t,e,r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),n=n||t.STATIC_DRAW,(o=i.call(this,t,t.ELEMENT_ARRAY_BUFFER,n)).mode=r,o.values=e,o.count=null,z(o,Y(o))}return e=a,(r=[{key:"draw",value:function(){var t=this._gl;return this.glBuf?this.bindBuffer():this.update(),t.drawElements(this.mode,this.values.length,t.UNSIGNED_SHORT,0),this}}])&&W(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(q);function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}function et(t,e){if(e&&("object"===$(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return rt(t)}function rt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function nt(t){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nt(t)}var ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=nt(n);if(o){var r=nt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return et(this,t)});function a(t,e,r,n){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),n=n||t.STATIC_DRAW,(o=i.call(this,t,t.ARRAY_BUFFER,n)).attributes=e,o.values=r,o.size=o.count=null,o._validate=!1,o.size=0,o.width=0;for(var u,c=0;c<o.attributes.length;c++)u=o.attributes[c],o.size+=4*u.size,o.width+=u.size;return et(o,rt(o))}return e=a,r=[{key:"validate",value:function(){this._validate&&this.values.length%this.width!=0&&console.warn("values array length is not an even multiple of the total size of the attributes")}},{key:"updateValues",value:function(t){return this.values=t,this.validate(),this.update()}},{key:"draw",value:function(t){var e,r=this._gl,n=0;this.glBuf?this.bindBuffer():this.update();for(var o=0;o<this.attributes.length;o++)(e=this.attributes[o]).name in t&&(r.enableVertexAttribArray(t[e.name]),r.vertexAttribPointer(t[e.name],e.size,r.FLOAT,!1,this.size,n)),n+=4*e.size;return this}},{key:"eachAttribute",value:function(t,e){var r,n,o=0;if(t>=0&&t<this.attributes.length){for(n=0;n<t;n++)o+=this.attributes[n].size;for(r=this.attributes[t].size,n=o;n<this.values.length;n+=this.width)e(this.values.subarray(n,n+r))}return this}}],r&&Q(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(q);const it=ot;class at{constructor(t){this.buffer=t,this.stream=new class{constructor(t){this.buffer=t,this.dataview=new DataView(t),this.currentOffset=0}getLength(){return this.dataview.byteLength}getPosition(){return this.currentOffset}readUint32(){var t=this.dataview.getUint32(this.currentOffset);return this.currentOffset+=4,t}readUint16(){var t=this.dataview.getUint16(this.currentOffset);return this.currentOffset+=2,t}readUint8(){var t=this.dataview.getUint8(this.currentOffset);return this.currentOffset++,t}readInt32(){var t=this.dataview.getInt32(this.currentOffset);return this.currentOffset+=4,t}readInt16(){var t=this.dataview.getInt16(this.currentOffset);return this.currentOffset+=2,t}readInt8(){var t=this.dataview.getInt8(this.currentOffset);return this.currentOffset++,t}readFloat32(){var t=this.dataview.getFloat32(this.currentOffset);return this.currentOffset+=4,t}readUtf8String(){for(var t=this.readUint16(),e="",r=0;r<t;r++)e+=String.fromCharCode(this.readUint8());return e}readFloat32Array(t){for(var e=new Float32Array(t),r=0;r<t;r++)e[r]=this.readFloat32();return e}readUint16Array(t){for(var e=new Uint16Array(t),r=0;r<t;r++)e[r]=this.readUint16();return e}readUint8Array(t){var e=new Uint8Array(this.buffer,this.currentOffset,t);return this.currentOffset+=t,e}}(t),this.repr=null,this.refs=[],this._checkMagic()}_checkMagic(){if(44269!==this.stream.readUint16())throw"invalid magic number!";if(5!==this.stream.readUint16())throw"invalid version!"}_readClassDescription(){var t=this.stream.readUint8(),e={};if(112!==t){if(113===t){var r=this.stream.readUint32()-8257536;return this.refs[r]}if(114===t){e.name=this.stream.readUtf8String(),e.versionId=[this.stream.readUint32(),this.stream.readUint32()],e.handle=this.refs.length,e.flags=this.stream.readUint8();for(var n=[],o=this.stream.readUint16(),i=0;i<o;i++){var a={};a.type=this.stream.readUint8(),a.name=this.stream.readUtf8String(),-1==="BCDFIJSZ".indexOf(String.fromCharCode(a.type))&&console.log("this is not a primitive type: "+a.type),n.push(a)}return e.fields=n,e.annotation=this.stream.readUint8(),120!==e.annotation&&console.log("I don't know what to do with this: "+e.annotation),e.superClass=this._readClassDescription(),this.refs.push(e),e}console.log("I don't know how to handle this type yet: "+t)}}_readArray(){var t,e,r={},n=this._readClassDescription();r.description=n,r.handle=this.refs.length,e=this.stream.readUint32();var o=n.name;if("[F"===o)r.elements=this.stream.readFloat32Array(e);else if("[S"===o)r.elements=this.stream.readUint16Array(e);else for(r.elements=[],t=0;t<e;t++){var i=this._readChunk();r.elements.push(i)}return this.refs.push(r),r}_readBlockData(){var t=this.stream.readUint8();return this.stream.readUint8Array(t)}_readChunk(){var t=null;switch(this.stream.readUint8()){case 117:t=this._readArray();break;case 119:t=this._readBlockData();break;case 116:t=this.stream.readUtf8String();break;default:console.log("unhandled type")}return t}getContents(){if(this.repr)return this.repr;for(this.repr=[];this.stream.getPosition()<this.stream.getLength();)this.repr.push(this._readChunk());return this.repr}}at.VERSION="0.3.1";const ut=at;function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function st(t,e){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},st(t,e)}function ft(t,e){if(e&&("object"===ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function lt(t){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lt(t)}var pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&st(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lt(r);if(n){var o=lt(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return ft(this,t)});function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var r=new ut(e).getContents(),n=r[0].elements,a=function(t){var e,r,n,o,i,a=new DataView(t.buffer,t.byteOffset,t.byteLength),u=0,c=a.getUint32(u);u+=4;for(var s=[],f=0;f<c;f++){for(e=a.getUint32(u),u+=4,r=a.getUint32(u),u+=4,n=a.getUint16(u),u+=2,i="",o=0;o<n;o++)i+=String.fromCharCode(a.getUint8(u+o));u+=n,s.push(new I(i,r,e))}return s}(r[3]),u=new Z(t,r[1].elements,t.TRIANGLES),c=new it(t,a,n),s=new Z(t,r[2].elements,t.LINES);return o.call(this,t,c,u,s)}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(A);const ht=pt;function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dt(t,e){return dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dt(t,e)}function mt(t,e){if(e&&("object"===yt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(t)}const wt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dt(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vt(n);if(o){var r=vt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return mt(this,t)});function a(t,e,r){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t)).info=e;var o={MipMapLinearLinear:t.LINEAR_MIPMAP_LINEAR,Linear:t.LINEAR,MipMapLinearNearest:t.LINEAR_MIPMAP_NEAREST,MipMapNearestLinear:t.NEAREST_MIPMAP_LINEAR,Repeat:t.REPEAT,ClampToEdge:t.CLAMP_TO_EDGE},u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o[e.minFilter]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,o[e.magFilter]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,o[e.wrapS]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o[e.wrapT]),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),/MipMap/.test(e.minFilter)&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),n.texture=u,n}return e=a,(r=[{key:"use",value:function(t){var e=this._gl;t=t||0,e.bindTexture(e.TEXTURE_2D,this.texture),e.activeTexture(e.TEXTURE0+t)}},{key:"dispose",value:function(){}}])&&bt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(v);function Ot(t){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(t)}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pt(t,e){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pt(t,e)}function _t(t,e){if(e&&("object"===Ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rt(t){return Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Rt(t)}function jt(t,e,r,n){var o,i,a=r.name,u=t.getUniformLocation(e,a),c=r.type,s=!1,f=!0;if(r.size>1&&n)switch(c){case t.FLOAT:o=t.uniform1fv,i=Float32Array,f=!1;break;case t.INT:case t.BOOL:case t.SAMPLER_2D:case t.SAMPLER_CUBE:o=t.uniform1iv,i=Uint16Array,f=!1}if(f)switch(c){case t.FLOAT:o=t.uniform1f;break;case t.FLOAT_VEC2:o=t.uniform2fv,i=n?Float32Array:new Float32Array(2);break;case t.FLOAT_VEC3:o=t.uniform3fv,i=n?Float32Array:new Float32Array(3);break;case t.FLOAT_VEC4:o=t.uniform4fv,i=n?Float32Array:new Float32Array(4);break;case t.INT:case t.BOOL:case t.SAMPLER_2D:case t.SAMPLER_CUBE:o=t.uniform1i;break;case t.INT_VEC2:case t.BOOL_VEC2:o=t.uniform2iv,i=n?Uint16Array:new Uint16Array(2);break;case t.INT_VEC3:case t.BOOL_VEC3:o=t.uniform3iv,i=n?Uint16Array:new Uint16Array(3);break;case t.INT_VEC4:case t.BOOL_VEC4:o=t.uniform4iv,i=n?Uint16Array:new Uint16Array(4);break;case t.FLOAT_MAT2:s=!0,o=t.uniformMatrix2fv;break;case t.FLOAT_MAT3:s=!0,o=t.uniformMatrix3fv;break;case t.FLOAT_MAT4:s=!0,o=t.uniformMatrix4fv}if(o.bind)o=o.bind(t);else{var l=o;o=function(){l.apply(t,arguments)}}return n&&i?function(t){o(u,new i(t))}:s?function(t){o(u,!1,t)}:i?function(t){i.set(t.toFloat32Array?t.toFloat32Array():t),o(u,i)}:function(t){o(u,t)}}var Mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Rt(o);if(i){var r=Rt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _t(this,t)});function u(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=a.call(this,t)).program=null,n.vertexSource=u.fixPrecision(e),n.fragmentSource=r,n.attributes={},n.uniforms={},n}return e=u,r=[{key:"init",value:function(){var t,e,r=this._gl;if(t=r.createShader(r.VERTEX_SHADER),r.shaderSource(t,this.vertexSource),r.compileShader(t),!r.getShaderParameter(t,r.COMPILE_STATUS))throw console.warn(r.getShaderInfoLog(t)),console.error("could not compile vertex shader: "+this.vertexSource),"Vertex shader compile error!";if(e=r.createShader(r.FRAGMENT_SHADER),r.shaderSource(e,this.fragmentSource),r.compileShader(e),!r.getShaderParameter(e,r.COMPILE_STATUS))throw console.warn(r.getShaderInfoLog(e)),console.error("could not compile fragment shader: "+this.fragmentSource),"Fragment shader compile error!";if(this.program=r.createProgram(),r.attachShader(this.program,t),r.attachShader(this.program,e),r.linkProgram(this.program),!r.getProgramParameter(this.program,r.LINK_STATUS))throw"Could not link program";r.useProgram(this.program),this._setupLocations()}},{key:"use",value:function(t){var e=this._gl;this.program?e.useProgram(this.program):this.init(),t(this.attributes,this.uniforms)}},{key:"_setupLocations",value:function(){for(var t,e,r=this._gl,n=this.program,o=r.getProgramParameter(n,r.ACTIVE_ATTRIBUTES),i=0;i<o;i++)t=r.getActiveAttrib(n,i),this.attributes[t.name]=r.getAttribLocation(n,t.name);for(o=r.getProgramParameter(n,r.ACTIVE_UNIFORMS),i=0;i<o;i++)e="]"==(e=(t=r.getActiveUniform(n,i)).name)[e.length-1]?e.substr(0,e.length-3):e,this.uniforms[e]=jt(r,n,t,t.name!=e)}}],n=[{key:"fixPrecision",value:function(t){if(/precision mediump float/g.test(t))return t;var e=t.split("\n");return e.splice(1,0,"#ifdef GL_ES","precision mediump float;","#endif"),e.join("\n")}}],r&&gt(e.prototype,r),n&&gt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(v);const Et=Mt;function St(){var t=new o(16);return o!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Tt(t,e,r){var n=e[0],o=e[1],i=e[2],a=e[3],u=e[4],c=e[5],s=e[6],f=e[7],l=e[8],p=e[9],h=e[10],y=e[11],b=e[12],d=e[13],m=e[14],v=e[15],w=r[0],O=r[1],g=r[2],P=r[3];return t[0]=w*n+O*u+g*l+P*b,t[1]=w*o+O*c+g*p+P*d,t[2]=w*i+O*s+g*h+P*m,t[3]=w*a+O*f+g*y+P*v,w=r[4],O=r[5],g=r[6],P=r[7],t[4]=w*n+O*u+g*l+P*b,t[5]=w*o+O*c+g*p+P*d,t[6]=w*i+O*s+g*h+P*m,t[7]=w*a+O*f+g*y+P*v,w=r[8],O=r[9],g=r[10],P=r[11],t[8]=w*n+O*u+g*l+P*b,t[9]=w*o+O*c+g*p+P*d,t[10]=w*i+O*s+g*h+P*m,t[11]=w*a+O*f+g*y+P*v,w=r[12],O=r[13],g=r[14],P=r[15],t[12]=w*n+O*u+g*l+P*b,t[13]=w*o+O*c+g*p+P*d,t[14]=w*i+O*s+g*h+P*m,t[15]=w*a+O*f+g*y+P*v,t}function kt(t,e,r){var n,o,i,a,u,c,s,f,l,p,h,y,b=r[0],d=r[1],m=r[2];return e===t?(t[12]=e[0]*b+e[4]*d+e[8]*m+e[12],t[13]=e[1]*b+e[5]*d+e[9]*m+e[13],t[14]=e[2]*b+e[6]*d+e[10]*m+e[14],t[15]=e[3]*b+e[7]*d+e[11]*m+e[15]):(n=e[0],o=e[1],i=e[2],a=e[3],u=e[4],c=e[5],s=e[6],f=e[7],l=e[8],p=e[9],h=e[10],y=e[11],t[0]=n,t[1]=o,t[2]=i,t[3]=a,t[4]=u,t[5]=c,t[6]=s,t[7]=f,t[8]=l,t[9]=p,t[10]=h,t[11]=y,t[12]=n*b+u*d+l*m+e[12],t[13]=o*b+c*d+p*m+e[13],t[14]=i*b+s*d+h*m+e[14],t[15]=a*b+f*d+y*m+e[15]),t}function xt(t,e,r){var n=r[0],o=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ct(t,e,r){var n=Math.sin(r),o=Math.cos(r),i=e[0],a=e[1],u=e[2],c=e[3],s=e[8],f=e[9],l=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*o-s*n,t[1]=a*o-f*n,t[2]=u*o-l*n,t[3]=c*o-p*n,t[8]=i*n+s*o,t[9]=a*n+f*o,t[10]=u*n+l*o,t[11]=c*n+p*o,t}function At(){var t=new o(3);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dt(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Ut(t,e,r){var n=new o(3);return n[0]=t,n[1]=e,n[2]=r,n}function It(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Lt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Ft(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Bt(t,e){var r=e[0],n=e[1],o=e[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Nt(t,e,r){var n=e[0],o=e[1],i=e[2],a=r[0],u=r[1],c=r[2];return t[0]=o*c-i*u,t[1]=i*a-n*c,t[2]=n*u-o*a,t}function Xt(t,e,r){var n=e[0],o=e[1],i=e[2],a=r[3]*n+r[7]*o+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*o+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*o+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*o+r[10]*i+r[14])/a,t}function Gt(){var t=new o(9);return o!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Vt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function qt(){var t=new o(4);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}At();var Ht=(At(),Ut(1,0,0),Ut(0,1,0),qt(),qt(),Gt(),{linear:function(t){return t}});Ht.none=Ht.linear,Ht.get=function(t){return t<-1&&(t=-1),t>1&&(t=1),function(e){return 0===t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},Ht.getPowIn=function(t){return function(e){return Math.pow(e,t)}},Ht.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},Ht.getPowInOut=function(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},Ht.quadIn=Ht.getPowIn(2),Ht.quadOut=Ht.getPowOut(2),Ht.quadInOut=Ht.getPowInOut(2),Ht.cubicIn=Ht.getPowIn(3),Ht.cubicOut=Ht.getPowOut(3),Ht.cubicInOut=Ht.getPowInOut(3),Ht.quartIn=Ht.getPowIn(4),Ht.quartOut=Ht.getPowOut(4),Ht.quartInOut=Ht.getPowInOut(4),Ht.quintIn=Ht.getPowIn(5),Ht.quintOut=Ht.getPowOut(5),Ht.quintInOut=Ht.getPowInOut(5),Ht.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},Ht.sineOut=function(t){return Math.sin(t*Math.PI/2)},Ht.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},Ht.getBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},Ht.backIn=Ht.getBackIn(1.7),Ht.getBackOut=function(t){return function(e){return--e*e*((t+1)*e+t)+1}},Ht.backOut=Ht.getBackOut(1.7),Ht.getBackInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Ht.backInOut=Ht.getBackInOut(1.7),Ht.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},Ht.circOut=function(t){return Math.sqrt(1- --t*t)},Ht.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},Ht.bounceIn=function(t){return 1-Ht.bounceOut(1-t)},Ht.bounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},Ht.bounceInOut=function(t){return t<.5?.5*Ht.bounceIn(2*t):.5*Ht.bounceOut(2*t-1)+.5},Ht.getElasticIn=function(t,e){var r=2*Math.PI;return function(n){if(0===n||1===n)return n;var o=e/r*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-o)*r/e)}},Ht.elasticIn=Ht.getElasticIn(1,.3),Ht.getElasticOut=function(t,e){var r=2*Math.PI;return function(n){if(0===n||1===n)return n;var o=e/r*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-o)*r/e)+1}},Ht.elasticOut=Ht.getElasticOut(1,.3),Ht.getElasticInOut=function(t,e){var r=2*Math.PI;return function(n){var o=e/r*Math.asin(1/t);return(n*=2)<1?t*Math.pow(2,10*(n-=1))*Math.sin((n-o)*r/e)*-.5:t*Math.pow(2,-10*(n-=1))*Math.sin((n-o)*r/e)*.5+1}},Ht.elasticInOut=Ht.getElasticInOut(1,.3*1.5);const Wt=Ht;function Kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const zt=function(){function t(e,r,n,o){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.elapsed=0,this.duration=e,this.transform=r,this.timing=n||Wt.linear,this.loop=o,this.running=!1,this.next=[],this}var e,r;return e=t,(r=[{key:"start",value:function(){return this.running||(this.running=!0),this}},{key:"stop",value:function(){return this.elapsed=0,this.pause()}},{key:"pause",value:function(){return this.running&&(this.running=!1),this}},{key:"step",value:function(t,e){if(!this.running)return!1;if(this.elapsed+=t,this.elapsed>this.duration&&!this.loop){var r=this.timing(1);return this.transform(r,e),this.stop(),!0}var n=this.timing(this.elapsed/this.duration%1);return this.transform(n,e),!1}},{key:"chain",value:function(e){if(!(e instanceof t))throw new Error("New animation should be an instance of an Animation");return this.next.push(e),this}}])&&Kt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Jt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._animations=[]}var e,r;return e=t,r=[{key:"addAnimation",value:function(t){if(!(t instanceof zt))throw new Error("New animation should be an instance of an Animation");return this._animations.unshift(t),this}},{key:"runAnimations",value:function(t,e){for(var r=this._animations.length-1;r>=0;r--){var n=this._animations[r];n.running&&n.step(t,e)&&this._animations.splice.apply(this._animations,[r,1].concat(n.next))}}}],r&&Yt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Zt=Jt;function $t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Qt=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.programName=e,this.meshName=r,this.mesh=null,this.program=null,this.uniforms={},this.drawfn=this._draw.bind(this),this.elapsed=0,this.ready=!1,this.viewProject=St(),this._translate=At(),this._rotate=qt(),this._scale=Ut(1,1,1),this._model=St(),this._ray=At(),this.local=St(),this.world=St(),this.uniforms.u_modelViewProject=St(),this.children=[],this.drawMode=A.MODE_TRIANGLES,this.animator=new Zt}var e,r;return e=t,r=[{key:"_loadAssets",value:function(t){var e=this,r=[];return this.meshName&&r.push(t.loadMesh(this.meshName).then((function(t){return e.mesh=t,t})).catch((function(t){return console.warn("missing mesh "+e.meshName),Promise.reject(t)}))),this.programName&&r.push(t.loadProgram(this.programName).then((function(t){return e.program=t,t})).catch((function(t){return console.warn("missing program"+e.programName),Promise.reject(t)}))),r}},{key:"init",value:function(t){var e=this,r=this._loadAssets(t);return Promise.all(r).then((function(){return e.ready=!0,e}))}},{key:"setDrawFn",value:function(t){return this.drawfn=t,this}},{key:"draw",value:function(){this.ready&&this.program&&this.program.use(this.drawfn)}},{key:"setUniform",value:function(t,e){return this.uniforms[t]=e,this}},{key:"updateTime",value:function(t){return this.elapsed+=t,this.animator.runAnimations(t,this),!0}},{key:"addChild",value:function(e){if(!(e instanceof t))throw new Error("Child drawable should be an instance of Drawable");e.updateWorld(this._model),this.children.push(e)}},{key:"updateMatrix",value:function(){var t,e,r,n,o,i,a,u,c,s,f,l,p,h,y,b,d,m,v,w=this,O=St();t=O,e=this._rotate,r=this._translate,n=e[0],o=e[1],i=e[2],a=e[3],f=n*(u=n+n),l=n*(c=o+o),p=n*(s=i+i),h=o*c,y=o*s,b=i*s,d=a*u,m=a*c,v=a*s,t[0]=1-(h+b),t[1]=l+v,t[2]=p-m,t[3]=0,t[4]=l-v,t[5]=1-(f+b),t[6]=y+d,t[7]=0,t[8]=p+m,t[9]=y-d,t[10]=1-(f+h),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,xt(this.local,O,this._scale),Tt(this._model,this.world,this.local),Tt(this.uniforms.u_modelViewProject,this.viewProject,this._model),this.children.forEach((function(t){t.updateWorld(w._model)}))}},{key:"updateWorld",value:function(t){this.world=t,this.updateMatrix()}},{key:"updateView",value:function(t){this.viewProject=t,this.updateMatrix(),this.updateRay()}},{key:"updateRay",value:function(){It(this._ray,this._translate),Xt(this._ray,this._ray,this.world),Xt(this._ray,this._ray,this.viewProject)}},{key:"translate",value:function(t){Lt(this._translate,this._translate,t),this.updateMatrix(),this.updateRay()}},{key:"setTranslation",value:function(t){this._translate=At(),this.translate(t)}},{key:"scale",value:function(t){var e,r,n;e=this._scale,r=this._scale,n=t,e[0]=r[0]*n[0],e[1]=r[1]*n[1],e[2]=r[2]*n[2],this.updateMatrix()}},{key:"setScale",value:function(t){this._scale=Ut(1,1,1),this.scale(t)}},{key:"rotate",value:function(t){var e,r,n,o,i,a,u,c,s,f,l;e=this._rotate,r=this._rotate,n=t,o=r[0],i=r[1],a=r[2],u=r[3],c=n[0],s=n[1],f=n[2],l=n[3],e[0]=o*l+u*c+i*f-a*s,e[1]=i*l+u*s+a*c-o*f,e[2]=a*l+u*f+o*s-i*c,e[3]=u*l-o*c-i*s-a*f,this.updateMatrix()}},{key:"setRotation",value:function(t){this._rotate=qt(),this.rotate(t)}},{key:"translateX",value:function(t){this.translate(Ut(t,0,0))}},{key:"translateY",value:function(t){this.translate(Ut(0,t,0))}},{key:"translateZ",value:function(t){this.translate(Ut(0,0,t))}},{key:"scalarScale",value:function(t){this.scale(Ut(t,t,t))}},{key:"setScalarScale",value:function(t){this.setScale(Ut(t,t,t))}},{key:"setDrawMode",value:function(t){var e=[A.MODE_TRIANGLES,A.MODE_LINES];if(-1===e.indexOf(t))throw new Error("mode should be one of "+e.join(", "));this.drawMode=t}},{key:"drawLines",value:function(){this.setDrawMode(A.MODE_LINES)}},{key:"drawFaces",value:function(){this.setDrawMode(A.MODE_TRIANGLES)}},{key:"dispose",value:function(){}},{key:"addAnimation",value:function(t){return this.animator.addAnimation(t),this}},{key:"_draw",value:function(t,e){for(var r in this.uniforms)this.uniforms.hasOwnProperty(r)&&r in e&&e[r](this.uniforms[r]);this.mesh.draw(t,this.drawMode)}}],r&&$t(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const te=Qt;function ee(t){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ee(t)}function re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ne(){return ne="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=oe(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},ne.apply(this,arguments)}function oe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ue(t)););return t}function ie(t,e){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ie(t,e)}function ae(t,e){if(e&&("object"===ee(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ue(t){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ue(t)}const ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ie(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ue(n);if(o){var r=ue(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ae(this,t)});function a(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t,e)).textureName=r,n.texture=null,n}return e=a,(r=[{key:"draw",value:function(){this.ready&&(this.texture.use(0),this.uniforms.u_texture=0,ne(ue(a.prototype),"draw",this).call(this))}},{key:"_loadAssets",value:function(t){var e=this,r=ne(ue(a.prototype),"_loadAssets",this).call(this,t);return r.push(t.loadTexture(this.textureName).then((function(t){e.texture=t})).catch((function(t){return console.warn("missing texture "+e.textureName),Promise.reject(t)}))),r}}])&&re(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(te);function se(t,e){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},se(t,e)}function fe(t,e){if(e&&("object"===pe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function le(t){return le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},le(t)}function pe(t){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(t)}function he(t){t.lineWidth(1),t.enable(t.CULL_FACE),t.frontFace(t.CCW),t.cullFace(t.BACK),t.enable(t.DEPTH_TEST),t.blendEquation(t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.disable(t.BLEND),t.depthMask(!0)}function ye(t,e,r){for(var n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(r&&"object"==pe(t[n])&&"object"==pe(e[n])?t[n]=ye(t[n],e[n],r):t[n]=e[n]);return t}function be(t,e){return function(r){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&se(t,e)}(u,r);var n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=le(o);if(i){var r=le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fe(this,t)});function u(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),a.call(this,b.Program.Textured,t,e)}return n=u,Object.defineProperty(n,"prototype",{writable:!1}),n}(ce)}function de(t){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(t)}function me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ve(t,e){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ve(t,e)}function we(t,e){if(e&&("object"===de(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Oe(t){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Oe(t)}function ge(t){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ge(t)}function Pe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _e(t,e){return _e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_e(t,e)}function Re(t,e){if(e&&("object"===ge(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function je(t){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},je(t)}function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}function Ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Se(t,e){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Se(t,e)}function Te(t,e){if(e&&("object"===Me(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ke(t){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ke(t)}var xe={Glowramp:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ve(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Oe(n);if(o){var r=Oe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return we(this,t)});function a(t,e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,t,e,r)}return e=a,(r=[{key:"use",value:function(t){this.program||this.init();var e=this._gl;e.useProgram(this.program),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.depthMask(!1),e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),t(this.attributes,this.uniforms),he(e)}}])&&me(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Et),Opaque:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_e(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=je(n);if(o){var r=je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Re(this,t)});function a(t,e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,t,e,r)}return e=a,(r=[{key:"use",value:function(t){this.program||this.init();var e=this._gl;e.useProgram(this.program),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK),e.depthMask(!0),t(this.attributes,this.uniforms),he(e)}}])&&Pe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Et)},Ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Se(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ke(n);if(o){var r=ke(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Te(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,t)).manifest=e,r.loader=new R,r.textures={},r.meshes={},r.programs={},r.queues={texture:[],mesh:[],program:[]},r.stats={texture:{},mesh:{},program:{},rawProgram:{}},r.path="/assets/",r}return e=a,r=[{key:"addAssets",value:function(t){var e,r;this.manifest=(e=this.manifest,r=t,["texture","mesh","program","rawProgram"].forEach((function(t){t in r&&(e[t]=function(t,e){for(var r in t=t||{},e)t[r]=e[r];return t}(e[t],r[t]))})),e)}},{key:"addTexture",value:function(t,e){this.textures[t]=e}},{key:"addMesh",value:function(t,e){this.meshes[t]=e}},{key:"addProgram",value:function(t,e){this.programs[t]=e}},{key:"loadTexture",value:function(t){var e=this;if(t in this.manifest.texture){if(this.textures[t])return this._recordUsage("texture",t),Promise.resolve(this.textures[t]);var r=this.manifest.texture[t];return this.loader.loadAsset(this._getFullPath(r.static,r.path),"image").then((function(n){return e.textures[t]||(e.textures[t]=new wt(e._gl,r,n)),e._recordUsage("texture",t),e.textures[t]}))}return Promise.reject(new Error("Unknown texture "+t))}},{key:"loadMesh",value:function(t){var e=this;if(t in this.manifest.mesh){if(this.meshes[t])return this._recordUsage("mesh",t),Promise.resolve(this.meshes[t]);var r=this.manifest.mesh[t];return this.loader.loadAsset(this._getFullPath(r.static,r.path),"arraybuffer").then((function(r){return e.meshes[t]||(e.meshes[t]=new ht(e._gl,r)),e._recordUsage("mesh",t),e.meshes[t]}))}return Promise.reject(new Error("Unknown mesh "+t))}},{key:"loadProgram",value:function(t){var e=this;if(t in this.manifest.program||t in this.manifest.rawProgram){if(this.programs[t])return this._recordUsage("program",t),Promise.resolve(this.programs[t]);if(t in this.manifest.rawProgram){var r=this.manifest.rawProgram[t];return new Promise((function(n){if(!e.programs[t]){var o=xe[r.program]||Et;e.programs[t]=new o(e._gl,r.vertex,r.fragment)}e._recordUsage("program",t),n(e.programs[t])}))}var n=this.manifest.program[t];return Promise.all([this.loader.loadAsset(this._getFullPath(n.static,n.vertex),"text"),this.loader.loadAsset(this._getFullPath(n.static,n.fragment),"text")]).then((function(r){if(!e.programs[t]){var o=xe[n.program]||Et;e.programs[t]=new o(e._gl,r[0],r[1])}return e._recordUsage("program",t),e.programs[t]}))}return Promise.reject(new Error("Unknown program "+t))}},{key:"loadAll",value:function(){var t=this,e=this.manifest;return Promise.all([Object.keys(e.texture).reduce((function(e,r){return e.then((function(){return t.loadTexture(r)}))}),Promise.resolve()),Object.keys(e.mesh).reduce((function(e,r){return e.then((function(){return t.loadMesh(r)}))}),Promise.resolve()),Object.keys(e.program).concat(Object.keys(e.rawProgram)).reduce((function(e,r){return e.then((function(){return t.loadProgram(r)}))}),Promise.resolve())])}},{key:"generateManifest",value:function(){var t={};return["texture","mesh","rawProgram","program"].forEach(function(e){for(var r in t[e]={},this.stats[e])this.stats[e].hasOwnProperty(r)&&this.stats[e][r]>0&&(t[e][r]=this.manifest[e][r])}.bind(this)),t}},{key:"_getFullPath",value:function(t,e){return(t?"":this.path)+e}},{key:"_recordUsage",value:function(t,e){this.stats[t][e]=(this.stats[t][e]||0)+1}}],r&&Ee(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(v);const Ae=Ce;function De(t){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De(t)}function Ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ie(t,e){return Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ie(t,e)}function Le(t,e){if(e&&("object"===De(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fe(t){return Fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fe(t)}var Be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ie(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fe(n);if(o){var r=Fe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Le(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,t)).manager=e,r.viewProject=St(),r.view=St(),r.project=St(),r.elapsed=0,r}return e=a,r=[{key:"updateView",value:function(t){this.view=t.view,this.project=t.project,Tt(this.viewProject,this.project,this.view)}},{key:"render",value:function(){throw new Error("render() must be implemented")}},{key:"updateTime",value:function(t){this.elapsed+=t}}],r&&Ue(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(v);function Ne(t){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne(t)}function Xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ge(){return Ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Ve(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ge.apply(this,arguments)}function Ve(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=We(t)););return t}function qe(t,e){return qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qe(t,e)}function He(t,e){if(e&&("object"===Ne(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function We(t){return We=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},We(t)}var Ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qe(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=We(n);if(o){var r=We(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return He(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,t,e)).drawables=[],r}return e=a,r=[{key:"addDrawable",value:function(t,e){var r=this;if(!(t instanceof te))return Promise.reject(new Error("Drawables must always inherit from the base Drawable"));var n=t.init(this.manager).catch((function(e){return console.warn("could not initialize drawable: ",t),Promise.reject(e)}));return t.updateView&&t.updateView(this.viewProject,null),this.drawables.push(t),e||t.children.forEach((function(t){r.addDrawable(t)})),n}},{key:"removeDrawable",value:function(t,e){for(var r=0;r<this.drawables.length;r++)if(this.drawables[r]===t)return this.drawables.splice(r,1),e?(t.dispose(),!0):t;return!1}},{key:"addEntity",value:function(t){for(var e in t.drawables)this.addDrawable(t.drawables[e])}},{key:"updateView",value:function(t){Ge(We(a.prototype),"updateView",this).call(this,t);var e,r=this.drawables.length;for(e=0;e<r;e++)this.drawables[e].updateView&&this.drawables[e].updateView(this.viewProject,t)}},{key:"render",value:function(){var t,e=this.drawables.length;for(t=0;t<e;t++)this.drawables[t].draw()}},{key:"updateTime",value:function(t){Ge(We(a.prototype),"updateTime",this).call(this,t);var e,r=this.drawables.length;for(e=0;e<r;e++)this.drawables[e].updateTime(t)||(this.drawables.splice(e,1),e--,r--)}}],r&&Xe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Be);const ze=Ke;function Ye(t){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(t)}function Je(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ze(){return Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=$e(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ze.apply(this,arguments)}function $e(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=er(t)););return t}function Qe(t,e){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qe(t,e)}function tr(t,e){if(e&&("object"===Ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function er(t){return er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},er(t)}var rr=b.Program.Glowramp,nr=l(b.teamColors.NEUTRAL);const or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qe(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=er(n);if(o){var r=er(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return tr(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,rr,t,e)).uniforms.u_baseColor=l(nr),r.uniforms.u_rotation=0,r.uniforms.u_rampTarget=0,r.uniforms.u_alpha=.6,r}return e=a,(r=[{key:"updateTime",value:function(t){var e=Ze(er(a.prototype),"updateTime",this).call(this,t),r=this.elapsed/5e3;return this.uniforms.u_rotation=r,this.uniforms.u_rampTarget=Math.sin(Math.PI/2*(r-Math.floor(r))),this.uniforms.u_alpha=.05*Math.sin(r)+.75,e}}])&&Je(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ce);function ir(t){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ir(t)}function ar(t,e){return ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ar(t,e)}function ur(t,e){if(e&&("object"===ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function cr(t){return cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cr(t)}var sr=b.Program.Bicolored,fr=l(b.qualityColors.VERY_RARE),lr=l(b.xmColors.coreGlow);const pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ar(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=cr(r);if(n){var o=cr(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return ur(this,t)});function i(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,sr,t,e)).uniforms.u_color0=l(fr),r.uniforms.u_color1=l(lr),r}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(ce);function hr(){var t=new o(2);return o!=Float32Array&&(t[0]=0,t[1]=0),t}function yr(t,e){var r=new o(2);return r[0]=t,r[1]=e,r}function br(t){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},br(t)}function dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mr(){return mr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=vr(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},mr.apply(this,arguments)}function vr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=gr(t)););return t}function wr(t,e){return wr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wr(t,e)}function Or(t,e){if(e&&("object"===br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gr(t){return gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gr(t)}hr();var Pr=b.Program.ShieldEffect,_r=l(b.teamColors.NEUTRAL),Rr=yr(.5,1.3),jr=Ut(.5,.5,.5);const Mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wr(t,e)}(u,t);var e,r,n,i,a=(n=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gr(n);if(i){var r=gr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Or(this,t)});function u(t,e){var r,n,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(r=a.call(this,Pr,t,e)).uniforms.u_color=l(_r),r.uniforms.u_rampTargetInvWidth=(n=Rr,(i=new o(2))[0]=n[0],i[1]=n[1],i),r.uniforms.u_contributionsAndAlpha=function(t){var e=new o(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}(jr),r}return e=u,(r=[{key:"updateTime",value:function(t){var e=mr(gr(u.prototype),"updateTime",this).call(this,t),r=this.elapsed/1e4;return this.uniforms.u_rampTargetInvWidth[0]=-(r-Math.floor(r)),this.uniforms.u_rampTargetInvWidth[1]=Math.sin((r-Math.floor(r))*Math.PI/2),e}}])&&dr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(ce);function Er(t){return Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Er(t)}function Sr(t,e){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sr(t,e)}function Tr(t,e){if(e&&("object"===Er(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function kr(t){return kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},kr(t)}var xr=b.Program.RegionTextured;const Cr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sr(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kr(r);if(n){var o=kr(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return Tr(this,t)});function i(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,xr,t,e)).uniforms.u_texCoordBase=yr(0,0),r.uniforms.u_texCoordExtent=yr(1,1),r.uniforms.u_color=l(b.teamColors.LOKI),r}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(ce);function Ar(t){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ar(t)}function Dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ur(t,e,r){return e&&Dr(t.prototype,e),r&&Dr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ir(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fr(t,e)}function Fr(t,e){return Fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fr(t,e)}function Br(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Xr(t);if(e){var o=Xr(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Nr(this,r)}}function Nr(t,e){if(e&&("object"===Ar(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Xr(t){return Xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Xr(t)}var Gr={},Vr=b.Mesh.World,qr=b.Texture;function Hr(t,e){return function(r){Lr(o,r);var n=Br(o);function o(){return Ir(this,o),n.call(this,t,e)}return Ur(o)}(or)}function Wr(t,e){return function(r){Lr(o,r);var n=Br(o);function o(){return Ir(this,o),n.call(this,t,e)}return Ur(o)}(Cr)}Gr.Portal=Hr(Vr.Portal,qr.Glowramp),Gr.Waypoint=Hr(Vr.Waypoint,qr.Waypoint),Gr.ArtifactsRedGlow=Hr(Vr.ArtifactsRedGlow,qr.ColorGlow),Gr.ArtifactsGreenGlow=Hr(Vr.ArtifactsGreenGlow,qr.ColorGlow),Gr.ArtifactsPurpleGlow=Hr(Vr.ArtifactsPurpleGlow,qr.ColorGlow),Gr.ArtifactsTargetGlow=Hr(Vr.ArtifactsTargetGlow,qr.TargetGlow),Gr.Shield=function(t,e){return function(r){Lr(o,r);var n=Br(o);function o(){return Ir(this,o),n.call(this,t,e)}return Ur(o)}(Mr)}(Vr.Shield,qr.ShieldEffect),Gr.Resonator=function(t,e){return function(r){Lr(o,r);var n=Br(o);function o(){return Ir(this,o),n.call(this,t,e)}return Ur(o)}(pr)}(Vr.Resonator,qr.FlipCard),Gr.OrnamentMeetupPoint=Wr(Vr.OrnamentMeetupPoint,qr.OrnamentMeetupPoint),Gr.OrnamentFinishPoint=Wr(Vr.OrnamentFinishPoint,qr.OrnamentFinishPoint),Gr.OrnamentCluster=Wr(Vr.OrnamentCluster,qr.OrnamentCluster),Gr.OrnamentVolatile=Wr(Vr.OrnamentVolatile,qr.OrnamentVolatile);const Kr=Gr;function zr(t){return zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zr(t)}function Yr(t,e){return Yr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yr(t,e)}function Jr(t,e){if(e&&("object"===zr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zr(t){return Zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zr(t)}var $r={},Qr=b.Mesh.Resource;function tn(t){return function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yr(t,e)}(a,e);var r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zr(n);if(o){var r=Zr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Jr(this,t)});function a(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.call(this,Qr[t],b.Texture.FlipCard)}return r=a,Object.defineProperty(r,"prototype",{writable:!1}),r}(pr)}for(var en in Qr)$r[name]=tn(en);const rn=$r;function nn(t){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(t)}function on(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function an(){return an="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=un(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},an.apply(this,arguments)}function un(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fn(t)););return t}function cn(t,e){return cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cn(t,e)}function sn(t,e){if(e&&("object"===nn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fn(t){return fn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fn(t)}var ln=b.Program.Xm,pn=l(b.xmColors.coreGlow),hn=l(b.xmColors.coreGlowAlt);const yn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cn(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fn(n);if(o){var r=fn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return sn(this,t)});function a(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,ln,t,e)).uniforms.u_elapsedTime=0,n.uniforms.u_teamColor=l(r||pn),n.uniforms.u_altColor=l(hn),n}return e=a,(r=[{key:"updateTime",value:function(t){var e=an(fn(a.prototype),"updateTime",this).call(this,t);return this.uniforms.u_elapsedTime=this.elapsed/1e3%300*.1,e}}])&&on(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ce);function bn(t){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bn(t)}function dn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mn(t,e,r){return e&&dn(t.prototype,e),r&&dn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&On(t,e)}function On(t,e){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},On(t,e)}function gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=_n(t);if(e){var o=_n(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Pn(this,r)}}function Pn(t,e){if(e&&("object"===bn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _n(t){return _n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_n(t)}var Rn={},jn=b.Mesh.Inventory,Mn=b.Texture;function En(t){return function(e){wn(n,e);var r=gn(n);function n(){return vn(this,n),r.call(this,jn[t],Mn.FlipCard)}return mn(n)}(pr)}function Sn(t){return function(e){wn(n,e);var r=gn(n);function n(){return vn(this,n),r.call(this,jn[t],Mn.Xm)}return mn(n)}(yn)}function Tn(t){return function(e){wn(n,e);var r=gn(n);function n(){return vn(this,n),r.call(this,b.Program.Textured,jn[t],b.Texture.FlipCard)}return mn(n)}(ce)}for(var kn in jn)if(/^Media/.test(kn)){if("MediaPlane"===kn)continue;Rn[kn]=Tn(kn)}else/Xm$/.test(kn)?Rn[kn]=Sn(kn):Rn[kn]=En(kn);const xn=Rn;function Cn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var An=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.drawables={},this.transform=St(),this.engine=e}var e,r;return e=t,r=[{key:"addDrawable",value:function(t,e){this.removeDrawable(t),this.drawables[t]=e,this.engine.objectRenderer.addDrawable(e)}},{key:"removeDrawable",value:function(t,e){this.drawables[t]&&this.engine.objectRenderer.removeDrawable(this.drawables[t],e)}},{key:"applyTransform",value:function(){for(var t in this.drawables)this.drawables[t].updateWorld(this.transform)}},{key:"translate",value:function(t){kt(this.transform,this.transform,t),this.applyTransform()}},{key:"rotate",value:function(t){var e,r,n,o,i,a,u,c,s,f,l,p,h,y,b,d,m,v,w=St();e=w,f=(n=(r=t)[0])*(u=n+n),l=(o=r[1])*u,p=o*(c=o+o),h=(i=r[2])*u,y=i*c,b=i*(s=i+i),d=(a=r[3])*u,m=a*c,v=a*s,e[0]=1-p-b,e[1]=l+v,e[2]=h-m,e[3]=0,e[4]=l-v,e[5]=1-f-b,e[6]=y+d,e[7]=0,e[8]=h+m,e[9]=y-d,e[10]=1-f-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,Tt(this.transform,this.transform,w),this.applyTransform()}},{key:"setAnimation",value:function(t){for(var e in this.drawables)this.drawables[e].onUpdate=t}}],r&&Cn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Dn=An;function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function In(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ln(t,e,r){return e&&In(t.prototype,e),r&&In(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nn(t,e)}function Nn(t,e){return Nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nn(t,e)}function Xn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Vn(t);if(e){var o=Vn(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Gn(this,r)}}function Gn(t,e){if(e&&("object"===Un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Vn(t){return Vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vn(t)}var qn={},Hn={Xmp:"L8",Ultrastrike:"L8",ResShield:"VERY_RARE",PowerCube:"L8",LinkAmp:"EXTREMELY_RARE",HeatSink:"VERY_RARE",MultiHack:"VERY_RARE",ForceAmp:"RARE",Turret:"RARE",Resonator:"L8",Capsule:"RARE"};function Wn(t,e){var r=function(r){Bn(o,r);var n=Xn(o);function o(r){var i;return Fn(this,o),(i=n.call(this,r)).addDrawable(t,new xn[t]),i.addDrawable(t+"Xm",new xn[t+"Xm"]),i.drawables[t].uniforms.u_color0=l(e),i}return Ln(o)}(Dn);return r}for(var Kn in Hn)qn[Kn]=Wn(Kn,b.qualityColors[Hn[Kn]]);var zn=function(t){Bn(r,t);var e=Xn(r);function r(t){var n;return Fn(this,r),(n=e.call(this,t)).addDrawable("FlipCardAda",new xn.FlipCardAda),n.addDrawable("FlipCardXm",new xn.FlipCardXm),n.drawables.FlipCardXm.uniforms.u_teamColor=l(b.teamColors.RESISTANCE),n.drawables.FlipCardAda.uniforms.u_color1=l(b.teamColors.RESISTANCE),n.drawables.FlipCardAda.uniforms.u_color0=l(b.qualityColors.VERY_RARE),n}return Ln(r)}(Dn);qn.FlipCardAda=zn;var Yn=function(t){Bn(r,t);var e=Xn(r);function r(t){var n;return Fn(this,r),(n=e.call(this,t)).addDrawable("FlipCardJarvis",new xn.FlipCardJarvis),n.addDrawable("FlipCardXm",new xn.FlipCardXm),n.drawables.FlipCardXm.uniforms.u_teamColor=l(b.teamColors.ENLIGHTENED),n.drawables.FlipCardJarvis.uniforms.u_color1=l(b.teamColors.ENLIGHTENED),n.drawables.FlipCardJarvis.uniforms.u_color0=l(b.qualityColors.VERY_RARE),n}return Ln(r)}(Dn);qn.FlipCardJarvis=Yn;var Jn=function(t){Bn(r,t);var e=Xn(r);function r(t){var n;return Fn(this,r),(n=e.call(this,t)).addDrawable("ExtraShield",new xn.ExtraShield),n.addDrawable("ResShieldXm",new xn.ResShieldXm),n.drawables.ExtraShield.uniforms.u_color0=l(b.qualityColors.VERY_RARE),n}return Ln(r)}(Dn);qn.ExtraShield=Jn;var Zn=function(t){Bn(r,t);var e=Xn(r);function r(t){var n;return Fn(this,r),(n=e.call(this,t)).addDrawable("InterestCapsule",new xn.InterestCapsule),n.addDrawable("CapsuleXm",new xn.CapsuleXm),n.drawables.InterestCapsule.uniforms.u_color0=l(b.qualityColors.VERY_RARE),n}return Ln(r)}(Dn);qn.InterestCapsule=Zn;var $n=function(t){Bn(r,t);var e=Xn(r);function r(t){var n;return Fn(this,r),(n=e.call(this,t)).addDrawable("PortalKey",new xn.PortalKeyResourceUnit),n}return Ln(r)}(Dn);qn.PortalKeyResourceUnit=$n;var Qn=function(t){Bn(r,t);var e=Xn(r);function r(t){var n;return Fn(this,r),(n=e.call(this,t)).addDrawable("KeyCapsule",new xn.KeyCapsule),n.addDrawable("KeyCapsuleXm",new xn.KeyCapsuleXm),n.drawables.KeyCapsule.uniforms.u_color0=l(b.keyCapsuleColors.blue[0]),n.drawables.KeyCapsule.uniforms.u_color1=l(b.keyCapsuleColors.blue[1]),n.drawables.KeyCapsuleXm.uniforms.u_teamColor=l(b.xmColors.coreGlowChaotic),n.drawables.KeyCapsuleXm.uniforms.u_altColor=l(b.xmColors.coreGlowChaoticAlt),n}return Ln(r)}(Dn);qn.KeyCapsule=Qn;const to=qn;function eo(t){return eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eo(t)}function ro(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function no(){return no="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=oo(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},no.apply(this,arguments)}function oo(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=uo(t)););return t}function io(t,e){return io=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},io(t,e)}function ao(t,e){if(e&&("object"===eo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function uo(t){return uo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uo(t)}var co=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&io(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=uo(n);if(o){var r=uo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ao(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,t,null,e)).uniforms.u_cameraFwd=Ut(0,0,-1),r.uniforms.u_elapsedTime=0,r}return e=a,r=[{key:"updateView",value:function(t,e){if(no(uo(a.prototype),"updateView",this).call(this,t,e),e){var r=Vt(Gt(),e.view),n=function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var i=(o+1)%3,a=(o+2)%3;r=Math.sqrt(e[3*o+o]-e[3*i+i]-e[3*a+a]+1),t[o]=.5*r,r=.5/r,t[3]=(e[3*i+a]-e[3*a+i])*r,t[i]=(e[3*i+o]+e[3*o+i])*r,t[a]=(e[3*a+o]+e[3*o+a])*r}return t}(qt(),r),o=function(t,e,r){var n=r[0],o=r[1],i=r[2],a=r[3],u=e[0],c=e[1],s=e[2],f=o*s-i*c,l=i*u-n*s,p=n*c-o*u,h=o*p-i*l,y=i*f-n*p,b=n*l-o*f,d=2*a;return f*=d,l*=d,p*=d,h*=2,y*=2,b*=2,t[0]=u+f+h,t[1]=c+l+y,t[2]=s+p+b,t}(At(),Ut(0,0,-1),n);Bt(o,o),this.uniforms.u_cameraFwd=o}}},{key:"updateTime",value:function(t){var e=no(uo(a.prototype),"updateTime",this).call(this,t);return this.uniforms.u_elapsedTime=this.elapsed/1e3%300*.1,e}}],r&&ro(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ce);const so=co;function fo(t){return fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fo(t)}function lo(t,e){return lo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lo(t,e)}function po(t,e){if(e&&("object"===fo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ho(t){return ho=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ho(t)}var yo=new Array(5),bo=new Array(5),mo=new Array(5);function vo(t){return Math.sin(Math.PI*Math.max(Math.min(1,t),0)/2)}for(var wo=0;wo<5;wo++){var Oo=wo/4;yo[wo]=Oo,mo[wo]=3.5*Math.max(1-Math.pow(vo(2*Math.abs(Oo-.5)),4),.2),bo[wo]=vo(1-2*Math.abs(Oo-.5))}var go=p(.78,.31,.31,1),Po=Ut(0,1,0);function _o(t,e,r,n,o,i,a,u,c,s){var f=12*e;t[f+0]=r,t[f+1]=n,t[f+2]=o,t[f+3]=c,t[f+4]=i,t[f+5]=a,t[f+6]=u[0],t[f+7]=u[2],t[f+8]=s[0],t[f+9]=s[1],t[f+10]=s[2],t[f+11]=s[3]}var Ro=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lo(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ho(r);if(n){var o=ho(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return po(this,t)});function i(t,e,r,n,a,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var c,s,l,p=r/8*2*Math.PI,h=hr();s=e,l=yr(n*Math.cos(p),n*Math.sin(p)),(c=h)[0]=s[0]+l[0],c[1]=s[1]+l[1];var b=function(t,e,r,n){n=void 0===n?1:Math.max(Math.min(n,1),0);var o=new Float32Array(240),i=2/30*Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),a=.9+.1*n,u=.65+.35*n,c=.1+.3*n,s=y(f(),go,r,.1+.85*n);s[3]=.75+.25*n*s[3];var l=Ut(e[0],0,e[1]);Ft(l,l,Ut(t[0],0,t[1]));var p=Nt(At(),l,Po);Bt(p,p);for(var h=5*(t[0]+t[1]-Math.floor(t[0]+t[1])),b=0;b<5;b++){var d=yo[b],m=t[0]+d*l[0],v=t[1]+d*l[2],w=0+0*d+a*bo[b],O=u*mo[b],g=d*i;_o(o,2*b+0,m+O*p[0],w,v+O*p[2],0,g+h,Po,c,s),_o(o,2*b+1,m-O*p[0],w,v-O*p[2],1,g+h,Po,c,s),_o(o,10+2*b+0,m,w+O,v,0,g+h,p,c,s),_o(o,10+2*b+1,m,w-O,v,1,g+h,p,c,s)}return o}(e,h,a,u),d=function(t){var e=new Uint16Array(48),r=0;for(wo=0;wo<2;wo++){for(var n=0;n<4;n++)e[r+0]=t+1,e[r+1]=t+0,e[r+2]=t+2,e[r+3]=t+1,e[r+4]=t+2,e[r+5]=t+3,t+=2,r+=6;t+=2}return e}(0),m=[];m.push(new I("a_position",4)),m.push(new I("a_texCoord0",4)),m.push(new I("a_color",4));var v=new it(t,m,b,t.DYNAMIC_DRAW),w=new Z(t,d,t.TRIANGLES);return o.call(this,t,v,w)}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(A);const jo=Ro;function Mo(t){return Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mo(t)}function Eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function So(){return So="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=To(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},So.apply(this,arguments)}function To(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Co(t)););return t}function ko(t,e){return ko=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ko(t,e)}function xo(t,e){if(e&&("object"===Mo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Co(t){return Co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Co(t)}const Ao=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ko(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Co(n);if(o){var r=Co(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xo(this,t)});function a(t,e,r,n,o){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(u=i.call(this,b.Program.Link,b.Texture.ResonatorLink)).portalPosition=t,u.slot=e,u.distance=r,u.color=n,u.resonatorPercent=o,u}return e=a,(r=[{key:"init",value:function(t){return this.mesh=new jo(t._gl,this.portalPosition,this.slot,this.distance,this.color,this.resonatorPercent),So(Co(a.prototype),"init",this).call(this,t)}}])&&Eo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(so);function Do(t){return Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Do(t)}function Uo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Io(t,e){return Io=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Io(t,e)}function Lo(t,e){if(e&&("object"===Do(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fo(t){return Fo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fo(t)}var Bo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Io(t,e)}(u,t);var e,r,n,i,a=(n=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fo(n);if(i){var r=Fo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Lo(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=a.call(this,t)).addDrawable("Portal",new Kr.Portal),xt(e.drawables.Portal.local,e.drawables.Portal.local,Ut(6,6,6)),e.setColor(l(b.teamColors.LOKI)),e}return e=u,(r=[{key:"setColor",value:function(t){this.color=l(t),this.drawables.Portal.uniforms.u_baseColor=this.color,this.drawables.Shield&&(this.drawables.Shield.uniforms.u_color=this.color),this.drawables.ArtifactsGreenGlow&&(this.drawables.ArtifactsGreenGlow.u_baseColor=this.color)}},{key:"addResonator",value:function(t,e,r,n){if(void 0===n&&(n=1),+e<0||+e>8)throw new Error("slot out of bounds for resonator");if(!(t in b.qualityColors))throw new Error("level must be one of "+Object.keys(b.qualityColors).join(" "));r=void 0===r?40:r;var i,a,u="Resonator"+ +e,c="Link"+ +e,s=e/8*2*Math.PI,f=new Kr.Resonator,p=r*Math.cos(s),h=r*Math.sin(s),y=new Ao([0,0],e,r,l(this.color),1);f.uniforms.u_color0=l(b.qualityColors[t]),f.world=(i=this.drawables.Portal.local,(a=new o(16))[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a),kt(f.world,f.world,Ut(p/6,0,h/6)),f.updateMatrix(),y.updateMatrix(),this.addDrawable(c,y),this.addDrawable(u,f),this.addDrawable("Portal",this.drawables.Portal)}},{key:"removeResonator",value:function(t){if(+t<0||+t>8)throw new Error("slot out of bounds for resonator");var e="Resonator"+ +t;this.drawables[e]&&(this.removeDrawable(e),this._removeResonatorLink(t),this.addDrawable("Portal",this.drawables.Portal))}},{key:"addShield",value:function(){"Shield"in this.drawables||(this.addDrawable("Shield",new Kr.Shield),xt(this.drawables.Shield.local,this.drawables.Shield.local,Ut(12,12,12)),this.drawables.Shield.updateMatrix()),this.drawables.Shield.uniforms.u_color=this.color,this.applyTransform()}},{key:"addArtifact",value:function(t,e){e in this.drawables||this.addDrawable(e,t),this.drawables[e].onUpdate=function(t){return Ct(this.model,this.model,t/1e3),this.updateMatrix(),!0},this.applyTransform()}},{key:"addGlowMarker",value:function(t,e){var r="Artifacts"+t+"Glow";r in this.drawables||this.addDrawable(r,new Kr[r]),this.drawables[r].uniforms.u_baseColor=l(e)}}])&&Uo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Dn);const No=Bo;function Xo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Go=function(){function t(e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=At(),this.view=St(),this.project=St(),this.viewProject=St(),this.hFoV=Math.PI/4,this.near=.1,this.far=100,this.width=e,this.height=r,this.focus=At(),this.up=Ut(0,1,0),this.animator=new Zt,this._updateProjection()._updateView()}var e,r;return e=t,r=[{key:"lookAt",value:function(t){return It(this.focus,t),this._updateView()}},{key:"translate",value:function(t){return Lt(this.position,this.position,t),this._updateView()}},{key:"setPosition",value:function(t){return It(this.position,t),this._updateView()}},{key:"setDimensions",value:function(t,e){return this.width=t,this.height=e,this._updateProjection()}},{key:"setFieldOfView",value:function(t){return this.hFoV=t,this._updateProjection()}},{key:"setFar",value:function(t){return this.far=t,this._updateProjection()}},{key:"addAnimation",value:function(t){return this.animator.addAnimation(t),this}},{key:"updateTime",value:function(t){return this.animator.runAnimations(t,this),this}},{key:"_updateView",value:function(){return function(t,e,r,o){var i,a,u,c,s,f,l,p,h,y,b=e[0],d=e[1],m=e[2],v=o[0],w=o[1],O=o[2],g=r[0],P=r[1],_=r[2];Math.abs(b-g)<n&&Math.abs(d-P)<n&&Math.abs(m-_)<n?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(l=b-g,p=d-P,h=m-_,i=w*(h*=y=1/Math.hypot(l,p,h))-O*(p*=y),a=O*(l*=y)-v*h,u=v*p-w*l,(y=Math.hypot(i,a,u))?(i*=y=1/y,a*=y,u*=y):(i=0,a=0,u=0),c=p*u-h*a,s=h*i-l*u,f=l*a-p*i,(y=Math.hypot(c,s,f))?(c*=y=1/y,s*=y,f*=y):(c=0,s=0,f=0),t[0]=i,t[1]=c,t[2]=l,t[3]=0,t[4]=a,t[5]=s,t[6]=p,t[7]=0,t[8]=u,t[9]=f,t[10]=h,t[11]=0,t[12]=-(i*b+a*d+u*m),t[13]=-(c*b+s*d+f*m),t[14]=-(l*b+p*d+h*m),t[15]=1)}(this.view,this.position,this.focus,this.up),this}},{key:"_updateProjection",value:function(){return function(t,e,r,n,o){var i,a=1/Math.tan(e/2);t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(i=1/(n-o),t[10]=(o+n)*i,t[14]=2*o*n*i):(t[10]=-1,t[14]=-2*n)}(this.project,this.hFoV,this.width/this.height,this.near,this.far),this}}],r&&Xo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Vo=Go;function qo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ho=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e;var o={};n&&(o.preserveDrawingBuffer=!0),this.canScreenshot=n&&!!e.toBlob;var i=e.getContext("webgl",o)||e.getContext("experimental-webgl",o);if(!i)throw"Could not initialize webgl";i.clearColor(0,0,0,1),this.gl=i,this.camera=new Vo(e.width,e.height),this.camera.setPosition(Ut(0,20,25)).lookAt(Ut(0,10,0)),this.assetManager=new Ae(this.gl,r),this.objectRenderer=new ze(this.gl,this.assetManager),this._start=this._last=null,this._frame=null,this.scale=1,this.resize()}var e,r;return e=t,r=[{key:"resize",value:function(t,e){var r=window.devicePixelRatio;t||(t=this.canvas.clientWidth),e||(e=this.canvas.clientHeight);var n=Math.floor(t*this.scale*r),o=Math.floor(e*this.scale*r);return this.canvas.width=n,this.canvas.height=o,this.camera.setDimensions(n,o),this.gl.viewport(0,0,n,o),this.updateView()}},{key:"rescale",value:function(t){return this.scale=t,this.resize()}},{key:"updateView",value:function(){return this.objectRenderer.updateView(this.camera),this}},{key:"stop",value:function(){return this._last=this._start=null,this._frame&&window.cancelAnimationFrame(this._frame),this}},{key:"demoEntities",value:function(){var t,e,r=-5,n=4;for(t in to)(e=new to[t](this))&&(e.translate(Ut(r,0,n)),++r>5&&(r=-5,n--));new No(this).translate(Ut(r,0,n))}},{key:"demo",value:function(){var t,e,r=-5,n=4;for(t in xn)(e=new xn[t])&&(kt(e.world,e.world,Ut(r,0,n)),++r>5&&(r=-5,n--),this.objectRenderer.addDrawable(e));for(t in rn)(e=new rn[t])&&(kt(e.world,e.world,Ut(r,0,n)),++r>5&&(r=-5,n--),this.objectRenderer.addDrawable(e));for(t in Kr)(e=new Kr[t])&&(kt(e.world,e.world,Ut(r,0,n)),++r>5&&(r=-5,n--),this.objectRenderer.addDrawable(e))}},{key:"draw",value:function(t){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),he(e),this.objectRenderer.render(),this.objectRenderer.updateTime(t),this.camera.updateTime(t)}},{key:"render",value:function(t){var e=0;this._start?t&&(e=t-this._last,this._last=t):(this._start=t,this._last=t),this.draw(e),this._frame=window.requestAnimationFrame(this.render.bind(this))}},{key:"preload",value:function(){return this.assetManager.loadAll()}},{key:"capture",value:function(t,e){var r=this;if(this.canScreenshot){this.stop();var n=new Promise((function(n,o){try{r.canvas.toBlob((function(t){n(t)}),t,e)}catch(t){o(t)}}));return n}return Promise.reject(new Error("Screenshots not enabled.  Initialize engine with `enableSnapshots` and ensure `canvas.toBlob` is supported by your browser."))}}],r&&qo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const Wo=Ho;function Ko(t){return Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ko(t)}function zo(t,e){return zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zo(t,e)}function Yo(t,e){if(e&&("object"===Ko(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jo(t){return Jo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jo(t)}var Zo=new Array(9),$o=new Array(9),Qo=new Array(9),ti=p(.46,.18,.18,1),ei=f();function ri(t){return Math.sin(Math.PI*Math.max(Math.min(1,t),0)/2)}for(var ni=0;ni<9;ni++){var oi=ni/8;Zo[ni]=oi,Qo[ni]=3+-1.5*Math.pow(ri(2*Math.abs(oi-.5)),4),$o[ni]=ri(1-2*Math.abs(oi-.5))}function ii(t,e,r,n,o,i,a,u,c,s){var f=12*e;t[f+0]=r,t[f+1]=n,t[f+2]=o,t[f+3]=c,t[f+4]=i,t[f+5]=a,t[f+6]=u[0],t[f+7]=u[2],t[f+8]=s[0],t[f+9]=s[1],t[f+10]=s[2],t[f+11]=s[3]}var ai=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zo(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jo(r);if(n){var o=Jo(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return Yo(this,t)});function i(t,e,r,n,a,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var c=function(t,e,r,n,o){n=void 0===n?1:Math.max(Math.min(n,1),0),o=void 0===o?1:Math.max(Math.min(o,1),0);var i=new Float32Array(648),a=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),u=ei[1],c=u+Math.min(30,.08*a),s=.01*a,l=.1+(n+o)/2*.3,p=Ut(e[0],0,e[1]);Ft(p,p,Ut(t[0],0,t[1]));var h=Ut(0,1,0),b=Nt(At(),p,h);Bt(b,b);for(var d=0;d<9;d++){var m=Zo[d],v=n+m*(o-n),w=.6+.35*v,O=m*s,g=t[0]+m*p[0],P=t[1]+m*p[2],_=u+$o[d]*(c-u),R=Qo[d],j=y(f(),ti,r,.25+.75*v);j[3]=w,ii(i,2*d,g+R*b[0],_,P+R*b[2],0,O,h,l,j),ii(i,2*d+1,g-R*b[0],_,P-R*b[2],.5,O,h,l,j),ii(i,18+2*d,g,_+R,P,0,O,b,l,j),ii(i,18+2*d+1,g,_-R,P,.5,O,b,l,j),ii(i,36+2*d,g,_-R,P,.5,O,b,l,j),ii(i,36+2*d+1,g,0,P,1,O,b,l,j)}return i}(e,r,n,a,u),s=function(t){for(var e=new Uint16Array(144),r=0,n=0;n<3;n++){for(var o=0;o<8;o++)e[r+0]=t+1,e[r+1]=t+0,e[r+2]=t+2,e[r+3]=t+1,e[r+4]=t+2,e[r+5]=t+3,t+=2,r+=6;t+=2}return e}(0),l=[];l.push(new I("a_position",4)),l.push(new I("a_texCoord0",4)),l.push(new I("a_color",4));var p=new it(t,l,c,t.DYNAMIC_DRAW),h=new Z(t,s,t.TRIANGLES);return o.call(this,t,p,h)}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(A);const ui=ai;function ci(t){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ci(t)}function si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fi(){return fi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=li(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},fi.apply(this,arguments)}function li(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=yi(t)););return t}function pi(t,e){return pi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pi(t,e)}function hi(t,e){if(e&&("object"===ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function yi(t){return yi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yi(t)}const bi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pi(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yi(n);if(o){var r=yi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return hi(this,t)});function a(t,e,r,n,o){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(u=i.call(this,b.Program.Link,b.Texture.PortalLink)).start=t,u.end=e,u.color=r,u.startPercent=n,u.endPercent=o,u}return e=a,(r=[{key:"init",value:function(t){return this.mesh=new ui(t._gl,this.start,this.end,this.color,this.startPercent,this.endPercent),fi(yi(a.prototype),"init",this).call(this,t)}}])&&si(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(so);function di(t){return di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},di(t)}function mi(t,e){return mi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},mi(t,e)}function vi(t,e){if(e&&("object"===di(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return wi(t)}function wi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Oi(t){return Oi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Oi(t)}var gi=p(.46,.18,.18,1),Pi=f();function _i(t){return Math.sin(Math.PI*Math.max(Math.min(1,t),0)/2)}function Ri(t,e){var r=t[0],n=e[0],o=e[1]-t[1],i=Math.sin(o)*Math.cos(n),a=Math.cos(r)*Math.sin(n)-Math.sin(r)*Math.cos(n)*Math.cos(o);return(Math.atan2(i,a)+2*Math.PI)%(2*Math.PI)}function ji(t,e,r){var n=Math.asin(Math.sin(t[0])*Math.cos(r)+Math.cos(t[0])*Math.sin(r)*Math.cos(e)),o=t[1]+Math.atan2(Math.sin(e)*Math.sin(r)*Math.cos(t[0]),Math.cos(r)-Math.sin(t[0])*Math.sin(n));return yr(n,o=(o+3*Math.PI)%(2*Math.PI)-Math.PI)}function Mi(t,e,r){var n=St();return Ct(n,n,t[1]),function(t,e,r){var n=Math.sin(r),o=Math.cos(r),i=e[0],a=e[1],u=e[2],c=e[3],s=e[4],f=e[5],l=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*o+s*n,t[1]=a*o+f*n,t[2]=u*o+l*n,t[3]=c*o+p*n,t[4]=s*o-i*n,t[5]=f*o-a*n,t[6]=l*o-u*n,t[7]=p*o-c*n}(n,n,t[0]-Math.PI/2),Ct(n,n,-Ri(t,e)),kt(n,n,[0,r,0]),n}function Ei(t){return yr(t[0]*Math.PI/180,t[1]*Math.PI/180)}function Si(t,e,r,n,o,i,a){var u=13*e;Bt(o,o),t[u+0]=r[0],t[u+1]=r[1],t[u+2]=r[2],t[u+3]=i,t[u+4]=n[0],t[u+5]=n[1],t[u+6]=o[0],t[u+7]=o[1],t[u+8]=o[2],t[u+9]=a[0],t[u+10]=a[1],t[u+11]=a[2],t[u+12]=a[3]}var Ti=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mi(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Oi(r);if(n){var o=Oi(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return vi(this,t)});function i(t,e,r,n,a,u,c){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var l=function(t,e,r,n,o,i){var a=Ei(e),u=Ei(r),c=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t[0])*Math.cos(e[0])*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}(a,u),s=Ri(a,u),l=c*t,p=Math.max(Math.floor(c/Math.PI*50)+1,8);o=void 0===o?1:Math.max(Math.min(o,1),0),i=void 0===i?1:Math.max(Math.min(i,1),0);for(var h=new Float32Array(13*p*6),b=Pi[1],d=b+Math.min(.01*t,.08*l),m=.01*l,v=.1+(o+i)/2*.3,w=Ut(0,1,0),O=Ut(0,0,1),g=2*p,P=0;P<p;P++){var _=P/(p-1),R=o+_*(i-o),j=.6+.35*R,M=_*m,E=Mi(0===_?a:ji(a,s,c*_),ji(a,s,c*(_+1/(p-1))),t),S=Ut(0,b+(3+-1.5*Math.pow(_i(2*Math.abs(_-.5)),4))*(d-b),0),T=.01*t*_i(1-2*Math.abs(_-.5)),k=Ut(0,T,0),x=Ut(0,0,T),C=y(f(),gi,n,.25+.75*R);C[3]=j,Si(h,2*P,Xt(At(),Lt(At(),S,x),E),yr(0,M),Xt(At(),w,E),v,C),Si(h,2*P+1,Xt(At(),Ft(At(),S,x),E),yr(.5,M),Xt(At(),w,E),v,C),Si(h,g+2*P,Xt(At(),Lt(At(),S,k),E),yr(0,M),Xt(At(),O,E),v,C),Si(h,g+2*P+1,Xt(At(),Ft(At(),S,k),E),yr(.5,M),Xt(At(),O,E),v,C),Si(h,2*g+2*P,Xt(At(),Ft(At(),S,k),E),yr(.5,M),Xt(At(),O,E),v,C),Si(h,2*g+2*P+1,Xt(At(),Ut(0,0,0),E),yr(1,M),Xt(At(),O,E),v,C)}return h}(e,r,n,a,u,c),p=l.length,h=function(t,e){for(var r=new Uint16Array(6*(e-1)*3),n=0,o=0;o<3;o++){for(var i=0;i<e-1;i++)r[n+0]=t+1,r[n+1]=t+0,r[n+2]=t+2,r[n+3]=t+1,r[n+4]=t+2,r[n+5]=t+3,t+=2,n+=6;t+=2}return r}(0,Math.floor(p/13/6)),b=[];b.push(new I("a_position",4)),b.push(new I("a_texCoord0",2)),b.push(new I("a_normal",3)),b.push(new I("a_color",4));var d=new it(t,b,l,t.DYNAMIC_DRAW),m=new Z(t,h,t.TRIANGLES);return vi(s=o.call(this,t,d,m),wi(s))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(A);const ki=Ti;function xi(t){return xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xi(t)}function Ci(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ai(){return Ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Di(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ai.apply(this,arguments)}function Di(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Li(t)););return t}function Ui(t,e){return Ui=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ui(t,e)}function Ii(t,e){if(e&&("object"===xi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Li(t){return Li=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Li(t)}var Fi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ui(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Li(n);if(o){var r=Li(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ii(this,t)});function a(t,e,r,n,o,u){var c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(c=i.call(this,b.Program.SphericalLink,b.Texture.PortalLink)).radius=t,c.start=e,c.end=r,c.color=n,c.startPercent=o,c.endPercent=u,c.uniforms.u_model=c._model,c}return e=a,r=[{key:"init",value:function(t){return this.mesh=new ki(t._gl,this.radius,this.start,this.end,this.color,this.startPercent,this.endPercent),Ai(Li(a.prototype),"init",this).call(this,t)}},{key:"updateView",value:function(t,e){Ai(Li(a.prototype),"updateView",this).call(this,t,e),this.uniforms.u_model=this._model}}],r&&Ci(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(so);const Bi=Fi;function Ni(t){return Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ni(t)}function Xi(t,e){return Xi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xi(t,e)}function Gi(t,e){if(e&&("object"===Ni(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Vi(t){return Vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vi(t)}var qi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xi(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Vi(r);if(n){var o=Vi(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return Gi(this,t)});function i(t,e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var a=function(t,e,r){var n,o,i,a,u,c,s,f,l,p,h,y=2*Math.PI,b=Math.PI,d=new Float32Array((e+1)*(r+1)*8),m=[],v=[],w=0,O=[];for(e=Math.max(3,e||8),r=Math.max(2,r||6),n=0;n<=e;n++){for(p=[],o=0;o<=r;o++)i=o/e,a=n/r,u=Ut(-t*Math.cos(i*y)*Math.sin(a*b),t*Math.cos(a*b),t*Math.sin(i*y)*Math.sin(a*b)),d[8*w+0]=u[0],d[8*w+1]=u[1],d[8*w+2]=u[2],d[8*w+3]=i,d[8*w+4]=a,Bt(u,u),d[8*w+5]=u[0],d[8*w+6]=u[1],d[8*w+7]=u[2],p.push(w++);v.push(p)}for(n=0;n<e;n++)for(o=0;o<r;o++)c=v[n][o+1],s=v[n][o],f=v[n+1][o],l=v[n+1][o+1],Math.abs(d[8*c+1])===t?(m.push.apply(m,[c,f,l]),d[8*c+3]=(d[8*c+3]+d[8*s+3])/2):Math.abs(d[8*f+1])===t?(m.push.apply(m,[c,s,f]),d[8*f+3]=(d[8*f+3]+d[8*l+3])/2):(m.push.apply(m,[c,s,l]),m.push.apply(m,[s,f,l]));return h=new Uint16Array(m.length),m.forEach((function(t,e){h[e]=t})),O.push(new I("a_position",3)),O.push(new I("a_texCoord0",2)),O.push(new I("a_normal",3)),{values:d,faces:h,attributes:O}}(e,r,n),u=new it(t,a.attributes,a.values),c=new Z(t,a.faces,t.TRIANGLES);return o.call(this,t,u,c)}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(A);const Hi=qi;function Wi(t){return Wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wi(t)}function Ki(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zi(){return zi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Yi(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},zi.apply(this,arguments)}function Yi(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$i(t)););return t}function Ji(t,e){return Ji=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ji(t,e)}function Zi(t,e){if(e&&("object"===Wi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $i(t){return $i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$i(t)}var Qi=b.Program.Atmosphere;const ta=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ji(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$i(n);if(o){var r=$i(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Zi(this,t)});function a(t,e,r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,Qi,null)).radius=t,o.vSlices=e,o.hSlices=r,o.uniforms.u_normalMatrix=Gt(),o.scaleFactor=n||1.1,o.setScalarScale(o.scaleFactor),o}return e=a,(r=[{key:"updateView",value:function(t){zi($i(a.prototype),"updateView",this).call(this,t);var e,r,n,o,i,u,c,s,f,l,p,h,y,b,d,m,v,w,O,g,P,_,R,j,M,E,S,T,k,x,C,A=(e=St(),n=(r=t)[0],o=r[1],i=r[2],u=r[3],c=r[4],s=r[5],f=r[6],l=r[7],p=r[8],h=r[9],y=r[10],b=r[11],d=r[12],m=r[13],v=r[14],(C=(O=n*s-o*c)*(x=y*(w=r[15])-b*v)-(g=n*f-i*c)*(k=h*w-b*m)+(P=n*l-u*c)*(T=h*v-y*m)+(_=o*f-i*s)*(S=p*w-b*d)-(R=o*l-u*s)*(E=p*v-y*d)+(j=i*l-u*f)*(M=p*m-h*d))?(C=1/C,e[0]=(s*x-f*k+l*T)*C,e[1]=(i*k-o*x-u*T)*C,e[2]=(m*j-v*R+w*_)*C,e[3]=(y*R-h*j-b*_)*C,e[4]=(f*S-c*x-l*E)*C,e[5]=(n*x-i*S+u*E)*C,e[6]=(v*P-d*j-w*g)*C,e[7]=(p*j-y*P+b*g)*C,e[8]=(c*k-s*S+l*M)*C,e[9]=(o*S-n*k-u*M)*C,e[10]=(d*R-m*P+w*O)*C,e[11]=(h*P-p*R-b*O)*C,e[12]=(s*E-c*T-f*M)*C,e[13]=(n*T-o*E+i*M)*C,e[14]=(m*g-d*_-v*O)*C,e[15]=(p*_-h*g+y*O)*C,e):null),D=function(t,e){if(t===e){var r=e[1],n=e[2],o=e[3],i=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=o,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}(St(),A);return this.uniforms.u_normalMatrix=Vt(Gt(),D),this}},{key:"init",value:function(t){return this.mesh=new Hi(t._gl,this.radius,this.vSlices,this.hSlices),zi($i(a.prototype),"init",this).call(this,t)}}])&&Ki(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(te);function ea(t){return ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ea(t)}function ra(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function na(){return na="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=oa(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},na.apply(this,arguments)}function oa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ua(t)););return t}function ia(t,e){return ia=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ia(t,e)}function aa(t,e){if(e&&("object"===ea(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ua(t){return ua=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ua(t)}var ca=b.Program.Textured;const sa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ia(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ua(n);if(o){var r=ua(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return aa(this,t)});function a(t,e,r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=i.call(this,ca,null,t)).radius=e,o.vSlices=r,o.hSlices=n,o}return e=a,(r=[{key:"init",value:function(t){return this.mesh=new Hi(t._gl,this.radius,this.vSlices,this.hSlices),na(ua(a.prototype),"init",this).call(this,t)}}])&&ra(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ce);function fa(t){return fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fa(t)}function la(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pa(){return pa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=ha(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},pa.apply(this,arguments)}function ha(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=da(t)););return t}function ya(t,e){return ya=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ya(t,e)}function ba(t,e){if(e&&("object"===fa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function da(t){return da=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},da(t)}var ma=b.Texture.Particle,va=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ya(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=da(n);if(o){var r=da(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ba(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t,null,ma)).uniforms.u_cameraPos=Ut(0,0,0),e}return e=a,r=[{key:"updateView",value:function(t,e){pa(da(a.prototype),"updateView",this).call(this,t,e),e&&It(this.uniforms.u_cameraPos,e.position)}}],r&&la(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ce);const wa=va;function Oa(t){return Oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oa(t)}function ga(t,e){return ga=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ga(t,e)}function Pa(t,e){if(e&&("object"===Oa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _a(t){return _a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_a(t)}for(var Ra=[0,0,1,1],ja=[1,0,1,0],Ma=[],Ea=0;Ea<96;Ea++)Ma.push({x:Math.random()-.5,y:.4*Math.random()-.2,z:Math.random()-.5,a_scale:10*(.1+.9*Math.random()),a_speed:6*(.5+.5*Math.random())});var Sa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ga(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_a(r);if(n){var o=_a(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return Pa(this,t)});function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=[];e.push(new I("a_position",3)),e.push(new I("a_texCoord0",2)),e.push(new I("a_scale",1)),e.push(new I("a_speed",1)),e.push(new I("a_portalIndex",1)),e.push(new I("a_index",1));var r,n,a,u=new Float32Array(3456),c=0;for(n=0;n<96;n++)for(r=Ma[n],a=0;a<4;a++)u[9*c+0]=r.x,u[9*c+1]=r.y,u[9*c+2]=r.z,u[9*c+3]=Ra[a],u[9*c+4]=ja[a],u[9*c+5]=r.a_scale,u[9*c+6]=r.a_speed,u[9*c+7]=0,u[9*c+8]=n,c++;var s=new Uint16Array(576),f=[0,1,2,1,3,2];c=0;var l=0;for(n=0;n<96;n++){for(a=0;a<6;a++)s[l+a]=c+f[a];l+=6,c+=4}return o.call(this,t,new it(t,e,u),new Z(t,s,t.TRIANGLES))}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(A);const Ta=Sa;function ka(t){return ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ka(t)}function xa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ca(){return Ca="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Aa(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ca.apply(this,arguments)}function Aa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ia(t)););return t}function Da(t,e){return Da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Da(t,e)}function Ua(t,e){if(e&&("object"===ka(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ia(t){return Ia=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ia(t)}var La=b.Program.ParticlePortal,Fa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Da(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ia(n);if(o){var r=Ia(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ua(this,t)});function a(t,e,r,n,o){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),u=i.call(this,La);var c=l(t);return c[3]=r,u.uniforms.u_color=new Float32Array(160),u.uniforms.u_position=new Float32Array(160),u.uniforms.u_params=new Float32Array(160),h(u.uniforms.u_color,c),h(u.uniforms.u_position,p(0,0,0,e)),h(u.uniforms.u_params,p(0,o,n,1)),u}return e=a,r=[{key:"updateView",value:function(t,e){if(Ca(Ia(a.prototype),"updateView",this).call(this,t,e),e){var r=Dt(e.position),n=Math.pow(r,.2);this.uniforms.u_params[3]=n}}},{key:"updateTime",value:function(t){var e=Ca(Ia(a.prototype),"updateTime",this).call(this,t);return this.uniforms.u_params[0]=this.elapsed/1e5*this.uniforms.u_params[1],e}},{key:"init",value:function(t){return this.mesh=new Ta(t._gl),Ca(Ia(a.prototype),"init",this).call(this,t)}}],r&&xa(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(wa);const Ba=Fa;function Na(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Xa=Math.PI/2;function Ga(t){return{identifier:t.identifier,x:t.clientX,y:t.clientY}}function Va(t,e){for(var r=0;r<t.length;r++)if(t[r].identifier==e.identifier)return r;return-1}var qa=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=o||{},this.element=e,this.camera=r,this.distance=n||2,this.distanceTarget=this.distance;var i={zoomDamp:.5,distanceScale:.5,distanceMax:1e3,distanceMin:1,touchScale:.1,wheelScale:.01,friction:.2,target:At(),allowZoom:!0};this.options=ye(i,o),this.camera.lookAt(this.options.target),this.mouse={x:0,y:0},this.mouseOnDown={x:0,y:0},this.rotation={x:0,y:0},this.target={x:3*Math.PI/2,y:Math.PI/6},this.targetOnDown={x:0,y:0},this.overRenderer=!1,this.mouseMove=this._onMouseMove.bind(this),this.mouseUp=this._onMouseUp.bind(this),this.mouseOut=this._onMouseOut.bind(this),this.mouseDown=this._onMouseDown.bind(this),this.mouseWheel=this._onMouseWheel.bind(this),this.touches=[],this.touchDelta=0,this.touchMove=this._onTouchMove.bind(this),this.touchEnd=this._onTouchEnd.bind(this),this.touchLeave=this._onTouchLeave.bind(this),this.touchStart=this._onTouchStart.bind(this),this.mouseOver=function(){this.overRenderer=!0}.bind(this),this.mouseOut=function(){this.overRenderer=!1}.bind(this),this.enabled=!1}var e,r;return e=t,r=[{key:"disable",value:function(){this.element.removeEventListener("mousedown",this.mouseDown,!1),this.element.removeEventListener("mousemove",this.mouseMove,!1),this.element.removeEventListener("mouseup",this.mouseUp,!1),this.element.removeEventListener("mouseout",this.mouseOut,!1),this.element.removeEventListener("touchstart",this.touchStart,!1),this.element.removeEventListener("touchmove",this.touchMove,!1),this.element.removeEventListener("touchend",this.touchEnd,!1),this.element.removeEventListener("touchleave",this.touchLeave,!1),this.element.removeEventListener("mousewheel",this.mouseWheel,!1),this.element.removeEventListener("mouseover",this.mouseOver,!1),this.element.removeEventListener("mouseout",this.mouseOut,!1),this.enabled=!1}},{key:"enable",value:function(){this.element.addEventListener("mousedown",this.mouseDown,!1),this.options.allowZoom&&this.element.addEventListener("mousewheel",this.mouseWheel,!1),this.element.addEventListener("touchstart",this.touchStart,!1),this.element.addEventListener("mouseover",this.mouseOver,!1),this.element.addEventListener("mouseout",this.mouseOut,!1),this.enabled=!0}},{key:"updateView",value:function(){var t=this.target.x-this.rotation.x,e=this.target.y-this.rotation.y,r=this.distanceTarget-this.distance,n=At();(Math.abs(t)>1e-5||Math.abs(e)>1e-5||Math.abs(r)>1e-5)&&(this.rotation.x+=t*this.options.friction,this.rotation.y+=e*this.options.friction,this.distance+=r*this.options.distanceScale,n[0]=this.distance*Math.sin(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target[0],n[1]=this.distance*Math.sin(this.rotation.y)+this.options.target[1],n[2]=this.distance*Math.cos(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target[2],this.camera.setPosition(n))}},{key:"_updateTargets",value:function(){var t=(this.distance<5?this.distance:Math.log(this.distance))/this.options.zoomDamp;this.target.x=this.targetOnDown.x+.005*(this.mouse.x-this.mouseOnDown.x)*t,this.target.y=this.targetOnDown.y+.005*(this.mouse.y-this.mouseOnDown.y)*t,this.target.y=this.target.y>Xa?Xa:this.target.y,this.target.y=this.target.y<-Xa?-Xa:this.target.y}},{key:"_onMouseDown",value:function(t){t.preventDefault(),this.element.addEventListener("mousemove",this.mouseMove,!1),this.element.addEventListener("mouseup",this.mouseUp,!1),this.element.addEventListener("mouseout",this.mouseOut,!1),this.mouseOnDown.x=-t.clientX,this.mouseOnDown.y=t.clientY,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y,this.element.style.cursor="move"}},{key:"_onMouseMove",value:function(t){this.mouse.x=-t.clientX,this.mouse.y=t.clientY,this._updateTargets()}},{key:"_onMouseUp",value:function(t){this._onMouseOut(t),this.element.style.cursor="auto"}},{key:"_onMouseOut",value:function(){this.element.removeEventListener("mousemove",this.mouseMove,!1),this.element.removeEventListener("mouseup",this.mouseUp,!1),this.element.removeEventListener("mouseout",this.mouseOut,!1)}},{key:"_onMouseWheel",value:function(t){return this.overRenderer&&this._zoom(t.wheelDeltaY*this.options.wheelScale*(this.distance<5?this.distance:Math.log(this.distance))),!0}},{key:"_onTouchStart",value:function(t){t.preventDefault(),0===this.touches.length&&(this.element.addEventListener("touchmove",this.touchMove,!1),this.element.addEventListener("touchend",this.touchEnd,!1),this.element.addEventListener("touchleave",this.touchLeave,!1));for(var e=0;e<t.changedTouches.length;e++)this.touches.push(Ga(t.changedTouches[e]));if(1===this.touches.length)this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y;else if(2===this.touches.length&&this.options.allowZoom){var r=Math.abs(this.touches[0].x-this.touches[1].x),n=Math.abs(this.touches[0].y-this.touches[1].y);this.touchDelta=Math.sqrt(r*r+n*n)}this.element.style.cursor="move"}},{key:"_onTouchMove",value:function(t){for(var e=t.changedTouches,r=e.length,n=0;n<r;n++){var o=Va(this.touches,e[n]);o>=0?this.touches.splice(o,1,Ga(e[n])):console.warn("could not find event ",e[n])}if(1===this.touches.length)this.mouse.x=-this.touches[0].x,this.mouse.y=this.touches[0].y,this.updateTargets();else if(2===this.touches.length&&this.options.allowZoom){var i=this.touches[0].x-this.touches[1].x,a=this.touches[0].y-this.touches[1].y,u=Math.sqrt(i*i+a*a);this._zoom((u-this.touchDelta)*this.options.touchScale),this.touchDelta=u}}},{key:"_removeTouches",value:function(t){for(var e=t.changedTouches,r=e.length,n=0;n<r;n++){var o=Va(this.touches,e[n]);o>=0&&this.touches.splice(o,1)}0===this.touches.length?(this.element.removeEventListener("touchmove",this.touchMove,!1),this.element.removeEventListener("touchend",this.touchEnd,!1),this.element.removeEventListener("touchleave",this.touchLeave,!1)):1===this.touches.length&&(this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y)}},{key:"_onTouchEnd",value:function(t){this._removeTouches(t),this.element.style.cursor="auto"}},{key:"_onTouchLeave",value:function(t){this._removeTouches(t)}},{key:"_onTouchCancel",value:function(t){this._removeTouches(t)}},{key:"_zoom",value:function(t){this.distanceTarget-=t,this.distanceTarget=Math.min(this.distanceTarget,this.options.distanceMax),this.distanceTarget=Math.max(this.distanceTarget,this.options.distanceMin)}}],r&&Na(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Ha={Constants:b,Engine:Wo,AssetLoader:R,Utilities:{resetGL:he,setParams:ye,disco:function(t,e){var r=e/1e3;return this.uniforms.u_baseColor[0]=Math.sin(r),this.uniforms.u_baseColor[1]=Math.sin(r+2*Math.PI/3),this.uniforms.u_baseColor[2]=Math.sin(r+4*Math.PI/3),!0},generateArtifacts:function(t,e,r){var n,o,i="Artifact"+t+"Texture",a={};for(n=1;n<=e;n++)o=t+n,a[""+n]=be(o,i);if(r)for(n=1;n<=e;n++)o=t+"Frozen"+n,a["Frozen"+n]=be(o,i);return a},makeArtifact:be,Ease:Wt,Animation:zt,GLMatrix:r,Promise},Drawables:{Inventory:xn,World:Kr,ResonatorLink:Ao,PortalLink:bi,SphericalPortalLink:Bi,Atmosphere:ta,TexturedSphere:sa,ParticlePortal:Ba,Drawable:te},Entities:{World:{Portal:No},Inventory:to},Controls:{Orbit:qa},VERSION:"0.22.2"};const Wa=Ha})(),IMV=e})();