/*! ingress-model-viewer 02-01-2015 */

!function(a,b){"use strict";var c={};if(!JavaDeserializer||!THREE||!libtga)throw"Missing dependencies";var d=window.console||{log:function(){},warn:function(){},info:function(){}};!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),THREE.OculusRiftEffect=function(a,b){var c=b&&b.worldFactor?b.worldFactor:1,d=b&&b.HMD?b.HMD:{hResolution:1280,vResolution:800,hScreenSize:.14976,vScreenSize:.0936,interpupillaryDistance:.064,lensSeparationDistance:.064,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]};this.HMD=d;var e=new THREE.PerspectiveCamera;e.matrixAutoUpdate=!1,e.target=new THREE.Vector3;var f=new THREE.OrthographicCamera(-1,1,1,-1,1,1e3);f.position.z=1,this.preLeftRender=function(){},this.preRightRender=function(){},a.autoClear=!1;var g=new THREE.Color("black"),h={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},i=new THREE.WebGLRenderTarget(640,800,h),j=new THREE.ShaderMaterial({uniforms:{texid:{type:"t",value:i},scale:{type:"v2",value:new THREE.Vector2(1,1)},scaleIn:{type:"v2",value:new THREE.Vector2(1,1)},lensCenter:{type:"v2",value:new THREE.Vector2(0,0)},hmdWarpParam:{type:"v4",value:new THREE.Vector4(1,0,0,0)},chromAbParam:{type:"v4",value:new THREE.Vector4(1,0,0,0)}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 scale;","uniform vec2 scaleIn;","uniform vec2 lensCenter;","uniform vec4 hmdWarpParam;","uniform vec4 chromAbParam;","uniform sampler2D texid;","varying vec2 vUv;","void main()","{","  vec2 uv = (vUv*2.0)-1.0;","  vec2 theta = (uv-lensCenter)*scaleIn;","  float rSq = theta.x*theta.x + theta.y*theta.y;","  vec2 rvector = theta*(hmdWarpParam.x + hmdWarpParam.y*rSq + hmdWarpParam.z*rSq*rSq + hmdWarpParam.w*rSq*rSq*rSq);","  vec2 rBlue = rvector * (chromAbParam.z + chromAbParam.w * rSq);","  vec2 tcBlue = (lensCenter + scale * rBlue);","  tcBlue = (tcBlue+1.0)/2.0;","  if (any(bvec2(clamp(tcBlue, vec2(0.0,0.0), vec2(1.0,1.0))-tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;}","  vec2 tcGreen = lensCenter + scale * rvector;","  tcGreen = (tcGreen+1.0)/2.0;","  vec2 rRed = rvector * (chromAbParam.x + chromAbParam.y * rSq);","  vec2 tcRed = lensCenter + scale * rRed;","  tcRed = (tcRed+1.0)/2.0;","  gl_FragColor = vec4(texture2D(texid, tcRed).r, texture2D(texid, tcGreen).g, texture2D(texid, tcBlue).b, 1);","}"].join("\n")}),k=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),j),l=new THREE.Scene;l.add(f),l.add(k);var m={},n={},o=1;this.setHMD=function(b){d=b;var e=d.hResolution/(2*d.vResolution),f=-1-4*(d.hScreenSize/4-d.lensSeparationDistance/2)/d.hScreenSize;o=d.distortionK[0]+d.distortionK[1]*Math.pow(f,2)+d.distortionK[2]*Math.pow(f,4)+d.distortionK[3]*Math.pow(f,6);var g=THREE.Math.radToDeg(2*Math.atan2(d.vScreenSize*o,2*d.eyeToScreenDistance)),k=(new THREE.Matrix4).makePerspective(g,e,.3,1e4),l=4*(d.hScreenSize/4-d.interpupillaryDistance/2)/d.hScreenSize;m.proj=(new THREE.Matrix4).makeTranslation(l,0,0).multiply(k),n.proj=(new THREE.Matrix4).makeTranslation(-l,0,0).multiply(k),m.tranform=(new THREE.Matrix4).makeTranslation(-c*d.interpupillaryDistance/2,0,0),n.tranform=(new THREE.Matrix4).makeTranslation(c*d.interpupillaryDistance/2,0,0),m.viewport=[0,0,d.hResolution/2,d.vResolution],n.viewport=[d.hResolution/2,0,d.hResolution/2,d.vResolution];var p=4*(d.hScreenSize/4-d.lensSeparationDistance/2)/d.hScreenSize;m.lensCenter=new THREE.Vector2(p,0),n.lensCenter=new THREE.Vector2(-p,0),j.uniforms.hmdWarpParam.value=new THREE.Vector4(d.distortionK[0],d.distortionK[1],d.distortionK[2],d.distortionK[3]),j.uniforms.chromAbParam.value=new THREE.Vector4(d.chromaAbParameter[0],d.chromaAbParameter[1],d.chromaAbParameter[2],d.chromaAbParameter[3]),j.uniforms.scaleIn.value=new THREE.Vector2(1,1/e),j.uniforms.scale.value=new THREE.Vector2(1/o,1*e/o),i&&i.dispose(),i=new THREE.WebGLRenderTarget(d.hResolution*o/2*a.devicePixelRatio,d.vResolution*o*a.devicePixelRatio,h),j.uniforms.texid.value=i},this.getHMD=function(){return d},this.setHMD(d),this.setSize=function(b,c){m.viewport=[b/2-d.hResolution/2,c/2-d.vResolution/2,d.hResolution/2,d.vResolution],n.viewport=[b/2,c/2-d.vResolution/2,d.hResolution/2,d.vResolution],a.setSize(b,c)},this.render=function(b,c){var d=a.getClearColor().clone();a.setClearColor(g),a.clear(),a.setClearColor(d),c.matrixAutoUpdate&&c.updateMatrix(),e.projectionMatrix.copy(m.proj),e.matrix.copy(c.matrix).multiply(m.tranform),e.matrixWorldNeedsUpdate=!0,this.preLeftRender(e),a.setViewport(m.viewport[0],m.viewport[1],m.viewport[2],m.viewport[3]),j.uniforms.lensCenter.value=m.lensCenter,a.render(b,e,i,!0),a.render(l,f),e.projectionMatrix.copy(n.proj),e.matrix.copy(c.matrix).multiply(n.tranform),e.matrixWorldNeedsUpdate=!0,this.preRightRender(e),a.setViewport(n.viewport[0],n.viewport[1],n.viewport[2],n.viewport[3]),j.uniforms.lensCenter.value=n.lensCenter,a.render(b,e,i,!0),a.render(l,f)},this.dispose=function(){j&&j.dispose(),i&&i.dispose()}};var e={teamColors:{RESISTANCE:new THREE.Vector4(0,.7607843137254902,1,1),ENLIGHTENED:new THREE.Vector4(.1568627450980392,.9568627450980393,.1568627450980392,1),NEUTRAL:new THREE.Vector4(.9764705882352941,.9764705882352941,.9764705882352941,1),LOKI:new THREE.Vector4(1,.1568627450980392,.1568627450980392,1)},qualityColors:{EXTREMELY_RARE:new THREE.Vector4(.9803921568627451,.39215686274509803,.39215686274509803,1),VERY_RARE:new THREE.Vector4(.9568627450980393,.5215686274509804,.9254901960784314,1),MORE_RARE:new THREE.Vector4(.7647058823529411,0,1,1),RARE:new THREE.Vector4(.6666666666666666,.5372549019607843,.984313725490196,1),LESS_COMMON:new THREE.Vector4(.45098039215686275,.6588235294117647,1,1),COMMON:new THREE.Vector4(.5098039215686274,.9529411764705882,.7058823529411765,1),VERY_COMMON:new THREE.Vector4(.6980392156862745,.6980392156862745,.6980392156862745,1),L1:new THREE.Vector4(.996078431372549,.807843137254902,.35294117647058826,1),L2:new THREE.Vector4(1,.6509803921568628,.18823529411764706,1),L3:new THREE.Vector4(1,.45098039215686275,.08235294117647059,1),L4:new THREE.Vector4(.8941176470588236,0,0,1),L5:new THREE.Vector4(.9921568627450981,.1607843137254902,.5725490196078431,1),L6:new THREE.Vector4(.9215686274509803,.14901960784313725,.803921568627451,1),L7:new THREE.Vector4(.7568627450980392,.1411764705882353,.8784313725490196,1),L8:new THREE.Vector4(.5882352941176471,.15294117647058825,.9568627450980393,1)},anomalyColors:{1:new THREE.Vector4(1,.5686274509803921,.21176470588235294,1),2:new THREE.Vector4(1,.3215686274509804,.9058823529411765,1),3:new THREE.Vector4(.6196078431372549,.35294117647058826,1,1),4:new THREE.Vector4(.8431372549019608,.27058823529411763,.27058823529411763,1),5:new THREE.Vector4(1,.9450980392156862,0,1),6:new THREE.Vector4(.6509803921568628,1,.9019607843137255,1),7:new THREE.Vector4(.5725490196078431,.5803921568627451,.592156862745098,1)},artifactColors:{Helios:{RedGlow:new THREE.Vector4(.92,.51,.14,1),PurpleGlow:new THREE.Vector4(1,.87,.55,1),TargetGlow:new THREE.Vector4(1,.72,0,1)},Amar:{TargetGlow:new THREE.Vector4(.62,.22,.62,1),RedGlow:new THREE.Vector4(.79,.11,.49,1),PurpleGlow:new THREE.Vector4(.58,.17,1,1)},Jarvis:{TargetGlow:new THREE.Vector4(.62,.22,.62,1),RedGlow:new THREE.Vector4(.79,.11,.49,1),PurpleGlow:new THREE.Vector4(.58,.17,1,1)}},xmColors:{coreGlow:new THREE.Vector4(.92,.7,.89,1),coreGlowAlt:new THREE.Vector4(.6,.4,.6,.8)}};c.Constants=e;var f=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a},g=function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(a[d]=c&&"object"==typeof a[d]&&"object"==typeof b[d]?g(a[d],b[d],c):b[d]);return a},h=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]="object"==typeof a[c]&&"object"==typeof b[c]?h(a[c],b[c]):b[c]);return a},i=function(a,b){var c={};for(var d in a)if(!(!a.hasOwnProperty(d)||b&&d in b)){var e=a[d];c[d]="object"==typeof e.value&&"clone"in e.value?{type:e.type,value:e.value.clone()}:{type:e.type,value:e.value}}return c},j=function(a,b){var c={};for(var d in a)!a.hasOwnProperty(d)||b&&d in b||(c[d]=a[d]);return c},k=function(a,b,c,d){d=d||0;var e=0,f=a.length,g=function(){return e>=f?void c():(b(a[e],e),e++,void setTimeout(g,d))};setTimeout(g,0)};c.Utilities=c.Utilities||{},c.Utilities.cloneUniforms=i,c.Utilities.copyUniforms=j,c.Utilities.asyncForeach=k,c.Utilities.setParams=g,c.Utilities.inherits=f;var l=function(){var a=Math.PI/2,b=5,c=function(a){return{identifier:a.identifier,x:a.clientX,y:a.clientY}},e=function(a,b){for(var c=0;c<a.length;c++)if(a[c].identifier==b.identifier)return c;return-1},f=function(a,b,c){c=c||{},this.canvas=a,this.distance=b||2,this.distanceTarget=this.distance;var d={zoomDamp:.5,distanceScale:.25,distanceMax:1e3,distanceMin:1,touchScale:.1,wheelScale:.01,friction:.1,target:new THREE.Vector3,allowZoom:!0};this.options=g(d,c),this.mouse={x:0,y:0},this.mouseOnDown={x:0,y:0},this.rotation={x:0,y:0},this.target={x:3*Math.PI/2,y:Math.PI/6},this.targetOnDown={x:0,y:0},this.overRenderer=!1,this.mouseMove=this.onMouseMove.bind(this),this.mouseUp=this.onMouseUp.bind(this),this.mouseOut=this.onMouseOut.bind(this),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.options.allowZoom&&this.canvas.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.touches=[],this.touchDelta=0,this.touchMove=this.onTouchMove.bind(this),this.touchEnd=this.onTouchEnd.bind(this),this.touchLeave=this.onTouchLeave.bind(this),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this),!1);var e=this;this.canvas.addEventListener("mouseover",function(){e.overRenderer=!0},!1),this.canvas.addEventListener("mouseout",function(){e.overRenderer=!1},!1)};return f.prototype.updateTargets=function(){var c=this.distance<b?this.distance:Math.log(this.distance),d=c/this.options.zoomDamp;this.target.x=this.targetOnDown.x+.005*(this.mouse.x-this.mouseOnDown.x)*d,this.target.y=this.targetOnDown.y+.005*(this.mouse.y-this.mouseOnDown.y)*d,this.target.y=this.target.y>a?a:this.target.y,this.target.y=this.target.y<-a?-a:this.target.y},f.prototype.onMouseDown=function(a){a.preventDefault(),this.canvas.addEventListener("mousemove",this.mouseMove,!1),this.canvas.addEventListener("mouseup",this.mouseUp,!1),this.canvas.addEventListener("mouseout",this.mouseOut,!1),this.mouseOnDown.x=-a.clientX,this.mouseOnDown.y=a.clientY,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y,this.canvas.style.cursor="move"},f.prototype.onMouseMove=function(a){this.mouse.x=-a.clientX,this.mouse.y=a.clientY,this.updateTargets()},f.prototype.onMouseUp=function(a){this.onMouseOut(a),this.canvas.style.cursor="auto"},f.prototype.onMouseOut=function(){this.canvas.removeEventListener("mousemove",this.mouseMove,!1),this.canvas.removeEventListener("mouseup",this.mouseUp,!1),this.canvas.removeEventListener("mouseout",this.mouseOut,!1)},f.prototype.updateCamera=function(a){var b=this.target.x-this.rotation.x,c=this.target.y-this.rotation.y,d=this.distanceTarget-this.distance;(Math.abs(b)>1e-5||Math.abs(c)>1e-5||Math.abs(d)>1e-5)&&(this.rotation.x+=b*this.options.friction,this.rotation.y+=c*this.options.friction,this.distance+=d*this.options.distanceScale,a.position.x=this.distance*Math.sin(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target.x,a.position.y=this.distance*Math.sin(this.rotation.y)+this.options.target.y,a.position.z=this.distance*Math.cos(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target.z,a.lookAt(this.options.target),a.matrixWorldNeedsUpdate=!0)},f.prototype.onMouseWheel=function(a){return a.preventDefault(),this.overRenderer&&this.zoom(a.wheelDeltaY*this.options.wheelScale*(this.distance<b?this.distance:Math.log(this.distance))),!1},f.prototype.onTouchStart=function(a){a.preventDefault(),0===this.touches.length&&(this.canvas.addEventListener("touchmove",this.touchMove,!1),this.canvas.addEventListener("touchend",this.touchEnd,!1),this.canvas.addEventListener("touchleave",this.touchLeave,!1));for(var b=0;b<a.changedTouches.length;b++)this.touches.push(c(a.changedTouches[b]));if(1===this.touches.length)this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y;else if(2===this.touches.length&&this.options.allowZoom){var d=Math.abs(this.touches[0].x-this.touches[1].x),e=Math.abs(this.touches[0].y-this.touches[1].y);this.touchDelta=Math.sqrt(d*d+e*e)}this.canvas.style.cursor="move"},f.prototype.onTouchMove=function(a){for(var b=a.changedTouches,f=b.length,g=0;f>g;g++){var h=e(this.touches,b[g]);h>=0?this.touches.splice(h,1,c(b[g])):d.log("could not find event ",b[g])}if(1===this.touches.length)this.mouse.x=-this.touches[0].x,this.mouse.y=this.touches[0].y,this.updateTargets();else if(2===this.touches.length&&this.options.allowZoom){var i=this.touches[0].x-this.touches[1].x,j=this.touches[0].y-this.touches[1].y,k=Math.sqrt(i*i+j*j);this.zoom((k-this.touchDelta)*this.options.touchScale),this.touchDelta=k}},f.prototype.removeTouches=function(a){for(var b=a.changedTouches,c=b.length,d=0;c>d;d++){var f=e(this.touches,b[d]);f>=0&&this.touches.splice(f,1)}0===this.touches.length?(this.canvas.removeEventListener("touchmove",this.touchMove,!1),this.canvas.removeEventListener("touchend",this.touchEnd,!1),this.canvas.removeEventListener("touchleave",this.touchLeave,!1)):1===this.touches.length&&(this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y)},f.prototype.onTouchEnd=function(a){this.removeTouches(a),this.canvas.style.cursor="auto"},f.prototype.onTouchLeave=function(a){this.removeTouches(a)},f.prototype.onTouchCancel=function(a){this.removeTouches(a)},f.prototype.zoom=function(a){this.distanceTarget-=a,this.distanceTarget=Math.min(this.distanceTarget,this.options.distanceMax),this.distanceTarget=Math.max(this.distanceTarget,this.options.distanceMin)},f}();c.Controls=c.Controls||{},c.Controls.OrbitControls=l;var m=function(a){this.geometry=new THREE.BufferGeometry,this.transparent=a&&a.transparent||!1,this.attributes={}};m.prototype.getAttributeNames=function(){return Object.keys(this.attributes)},c.Geometry=c.Geometry||{},c.Geometry.Geometry=m;var n=function(){var a=function(a,b,c){for(var d=0;d<Math.floor(a.length/b);d++)c(a.subarray(d*b,(d+1)*b),d)},b=function(a){var b,c,e,f,g,h=new DataView(a),i=0,j=h.getUint32(i);i+=4;for(var k=[],l=0;j>l;l++){for(b=h.getUint32(i),1!=b&&16!=b&&d.warn("unknown type "+b),i+=4,c=h.getUint32(i),i+=4,e=h.getUint16(i),i+=2,g="",f=0;e>f;f++)g+=String.fromCharCode(h.getUint8(i+f));i+=e,k.push({name:g,type:b,size:c})}return k},c=function(c){var d,e,f,g=new JavaDeserializer(c.buf),h=g.getStream(),i=h.getContents(),j=i[3].contents.toArray(),k=0,l=b(j),m=l.length,n=i[0].contents.toArray(),o=[];for(d=0;m>d;d++)e=l[d],f="v"+e.size,k+=e.size,c.attributes[e.name]={type:f,values:null};var p=Math.floor(n.length/k);for(d=0;m>d;d++)o.push(new Float32Array(l[d].size*p));var q=new Float32Array(3*p);for(a(n,k,function(a,b){var c,d=0;for(c=0;m>c;c++){for(var e=l[c].size,f=0;e>f;f++)o[c][b*e+f]=a[d+f];d+=e}for(c=0;3>c;c++)q[b+c]=a[c]}),d=0;m>d;d++)e=l[d],c.geometry.addAttribute(e.name,new THREE.BufferAttribute(o[d],e.size));c.geometry.addAttribute("position",new THREE.BufferAttribute(q,3));var r=i[1].contents.toArray(),s=new Uint16Array(r.length);s.set(r),c.geometry.addAttribute("index",new THREE.BufferAttribute(s,1))},e=function(a,b){return m.call(this,b),this.buf=a,c(this),this};return f(e,m),e}();c.Geometries=c.Geometries||{},c.Geometries.Ingress=n;var o=function(){for(var a=9,b=6*a,c=new Array(a),d=new Array(a),e=new Array(a),g=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},h=0;a>h;h++){var i=h/8;c[h]=i,e[h]=3+-1.5*Math.pow(g(2*Math.abs(i-.5)),4),d[h]=g(1-2*Math.abs(i-.5))}var j=new THREE.Vector4(.46,.18,.18,1),k=new THREE.Vector3,l=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=4*e;a[3*e+0]=f,a[3*e+1]=g,a[3*e+2]=h,b[n+0]=f,b[n+1]=g,b[n+2]=h,b[n+3]=l,c[n+0]=i,c[n+1]=j,c[n+2]=k.x,c[n+3]=k.z,d[n+0]=m.x,d[n+1]=m.y,d[n+2]=m.z,d[n+3]=m.w},n=function(a){a=a||{},a.transparent=!0,m.call(this,a),this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,4),this.a_texCoord0=new THREE.BufferAttribute(new Float32Array,4),this.a_color=new THREE.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_texCoord0:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.linkCount=0};return f(n,m),n.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},n.prototype.addLink=function(f,g,h,i){i=i||Math.sqrt((g.x-f.x)*(g.x-f.x)+(g.y-f.y)*(g.y-f.y));for(var m=k.y,n=m+Math.min(30,.08*i),o=f.percent,p=g.percent,q=(o+p)/2,r=.01*i,s=.1+.3*q,t=new THREE.Vector3(g.x,0,g.y).sub(new THREE.Vector3(f.x,0,f.y)),u=new THREE.Vector3(0,1,0),v=t.clone().cross(u).normalize(),w=this.extendBuffer(this.a_position,b),x=this.extendBuffer(this.a_texCoord0,b),y=this.extendBuffer(this.a_color,b),z=this.extendBuffer(this.position,b),A=this.linkCount*b,B=2*a,C=0;a>C;C++){var D=c[C],E=o+D*(p-o),F=.6+.35*E,G=D*r,H=f.x+D*t.x,I=f.y+D*t.z,J=m+d[C]*(n-m),K=e[C],L=j.clone();L.lerp(h,.25+.75*E),L.w=F,l(z,w,x,y,A+2*C,H+K*v.x,J,I+K*v.z,0,G,u,s,L),l(z,w,x,y,A+2*C+1,H-K*v.x,J,I-K*v.z,.5,G,u,s,L),l(z,w,x,y,A+B+2*C,H,J+K,I,0,G,v,s,L),l(z,w,x,y,A+B+2*C+1,H,J-K,I,.5,G,v,s,L),l(z,w,x,y,A+2*B+2*C,H,J-K,I,.5,G,v,s,L),l(z,w,x,y,A+2*B+2*C+1,H,0,I,1,G,v,s,L)}var M=new Uint16Array(144*(this.linkCount+1));M.set(this.index.array);var N=this.linkCount*b,O=144*this.linkCount;for(C=0;3>C;C++){for(var P=0;a-1>P;P++)M[O+0]=N+1,M[O+1]=N+0,M[O+2]=N+2,M[O+3]=N+1,M[O+4]=N+2,M[O+5]=N+3,N+=2,O+=6;N+=2}return this.linkCount++,this.index.array=M,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this},n}();c.Geometries=c.Geometries||{},c.Geometries.PortalLink=o;var p=function(){for(var a=5,b=4*a,c=new Array(a),d=new Array(a),e=new Array(a),g=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},h=0;a>h;h++){var i=h/4;c[h]=i,e[h]=3.5*Math.max(1-Math.pow(g(2*Math.abs(i-.5)),4),.2),d[h]=g(1-2*Math.abs(i-.5))}var j=new THREE.Vector4(.78,.31,.31,1),k=new THREE.Vector3,l=new THREE.Vector3,n=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=4*e;a[3*e+0]=f,a[3*e+1]=g,a[3*e+2]=h,b[n+0]=f,b[n+1]=g,b[n+2]=h,b[n+3]=l,c[n+0]=i,c[n+1]=j,c[n+2]=k.x,c[n+3]=k.z,d[n+0]=m.x,d[n+1]=m.y,d[n+2]=m.z,d[n+3]=m.w},o=function(a){a=a||{},a.transparent=!0,m.call(this,a),this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,4),this.a_texCoord0=new THREE.BufferAttribute(new Float32Array,4),this.a_color=new THREE.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_texCoord0:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.linkCount=0};return f(o,m),o.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},o.prototype.addLink=function(f,g,h){var i=Math.sqrt((g.x-f.x)*(g.x-f.x)+(g.y-f.y)*(g.y-f.y)),m=l.y,o=k.y,p=g.percent,q=2/30*i,r=.9+.1*p,s=.65+.35*p,t=.75+.25*p,u=.1+.3*p,v=j.clone();v.lerp(h,.1+.85*p),v.w=t*v.w;for(var w=new THREE.Vector3(g.x,0,g.y).sub(new THREE.Vector3(f.x,0,f.y)),x=new THREE.Vector3(0,1,0),y=w.clone().cross(x).normalize(),z=this.extendBuffer(this.a_position,b),A=this.extendBuffer(this.a_texCoord0,b),B=this.extendBuffer(this.a_color,b),C=this.extendBuffer(this.position,b),D=this.linkCount*b,E=2*a,F=5*(f.x+f.y-Math.floor(f.x+f.y)),G=0;a>G;G++){var H=c[G],I=f.x+H*w.x,J=f.y+H*w.z,K=o+H*(m-o)+r*d[G],L=s*e[G],M=H*q;n(C,z,A,B,D+2*G+0,I+L*y.x,K,J+L*y.z,0,M+F,x,u,v),n(C,z,A,B,D+2*G+1,I-L*y.x,K,J-L*y.z,1,M+F,x,u,v),n(C,z,A,B,D+E+2*G+0,I,K+L,J,0,M+F,y,u,v),n(C,z,A,B,D+E+2*G+1,I,K-L,J,1,M+F,y,u,v)}var N=new Uint16Array(48*(this.linkCount+1));N.set(this.index.array);var O=this.linkCount*b,P=48*this.linkCount;for(G=0;2>G;G++){for(var Q=0;a-1>Q;Q++)N[P+0]=O+1,N[P+1]=O+0,N[P+2]=O+2,N[P+3]=O+1,N[P+4]=O+2,N[P+5]=O+3,O+=2,P+=6;O+=2}return this.linkCount++,this.index.array=N,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this},o}();c.Geometries=c.Geometries||{},c.Geometries.ResonatorLink=p;var q=function(){var a=function(a,b,c,d,e,f,g,h){var i=4*d;return a[3*d+0]=e.x,a[3*d+1]=0,a[3*d+2]=e.y,b[i+0]=e.x,b[i+1]=e.y,b[i+2]=f,b[i+3]=g,c[i+0]=h.x,c[i+1]=h.y,c[i+2]=h.z,c[i+3]=h.w,d+1},b=function(b,c,d,e,f,g,h,i,j,k,l){return a(b,c,d,a(b,c,d,a(b,c,d,e,f,0,g,l),h,0,i,l),j,((h.x-f.x)*(f.y-j.y)-(h.y-f.y)*(f.x-j.x))/f.distanceTo(h),k,l)},c=function(a){a=a||{},a.transparent=!0,m.call(this,a),this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,4),this.a_color=new THREE.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.fieldCount=0,this.lastOffset=0};return f(c,m),c.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},c.prototype.addField=function(a,c,d,e,f){f=1;var g=1.1,h=a.percent,i=c.percent,j=d.percent,k=this.extendBuffer(this.position,9),l=this.extendBuffer(this.a_position,9),m=this.extendBuffer(this.a_color,9);if(1>f){var n=Math.max(0,f);g=1.1*n;var o=n*n;h*=o,i*=o,j*=o}var p=new THREE.Vector2(a.x,a.y),q=new THREE.Vector2(c.x,c.y),r=new THREE.Vector2(d.x,d.y),s=p.clone().add(q).add(r).multiplyScalar(.333333333333),t=this.lastOffset;this.lastOffset=b(k,l,m,this.lastOffset,p,h,q,i,s,g,e),this.lastOffset=b(k,l,m,this.lastOffset,q,i,r,j,s,g,e),this.lastOffset=b(k,l,m,this.lastOffset,r,j,p,h,s,g,e);var u=new Uint16Array(9*(this.fieldCount+1));u.set(this.index.array);for(var v=0;9>v;v++)u[t+v]=t+v;return this.index.array=u,this.index.needsUpdate=!0,this.position.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this.fieldCount++,this.fieldCount},c}();c.Geometries=c.Geometries||{},c.Geometries.Field=q;var r=function(){var a=function(a,b){return[a,0,b]},b=function(b,c){m.call(this,c),b=b||a,c=c||{};var d={slices:1,paramSize:3};this.options=g(d,c);var e=b(0,0);if(!e.length||e.length!=this.options.paramSize)throw"Parametric function returned invalid results, must be array of length "+this.options.paramSize;this.attributes={a_position:{type:"v"+this.options.paramSize,values:null},a_texCoord0:{type:"v2",values:null}};for(var f=this.options.slices,h=this.options.paramSize,i=(f+1)*(f+1),j=new Float32Array(3*i),k=new Float32Array(i*h),l=new Float32Array(2*i),n=new Uint16Array(f*f*3*2),o=0,p=0;f>=p;p++)for(var q=0;f>=q;q++){var r=p/f,s=q/f,t=b(r,s),u=p*(f+1)+q;l[2*u]=r,l[2*u+1]=s;for(var v=0;h>v;v++)k[u*h+v]=t[v],3>v&&(j[u*h+v]=t[v]);3>h&&(j[3*u+2]=0),f>p&&f>q&&(n[o++]=u,n[o++]=u+1,n[o++]=u+f+1,n[o++]=u+f+1,n[o++]=u+1,n[o++]=u+f+2)}this.geometry.addAttribute("a_position",new THREE.BufferAttribute(k,h)),this.geometry.addAttribute("a_texCoord0",new THREE.BufferAttribute(l,2)),this.geometry.addAttribute("position",new THREE.BufferAttribute(j,3)),this.geometry.addAttribute("index",new THREE.BufferAttribute(n,1))};return f(b,m),b}();c.Geometries=c.Geometries||{},c.Geometries.Parametric=r;var s=function(){var a=40,b=96,c=4,d=6,e=[0,0,1,1],g=[1,0,1,0],h=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},i=function(){m.call(this,{transparent:!0}),this.count=0,this.attributes={a_position:{type:"v3",values:null},a_texCoord0:{type:"v2",values:null},a_scale:{type:"f",values:null},a_speed:{type:"f",values:null},a_portalIndex:{type:"f",values:null},a_index:{type:"f",values:null}},this.position=new THREE.BufferAttribute(new Float32Array,3),this.index=new THREE.BufferAttribute(new Uint16Array,1),this.a_position=new THREE.BufferAttribute(new Float32Array,3),this.a_texCoord0=new THREE.BufferAttribute(new Float32Array,2),this.a_scale=new THREE.BufferAttribute(new Float32Array,1),this.a_speed=new THREE.BufferAttribute(new Float32Array,1),this.a_portalIndex=new THREE.BufferAttribute(new Float32Array,1),this.a_index=new THREE.BufferAttribute(new Float32Array,1),this.seeds=[];for(var a=0;b>a;a++)this.seeds.push({x:Math.random()-.5,y:.4*Math.random()-.2,z:Math.random()-.5,a_scale:10*(.1+.9*Math.random()),a_speed:6*(.5+.5*Math.random())});this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_scale",this.a_scale),this.geometry.addAttribute("a_speed",this.a_speed),this.geometry.addAttribute("a_portalIndex",this.a_portalIndex),this.geometry.addAttribute("a_index",this.a_index),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index)};return f(i,m),i.prototype.addSystem=function(){if(this.count+1>=a)throw"This system is full";var f,i,j,k=b*c,l=h(this.a_position,k),m=h(this.a_texCoord0,k),n=h(this.a_scale,k),o=h(this.a_speed,k),p=h(this.a_portalIndex,k),q=h(this.a_index,k),r=h(this.position,k),s=this.count++,t=s*k;for(i=0;b>i;i++)for(f=this.seeds[i],j=0;c>j;j++)r[3*t+0]=0,r[3*t+1]=0,r[3*t+2]=0,l[3*t+0]=f.x,l[3*t+1]=f.y,l[3*t+1]=f.z,m[2*t+0]=e[j],m[2*t+1]=g[j],n[t]=f.a_scale,o[t]=f.a_speed,p[t]=s,q[t]=i,t++;var u=new Uint16Array((s+1)*b*d);u.set(this.index.array);var v=[0,1,2,1,3,2];t=s*k;var w=s*b*d;for(i=0;b>i;i++){for(j=0;d>j;j++)u[w+j]=t+v[j];w+=6,t+=4}this.index.array=u,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_scale.needsUpdate=!0,this.a_speed.needsUpdate=!0,this.a_portalIndex.needsUpdate=!0,this.a_index.needsUpdate=!0,this.geometry.needsUpdate=!0},i}();c.Geometries=c.Geometries||{},c.Geometries.ParticlePortals=s;var t=function(){var a={mat4:"m4",vec4:"v4",vec3:"v3",vec2:"v2","float":"f",sampler2D:"t","int":"i"},b=function(b){for(var c,e=/uniform ([^ ]+) ([^;]+);/gi,f={};null!==(c=e.exec(b));){var g=c[1];a.hasOwnProperty(g)?g=a[g]:d.warn("no known conversion from "+g),f[c[2]]={type:g}}return f},c=function(b){for(var c,e=/attribute ([^ ]+) ([^;]+);/gi,f={};null!==(c=e.exec(b));){var g=c[1];a.hasOwnProperty(g)?g=a[g]:d.warn("no known conversion from "+g),f[c[2]]={type:g}}return f},e=function(a){if(/precision mediump float/g.test(a))return a;var b=a.split("\n");return b.splice(1,0,"#ifdef GL_ES","precision mediump float;","#endif"),b.join("\n")},f=function(a,d){this.vertex=e(a),this.fragment=d,this.uniforms=b(a+"\n"+d),this.attributes=c(a+"\n"+d)};return f.prototype.getUniformsList=function(){return Object.keys(this.uniforms)},f.prototype.getAttributesList=function(){return Object.keys(this.attributes)},f}();c.ShaderSet=t;var u=function(){var a=function(){this.geometry=null,this.material=null,this.mesh=null,this.shaders=null,this.elapsed=0,this.uniforms={},this.options={}};return a.prototype.init=function(a,b){if(!(a instanceof c.Geometry.Geometry))throw"Geometry must inherit from base";if(!(b instanceof c.ShaderSet))throw"Shaders must inherit from base";var d={transparent:!1};this.options=g(d,this.options),this.geometry=a,this.shaders=b;var e={uniforms:this.uniforms,attributes:a.attributes,vertexShader:b.vertex,fragmentShader:b.fragment,transparent:this.options.transparent,side:THREE.DoubleSide,depthWrite:!this.options.transparent};return this.material=new THREE.RawShaderMaterial(e),this.mesh=new THREE.Mesh(a.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.updateMatrix(),this.mesh.matrixAutoUpdate=!1,this.id=null,this},a.prototype.updateView=function(){d.warn("Nothing to udpate")},a.prototype.updateTime=function(a){this.elapsed+=a},a.prototype.updateUniformF=function(a,b){this.uniforms[a].value=b},a.prototype.updateUniformV=function(a,b){this.uniforms[a].value.copy(b)},a.prototype.updateUniformM=function(a,b){this.uniforms[a].value.copy(b)},a}();c.Drawable=u;var v=function(){var a=function(){u.call(this),this.uniforms.u_modelViewProject={type:"m4",value:new THREE.Matrix4},this.projectView=new THREE.Matrix4};return f(a,u),a.prototype.updateView=function(a){this.projectView.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this.updateModel()},a.prototype.updateModel=function(){this.mesh.updateMatrix(),this.mesh.updateMatrixWorld();var a=this.projectView.clone().multiply(this.mesh.matrixWorld);this.updateUniformM("u_modelViewProject",a)},a}();c.Drawables=c.Drawables||{},c.Drawables.Model=v;var w=function(){var a=function(a){if(v.call(this),!(a instanceof THREE.Texture))throw"Texture must be a THREE.Texture";this.uniforms.u_texture={type:"t",value:a},a.needsUpdate=!0};return f(a,v),a}();c.Drawables=c.Drawables||{},c.Drawables.Textured=w;var x=function(){var a=(new THREE.Vector4).copy(e.qualityColors.VERY_RARE),b=(new THREE.Vector4).copy(e.xmColors.coreGlow),c=function(c,d,e){w.call(this,c),this.uniforms.u_color0={type:"v4",value:d||a.clone()},this.uniforms.u_color1={type:"v4",value:e||b.clone()}};return f(c,w),c.prototype.setPrimaryColor=function(a){this.updateUniformV("u_color0",a)},c.prototype.setSecondaryColor=function(a){this.updateUniformV("u_color1",a)},c}();c.Drawables=c.Drawables||{},c.Drawables.Bicolored=x;var y=function(){var a=(new THREE.Vector4).copy(e.xmColors.coreGlow),b=(new THREE.Vector4).copy(e.xmColors.coreGlowAlt),c=function(c,d,e,f){w.call(this,c),this.uniforms.u_elapsedTime={type:"f",value:f||0},this.uniforms.u_teamColor={type:"v4",value:d||a.clone()},this.uniforms.u_altColor={type:"v4",value:e||b.clone()}};return f(c,w),c.prototype.setTeamColor=function(a){this.updateUniformV("u_teamColor",a)},c.prototype.setAltColor=function(a){this.updateUniformV("u_altColor",a)},c.prototype.updateTime=function(a){u.prototype.updateTime.call(this,a),this.updateUniformF("u_elapsedTime",this.elapsed/1e3%300*.1)},c}();c.Drawables=c.Drawables||{},c.Drawables.Xm=y;var z=function(){var a=(new THREE.Vector4).copy(c.Constants.teamColors.NEUTRAL),b=function(b,c,d,e,f){w.call(this,b),this.uniforms.u_baseColor={type:"v4",value:c||a.clone()},this.uniforms.u_rotation={type:"f",value:d||0},this.uniforms.u_rampTarget={type:"f",value:e||0},this.uniforms.u_alpha={type:"f",value:f||.6},this.options.transparent=!0};return f(b,w),b.prototype.setBaseColor=function(a){this.updateUniformV("u_baseColor",a)
},b.prototype.setAlpha=function(a){this.updateuniformF("u_alpha",a)},b.prototype.updateTime=function(a){u.prototype.updateTime.call(this,a);var b=this.elapsed/5e3;this.updateUniformF("u_rotation",b),this.updateUniformF("u_rampTarget",Math.sin(Math.PI/2*(b-Math.floor(b)))),this.updateUniformF("u_alpha",.05*Math.sin(b)+.75)},b}();c.Drawables=c.Drawables||{},c.Drawables.Glowramp=z;var A=function(){var a=function(a){w.call(this,a),this.uniforms.u_cameraFwd={type:"v3",value:new THREE.Vector3(0,0,-1)},this.uniforms.u_elapsedTime={type:"f",value:0},this.options.transparent=!0};return f(a,w),a.prototype.updateView=function(a){var b=new THREE.Vector3(0,0,-1).applyQuaternion(a.quaternion);this.updateUniformV("u_cameraFwd",b),v.prototype.updateView.call(this,a)},a.prototype.updateTime=function(a){u.prototype.updateTime.call(this,a),this.updateUniformF("u_elapsedTime",this.elapsed/1e3%300*.1)},a}();c.Drawables=c.Drawables||{},c.Drawables.Link=A;var B=function(){var a=(new THREE.Vector4).copy(c.Constants.teamColors.NEUTRAL),b=new THREE.Vector2(.5,1.3),d=new THREE.Vector3(.5,.5,.5),e=function(c,e,f,g){w.call(this,c),this.uniforms.u_color={type:"v4",value:e||a},this.uniforms.u_rampTargetInvWidth={type:"v2",value:f||b.clone()},this.uniforms.u_contributionsAndAlpha={type:"v3",value:g||d.clone()},this.options.transparent=!0};return f(e,w),e.prototype.setColor=function(a){this.updateUniformV("u_color",a)},e.prototype.updateTime=function(a){u.prototype.updateTime.call(this,a);var b=this.elapsed/1e4,c=this.uniforms.u_rampTargetInvWidth.value.clone();c.x=2*(b-Math.floor(b))-.5,this.updateUniformV("u_rampTargetInvWidth",c)},e}();c.Drawables=c.Drawables||{},c.Drawables.ShieldEffect=B;var C=function(){var a=function(a){w.call(this,a),this.uniforms.u_cameraPos={type:"v3",value:new THREE.Vector3},this.options.transparent=!0};return f(a,w),a.prototype.updateView=function(a){this.projectView.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this.updateUniformV("u_cameraPos",a.position),this.updateUniformM("u_modelViewProject",this.projectView)},a}();c.Drawables=c.Drawables||{},c.Drawables.Particle=C;var D=function(){var a=40,b=function(a,b,c,d,e,f,g){this.color=a,this.position=b,this.count=c,this.height=d,this.distance=e,this.spread=f,this.id=g},c=function(b){C.call(this,b),this.colors=[],this.position=[],this.params=[],this.count=0,this.id=0,this.systems=[];for(var c=0;a>c;c++)this.colors.push(new THREE.Vector4),this.position.push(new THREE.Vector4),this.params.push(new THREE.Vector4);this.uniforms.u_color={type:"v4v",value:this.colors},this.uniforms.u_position={type:"v4v",value:this.position},this.uniforms.u_params={type:"v4v",value:this.params}};return f(c,C),c.prototype.updateView=function(a){C.prototype.updateView.call(this,a);for(var b,c,d=this.count,e=new THREE.Vector3,f=0;d>f;f++)b=this.systems[f],e.copy(b.position).sub(a.position),c=Math.pow(e.length(),.2),this.position[f].set(b.position.x,b.position.y,b.position.z,b.height),this.params[f].w=c},c.prototype.addSystem=function(c,d,e,f,g,h){if(this.count+1>=a)throw"This system is full";d.sub(this.mesh.position);var i=this.count++,j=this.uniforms.u_cameraPos.value,k=d.clone().sub(j),l=Math.pow(k.length(),.2),m=this.id++;return this.systems.push(new b(c,d,e,f,g,h,m)),this.colors[i].set(c.x,c.y,c.z,e),this.position[i].set(d.x,d.y,d.z,f),this.params[i].set(this.elapsed/1e5*h,h,g,l),m},c.prototype.updateTime=function(a){u.prototype.updateTime.call(this,a);for(var b=this.count,c=0;b>c;c++)this.params[c].x=this.elapsed/1e5*this.params[c].y},c}();c.Drawables=c.Drawables||{},c.Drawables.ParticlePortals=D;var E=function(a,b,c){if("image"===b||"image.co"===b)if(/\.tga$/.test(a))libtga.loadFile(a,function(a,b){if(a)return void c(a,null);var d=document.createElement("canvas"),e=d.getContext("2d"),f=e.createImageData(b.width,b.height);f.data.set(b.imageData),d.height=b.height,d.width=b.width,e.putImageData(f,0,0),c(null,d)});else{var d=new Image;"image.co"===b&&(d.crossOrigin="anoymous"),d.onload=function(){c(null,this)},d.onerror=function(a){c(a,null)},d.src=a}else{var e=new XMLHttpRequest;e.open("GET",a),e.responseType=b,e.onload=function(){c(null,this.response)},e.onerror=function(a){c(a,null)},e.send()}},F=function(a,b){a=a||"text",b=b||function(a){return a};var c={},d={};this.loadAsset=function(e,f,g,h){return d[e]?void g(null,d[e]):(c[e]=c[e]||[],c[e].push(g),void(d.hasOwnProperty(e)||(d[e]=!1,E(f,a,function(a,f){a||(f=b(f,h),d[e]=f);for(var g;g=c[e].shift();)g(a,f)}))))},this.getAsset=function(a){return d[a]}};c.AssetLoader=F,c.Utilities=c.Utilities||{},c.Utilities.loadResource=E;var G=function(a,b){this.base=a,b=b||m,this.geometries=new F("arraybuffer",function(a,c){return new b(a,c)})};G.prototype.loadAsset=function(a,b,c){this.geometries.loadAsset(a,this.base+b.path,c,b)},G.prototype.getAsset=function(a){return this.geometries.getAsset(a)},c.Loaders=c.Loaders||{},c.Loaders.GeometryLoader=G;var H=function(a){this.base=a,this.vertex=new F("text"),this.fragment=new F("text")};H.prototype.loadAsset=function(a,b,c){var d={},e=!1,f=function(){!e&&d.fragment&&d.vertex&&(e=!0,c(null,new t(d.vertex,d.fragment)))};this.vertex.loadAsset(a,this.base+b.vertex,function(a,b){return a?void c(a,null):(d.vertex=b,void f())}),this.fragment.loadAsset(a,this.base+b.fragment,function(a,b){return a?void c(a,null):(d.fragment=b,void f())})},H.prototype.getAsset=function(a){var b=this.vertex.getAsset(a),c=this.fragment.getAsset(a);return b&&c?new t(b,c):null},c.Loaders=c.Loaders||{},c.Loaders.ShaderLoader=H;var I=function(){var a={MipMapLinearLinear:THREE.LinearMipMapLinearFilter,Linear:THREE.LinearFilter,MipMapLinearNearest:THREE.LinearMipMapNearestFilter,MipMapNearestLinear:THREE.NearestMipMapLinearFilter,Nearest:THREE.NearestFilter,Repeat:THREE.RepeatWrapping,ClampToEdge:THREE.ClampToEdgeWrapping},c=function(b){return a.hasOwnProperty(b)?b=a[b]:d.warn("unknown type "+b),b},e=function(a){this.base=a,this.metadata={},this.textures=new F("image",function(a,d){var e=c(d.magFilter),f=c(d.minFilter),g=c(d.wrapS),h=c(d.wrapT),i=new THREE.Texture(a,b,g,h,e,f);return i.flipY=!1,i.needsUpdate=!0,i})};return e.prototype.loadAsset=function(a,b,c){this.textures.loadAsset(a,this.base+b.path,c,b)},e.prototype.getAsset=function(a){return this.textures.getAsset(a)},e}();c.Loaders=c.Loaders||{},c.Loaders.TextureLoader=I;var J=function(){var a=function(a){this.loader=a,this.models=[]};a._assets={geometry:[],texture:[],shaders:[],rawShaders:[]},a.extend=function(a,b){f(a,b),a._assets={geometry:b._assets.geometry.slice(),texture:b._assets.texture.slice(),shaders:b._assets.shaders.slice(),rawShaders:b._assets.rawShaders.slice()}};var b=function(a,b){return a.indexOf(b)<0&&a.push(b),a};return a.getAssets=function(a){return{geometry:a._assets.geometry.reduce(b,[]),texture:a._assets.texture.reduce(b,[]),shaders:a._assets.shaders.reduce(b,[]),rawShaders:a._assets.rawShaders.reduce(b,[])}},a.prototype.setPosition=function(a){for(var b=0;b<this.models.length;b++)this.models[b].mesh.position.copy(a),this.models[b].updateModel();return this},a.prototype.setScale=function(a){for(var b=0;b<this.models.length;b++)this.models[b].mesh.scale.copy(a),this.models[b].updateModel();return this},a.prototype.setRotation=function(a){for(var b=0;b<this.models.length;b++)this.models[b].mesh.rotation.copy(a),this.models[b].updateModel();return this},a.prototype.translate=function(a,b){for(var c=0;c<this.models.length;c++)this.models[c].mesh.translateOnAxis(a,b),this.models[c].updateModel();return this},a.prototype.rotate=function(a,b){for(var c=0;c<this.models.length;c++)this.models[c].mesh.rotateOnAxis(a,b),this.models[c].updateModel();return this},a}();c.Entity=J;var K=function(a,b,c){var d=c.clone(),f=a,g="FlipCardTexture",h="bicolor_textured",i=b,j="ObjectXMTexture",k="xm",l=function(a,b){J.call(this,a),b=b||d;var c=a.getAsset("geometry",f),e=a.getAsset("texture",g),l=a.getAsset("shaders",h);if(!c)throw"Unable to load Geometry "+f;if(!e)throw"Unable to load texture "+g;if(!l)throw"Unable to load shaders: "+h;this.item=new x(e,this.quality),this.item.init(c,l);var m=a.getAsset("geometry",i),n=a.getAsset("texture",j),o=a.getAsset("shaders",k);if(!m)throw"Unable to load Geometry "+i;if(!n)throw"Unable to load texture "+j;if(!o)throw"Unable to load shaders: "+k;this.core=new y(n),this.core.init(m,o),this.setQuality(b),this.models=[this.item,this.core]};return J.extend(l,J),l._assets.geometry.push(f),l._assets.geometry.push(i),l._assets.texture.push(g),l._assets.texture.push(j),l._assets.shaders.push(h),l._assets.shaders.push(k),l.prototype.setQuality=function(a){if(a instanceof THREE.Vector4)this.quality=a;else{if(!(a in e.qualityColors))throw"Unknown quality color "+a;this.quality=e.qualityColors[a].clone()}return this.item&&this.item.setPrimaryColor(this.quality),this},l};c.Entities=c.Entities||{},c.Entities.LeveledXMItem=K;var L=function(a,b){var c=b.clone(),d=a,e="FlipCardTexture",f="bicolor_textured",g="FlipCardXmMesh",h="ObjectXMTexture",i="xm",j=function(a,b){J.call(this,a),b=b||c;var j=a.getAsset("geometry",d),k=a.getAsset("texture",e),l=a.getAsset("shaders",f);if(!j)throw"Unable to load Geometry "+d;if(!k)throw"Unable to load texture "+e;if(!l)throw"Unable to load shaders: "+f;this.item=new w(k),this.item.init(j,l);var m=a.getAsset("geometry",g),n=a.getAsset("texture",h),o=a.getAsset("shaders",i);if(!m)throw"Unable to load Geometry "+g;if(!n)throw"Unable to load texture "+h;if(!o)throw"Unable to load shaders: "+i;this.core=new y(n),this.core.init(m,o),this.core.setTeamColor(b),this.models=[this.item,this.core]};return J.extend(j,J),j._assets.geometry.push(d),j._assets.geometry.push(g),j._assets.texture.push(e),j._assets.texture.push(h),j._assets.shaders.push(f),j._assets.shaders.push(i),j};c.Entities=c.Entities||{},c.Entities.FlipCardXMItem=L;var M;c.Entities=c.Entities||{},c.Entities.Items=c.Entities.Items||{};var N=K("CapsuleMesh","CapsuleXmMesh",e.qualityColors.RARE);c.Entities.Items.Capsule=N;var O=K("ExtraShieldMesh","ResShieldXMMesh",e.qualityColors.VERY_RARE);c.Entities.Items.ExtraShield=O;var P=K("ForceAmpMesh","ForceAmpXmMesh",e.qualityColors.RARE);c.Entities.Items.ForceAmp=P;var Q=K("HeatSinkMesh","HeatSinkXmMesh",e.qualityColors.VERY_RARE);c.Entities.Items.HeatSink=Q;var R=K("LinkAmpMesh","LinkAmpXmMesh",e.qualityColors.RARE);c.Entities.Items.LinkAmp=R;var S=K("MultiHackMesh","MultiHackXmMesh",e.qualityColors.VERY_RARE);c.Entities.Items.MultiHack=S,M=Math.floor(8*Math.random())+1;var T=K("ResonatorMesh","ResonatorXMMesh",e.qualityColors["L"+M]);c.Entities.Items.Resonator=T;var U=K("ResShieldMesh","ResShieldXMMesh",e.qualityColors.VERY_RARE);c.Entities.Items.Shield=U;var V=K("TurretMesh","TurretXmMesh",e.qualityColors.RARE);c.Entities.Items.Turret=V,M=Math.floor(8*Math.random())+1;var W=K("UltrastrikeMesh","UltrastrikeXMMesh",e.qualityColors["L"+M]);c.Entities.Items.Ultrastrike=W,M=Math.floor(8*Math.random())+1;var X=K("XmpMesh","XmpXMMesh",e.qualityColors["L"+M]);c.Entities.Items.Xmp=X;var Y=L("FlipCardMeshJarvis",e.teamColors.ENLIGHTENED);c.Entities.Items.JarvisVirus=Y;var Z=L("FlipCardMeshAda",e.teamColors.RESISTANCE);c.Entities.Items.AdaRefactor=Z;var $=function(a,b,c){var d=a+(c?"Frozen":"")+b,e="Artifact"+a+"Texture",f="textured",g=6,h=function(a){J.call(this,a);var b=a.getAsset("geometry",d),c=a.getAsset("texture",e),h=a.getAsset("shaders",f);if(!b)throw"Unable to load Geometry "+d;if(!c)throw"Unable to load texture "+e;if(!h)throw"Unable to load shaders: "+f;this.entity=new w(c),this.entity.init(b,h),this.entity.mesh.scale.set(g,g,g),this.entity.updateModel(),this.models=[this.entity]};return J.extend(h,J),h._assets.geometry.push(d),h._assets.texture.push(e),h._assets.shaders.push(f),h};c.Entities=c.Entities||{},c.Entities.Artifact=$,c.Entities.Artifacts=c.Entities.Artifacts||{};var _;for(_=1;13>=_;_++)c.Entities.Artifacts["Jarvis"+_]=$("Jarvis",_,!1);for(_=1;17>=_;_++)c.Entities.Artifacts["Amar"+_]=$("Amar",_,!1),c.Entities.Artifacts["AmarFrozen"+_]=$("Amar",_,!0);for(_=1;40>=_;_++)c.Entities.Artifacts["Helios"+_]=$("Helios",_,!1),c.Entities.Artifacts["HeliosFrozen"+_]=$("Helios",_,!0);var ab=function(a,b,c,d){var e=(new THREE.Vector4).copy(d),f="Artifacts"+b+"Glow",g=c+"Texture",h="portal_scanner",i=6,j=function(a,b){J.call(this,a),b=b||e;var c=a.getAsset("geometry",f),d=a.getAsset("texture",g),j=a.getAsset("shaders",h);if(!c)throw"Unable to load Geometry "+f;if(!d)throw"Unable to load texture "+g;if(!j)throw"Unable to load shaders: "+h;this.entity=new z(d,b),this.entity.init(c,j),this.entity.mesh.scale.set(i,i,i),this.entity.updateModel(),this.models=[this.entity]};return J.extend(j,J),j._assets.geometry.push(f),j._assets.texture.push(g),j._assets.shaders.push(h),j};c.Entities=c.Entities||{},c.Entities.ArtifactGlow=ab,c.Entities.ArtifactGlows=c.Entities.ArtifactGlows||{},function(){for(var a=["Jarvis","Amar","Helios"],b=0;b<a.length;b++)c.Entities.ArtifactGlows[a[b]]={Red:ab(a[b],"Red","ColorGlow",e.artifactColors[a[b]].RedGlow),Purple:ab(a[b],"Purple","ColorGlow",e.artifactColors[a[b]].PurpleGlow),Target:ab(a[b],"Target","TargetGlow",e.artifactColors[a[b]].TargetGlow),Green:ab(a[b],"Green","ColorGlow",e.teamColors.NEUTRAL)}}();var bb=function(){var a="PortalLinkTexture",b="LinkShader",c=function(c){J.call(this,c),this.linkGeometry=new o;var d=c.getAsset("texture",a),e=c.getRawShader(b);if(!d)throw"Unable to load texture "+a;if(!e)throw"Unable to load shaders: "+b;this.linkSystem=new A(d),this.linkSystem.init(this.linkGeometry,e),this.models=[this.linkSystem]};return J.extend(c,J),c._assets.texture.push(a),c._assets.rawShaders.push(b),c.prototype.addLink=function(a,b,c,d,e,f,g){if(!(g instanceof THREE.Vector4))throw"Color must be a Vector4";return this.linkGeometry.addLink({x:a,y:b,percent:c},{x:d,y:e,percent:f},g),this},c}();c.Entities=c.Entities||{},c.Entities.PortalLinkSystem=bb;var cb=function(){var a="ResonatorLinkTexture",b="LinkShader",c=function(c){J.call(this,c),this.linkGeometry=new p;var d=c.getAsset("texture",a),e=c.getRawShader(b);if(!d)throw"Unable to load texture "+a;if(!e)throw"Unable to load shaders: "+b;this.linkSystem=new A(d),this.linkSystem.init(this.linkGeometry,e),this.models=[this.linkSystem]};return J.extend(c,J),c._assets.texture.push(a),c._assets.rawShaders.push(b),c.prototype.addLink=function(a,b,c,d,e,f,g){if(!(g instanceof THREE.Vector4))throw"Color must be a Vector4";return this.linkGeometry.addLink({x:a,y:b,percent:c},{x:d,y:e,percent:f},g),this},c}();c.Entities=c.Entities||{},c.Entities.ResonatorLinkSystem=cb;var db=function(){var a="PortalShieldMesh",b="PortalShieldTexture",c="shield",d=12,f=function(f,g,h){J.call(this,f),h=h||{},g=g||e.teamColors.LOKI.clone(),this.setColor(g);var i=f.getAsset("geometry",a),j=f.getAsset("texture",b),k=f.getAsset("shaders",c);if(!i)throw"Unable to load Geometry "+a;if(!j)throw"Unable to load texture "+b;if(!k)throw"Unable to load shaders: "+c;this.effect=new B(j,this.color),this.effect.init(i,k),this.effect.mesh.scale.set(d,d,d),this.effect.updateModel(),this.models=[this.effect]};return J.extend(f,J),f._assets.geometry.push(a),f._assets.texture.push(b),f._assets.shaders.push(c),f.prototype.setColor=function(a){if(!(a instanceof THREE.Vector4))throw"Color must be a Vector4";return this.color=a,this.effect&&this.effect.setColor(this.color),this},f}();c.Entities=c.Entities||{},c.Entities.ShieldEffect=db;var eb=function(){var a="TexturedPortalMesh",b="GlowrampTexture",c="portal_scanner",d=6,f=function(e,f,g){J.call(this,e),g=g||{},f=f||"NEUTRAL",this.setTeamColor(f);var h=e.getAsset("geometry",a),i=e.getAsset("texture",b),j=e.getAsset("shaders",c);if(!h)throw"Unable to load Geometry "+a;if(!i)throw"Unable to load texture "+b;if(!j)throw"Unable to load shaders: "+c;this.portal=new z(i,this.teamColor),this.portal.init(h,j),this.portal.mesh.scale.set(d,d,d),this.portal.updateModel(),this.models=[this.portal]};return J.extend(f,J),f._assets.geometry.push(a),f._assets.texture.push(b),f._assets.shaders.push(c),f.prototype.setTeamColor=function(a){if(a instanceof THREE.Vector4)this.teamColor=a;else{if(!(a in e.teamColors))throw"Unknown team color "+a;this.teamColor=e.teamColors[a].clone()}return this.portal&&this.portal.setBaseColor(this.teamColor),this},f}();c.Entities=c.Entities||{},c.Entities.Portal=eb;var fb=function(){var a="ParticleTexture",b="particle_portals",c=function(c){J.call(this,c),this.geometry=new s;var d=c.getAsset("texture",a),e=c.getAsset("shaders",b);if(this.count=0,!d)throw"Unable to load texture "+a;if(!e)throw"Unable to load shaders: "+b;this.system=new D(d),this.system.init(this.geometry,e),this.models=[this.system]};return J.extend(c,J),c._assets.texture.push(a),c._assets.shaders.push(b),c.prototype.addSystem=function(a,b,c){var d=12+84*c/8,e=1.35+.65*c/8,f=7.5+12.5*c/8,g=30+58*c/8,h=new THREE.Vector3(a.x,a.y,a.z);return this.system.addSystem(h,b,d,e,f,g),this.geometry.addSystem(),this},c}();c.Entities=c.Entities||{},c.Entities.ParticlePortals=fb;var gb=function(a,b){var c=b||{},e={geometry:new G(a,n),texture:new I(a),shaders:new H(a)},f=Object.keys(e);return this.setAssets=function(a){return c=a,this},this.addAssets=function(a){c=h(c,a)},this.getAsset=function(a,b){return a in e?e[a].getAsset(b):null},this.getRawShader=function(a){return c&&"rawShaders"in c&&a in c.rawShaders?new t(c.rawShaders[a].vertex,c.rawShaders[a].fragment):void 0},this.preloadEntity=function(a,b){if(!("_assets"in a))throw"entity must be an instance of Entity";var g,h,i=0,j=0,k=a._assets;for(g=0;g<f.length;g++)j+=k[f[g]].length;var l=function(a,f){for(var g=function(a){i++,a&&d.warn("Unable to load asset: "+a),i===j&&b()},k=0;k<f.length;k++)h=f[k],h in c[a]?e[a].loadAsset(h,c[a][h],g):(d.warn("Unknown "+a+" asset: "+h),i++)};for(g=0;g<f.length;g++)l(f[g],k[f[g]])},this.preloadAssets=function(a){for(var b={},g=function(){for(var c=!0,d=0;d<f.length;d++)c=c&&b[f[d]].i>=b[f[d]].n;c&&setTimeout(a,0)},h=function(a){var f=Object.keys(c[a]);b[a]={i:0,n:f.length};var h=function(){if(b[a].i>=b[a].n)return void g();var i=b[a].i++;e[a].loadAsset(f[i],c[a][f[i]],function(a){a&&d.warn("Unable to load asset: "+a),setTimeout(h,0)})};h()},i=0;i<f.length;i++)h(f[i]);return function(){for(var a=Object.keys(b),c=a.length,d=0,e=0;c>e;e++)d+=b[a[e]].i/b[a[e]].n/c;return d}},this};c.AssetManager=gb;var hb=function(a,b){b=b||{};var c={cameraOptions:{fov:75,aspect:1,near:.01,far:50},shaderPrecision:"mediump",premultipliedAlpha:!0,alpha:!1,preserveDrawingBuffer:!1};this.options=g(c,b,!0);var d=Date.now(),e={},f=0;this.addDrawable=function(a,b){if(!(a instanceof u))throw"Object must be of type Drawable";if(a.id)e[a.id]=a;else{var c=f++;e[c]=a,a.id=c}a.updateView(this.camera),b||this.scene.add(a.mesh)},this.removeDrawable=function(a){if(!(a instanceof u))return!1;var b=a.id;return b in e&&(this.scene.remove(e[b].mesh),delete e[b]),!0},this.addEntity=function(a,b){if(!(a instanceof J))throw"Must pass an instance of IMV.Entity";for(var c=0;c<a.models.length;c++)this.addDrawable(a.models[c],b)},this.removeEntity=function(a){if(!(a instanceof J))return!1;for(var b=!0,c=0;c<a.models.length;c++)b=this.removeDrawable(a.models[c])&&b;return b},this.hideModel=function(a){var b=a.id;return b in e&&this.scene.remove(e[b].mesh),this},this.showModel=function(a){var b=a.id;return b in e&&this.scene.add(e[b].mesh),this},this.clearScene=function(){for(var a=Object.keys(e),b=0;b<a.length;b++)this.scene.remove(e[a[b]].mesh),delete e[a[b]];return this},this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(this.options.cameraOptions.fov,this.options.cameraOptions.aspect,this.options.cameraOptions.near,this.options.cameraOptions.far),this.renderer=new THREE.WebGLRenderer({canvas:a,precision:this.options.shaderPrecision,premultipliedAlpha:this.options.premultipliedAlpha,alpha:this.options.alpha,preserveDrawingBuffer:this.options.preserveDrawingBuffer,antialias:!0});var h=this,i=[];this.getElapsed=function(){return Date.now()-d},this.registerPeriodic=function(a){return i.push(a),this},this.unregisterPeriodic=function(a){for(var b=0;b<i.length;b++)i[b]===a&&i.splice(b,1);return this};var j=d,k=function(){var a,b=Date.now(),c=b-j;j=b;for(a in e)e.hasOwnProperty(a)&&e[a]instanceof u&&e[a].updateTime(c);var d=i.length;for(a=0;d>a;a++)i[a](c)},l=function(a){var b;for(b in e)e.hasOwnProperty(b)&&e[b]instanceof u&&e[b].updateView(a)},m=!1,n=null;this.enableOVR=function(){n||(n=new THREE.OculusRiftEffect(this.renderer),n.preLeftRender=l,n.preRightRender=l),m=!0};var o,p,q=function(){h.camera.aspect=o/p,h.camera.updateProjectionMatrix(),l(h.camera),h.renderer.setSize(o,p),n&&n.setSize(o,p)};this.updateViewport=function(a,b){o=a,p=b,q()},this.disableOVR=function(){m=!1,q()};var r=!1,s=!1,t=function(){return r?void(s=!0):(window.requestAnimationFrame(t),k(),void(m?n.render(h.scene,h.camera):(h.camera.matrixWorldNeedsUpdate&&l(h.camera),h.renderer.render(h.scene,h.camera))))};return this.suspend=function(){r||(r=!0,s=!1)},this.resume=function(){r=!1,s&&(s=!1,j=Date.now(),t())},t(),this};c.Engine=hb,c.VERSION="0.12.0",a.IMV=c}(this);
//# sourceMappingURL=ingress-model-viewer.min.js.map