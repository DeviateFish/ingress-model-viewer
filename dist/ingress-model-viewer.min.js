/*! ingress-model-viewer 05-12-2014 */
!function(a,b){"use strict";var c=function(a,c){if(!a||!c)throw"Missing dependencies";var d={teamColors:{RESISTANCE:new c.Vector4(0,.7607843137254902,1,1),ENLIGHTENED:new c.Vector4(.1568627450980392,.9568627450980393,.1568627450980392,1),NEUTRAL:new c.Vector4(.9764705882352941,.9764705882352941,.9764705882352941,1),LOKI:new c.Vector4(1,.1568627450980392,.1568627450980392,1)},qualityColors:{EXTREMELY_RARE:new c.Vector4(.9803921568627451,.39215686274509803,.39215686274509803,1),VERY_RARE:new c.Vector4(.9568627450980393,.5215686274509804,.9254901960784314,1),MORE_RARE:new c.Vector4(.7647058823529411,0,1,1),RARE:new c.Vector4(.6666666666666666,.5372549019607843,.984313725490196,1),LESS_COMMON:new c.Vector4(.45098039215686275,.6588235294117647,1,1),COMMON:new c.Vector4(.5098039215686274,.9529411764705882,.7058823529411765,1),VERY_COMMON:new c.Vector4(.6980392156862745,.6980392156862745,.6980392156862745,1),L1:new c.Vector4(.996078431372549,.807843137254902,.35294117647058826,1),L2:new c.Vector4(1,.6509803921568628,.18823529411764706,1),L3:new c.Vector4(1,.45098039215686275,.08235294117647059,1),L4:new c.Vector4(.8941176470588236,0,0,1),L5:new c.Vector4(.9921568627450981,.1607843137254902,.5725490196078431,1),L6:new c.Vector4(.9215686274509803,.14901960784313725,.803921568627451,1),L7:new c.Vector4(.7568627450980392,.1411764705882353,.8784313725490196,1),L8:new c.Vector4(.5882352941176471,.15294117647058825,.9568627450980393,1)},anomalyColors:{1:new c.Vector4(1,.5686274509803921,.21176470588235294,1),2:new c.Vector4(1,.3215686274509804,.9058823529411765,1),3:new c.Vector4(.6196078431372549,.35294117647058826,1,1),4:new c.Vector4(.8431372549019608,.27058823529411763,.27058823529411763,1),5:new c.Vector4(1,.9450980392156862,0,1),6:new c.Vector4(.6509803921568628,1,.9019607843137255,1),7:new c.Vector4(.5725490196078431,.5803921568627451,.592156862745098,1)},artifactColors:{Helios:{artifactsRedGlow:new c.Vector4(.92,.51,.14,1),artifactsPurpleGlow:new c.Vector4(1,.87,.55,1),artifactTargetGlow:new c.Vector4(1,.72,0,1)},Amar:{artifactTargetGlow:new c.Vector4(.62,.22,.62,1),artifactsRedGlow:new c.Vector4(.79,.11,.49,1),artifactsPurpleGlow:new c.Vector4(.58,.17,1,1)},Jarvis:{artifactTargetGlow:new c.Vector4(.62,.22,.62,1),artifactsRedGlow:new c.Vector4(.79,.11,.49,1),artifactsPurpleGlow:new c.Vector4(.58,.17,1,1)}}},e=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a},f=function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(a[d]=c&&"object"==typeof a[d]&&"object"==typeof b[d]?f(a[d],b[d],c):b[d]);return a},g=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]="object"==typeof a[c]&&"object"==typeof b[c]?g(a[c],b[c]):b[c]);return a},h=function(a,b,c){if("image"===b||"image.co"===b){var d=new Image;"image.co"===b&&(d.crossOrigin="anoymous"),d.onload=function(){c(null,this)},d.onerror=function(a){c(a,null)},d.src=a}else{var e=new XMLHttpRequest;e.open("GET",a),e.responseType=b,e.onload=function(){c(null,this.response)},e.onerror=function(a){c(a,null)},e.send()}},i=function(a,b){var c={};for(var d in a)if(!(!a.hasOwnProperty(d)||b&&d in b)){var e=a[d];c[d]="object"==typeof e.value&&"clone"in e.value?{type:e.type,value:e.value.clone()}:{type:e.type,value:e.value}}return c},j=function(a,b){var c={};for(var d in a)!a.hasOwnProperty(d)||b&&d in b||(c[d]=a[d]);return c},k=function(a,b,c,d){d=d||0;var e=0,f=a.length,g=function(){return e>=f?void c():(b(a[e],e),e++,void setTimeout(g,d))};setTimeout(g,0)},l=function(a,b){a=a||"text",b=b||function(a){return a};var c={},d={};this.loadAsset=function(e,f,g,i){return d[e]?void g(null,d[e]):(c[e]=c[e]||[],c[e].push(g),void(d.hasOwnProperty(e)||(d[e]=!1,h(f,a,function(a,f){a||(f=b(f,i),d[e]=f);for(var g;g=c[e].shift();)g(a,f)}))))},this.getAsset=function(a){return d[a]}},m=function(){var a=Math.PI/2,b=5,d=function(a){return{identifier:a.identifier,x:a.clientX,y:a.clientY}},e=function(a,b){for(var c=0;c<a.length;c++)if(a[c].identifier==b.identifier)return c;return-1},g=function(a,b,d){d=d||{},this.canvas=a,this.distance=b||2,this.distanceTarget=this.distance;var e={zoomDamp:.5,distanceScale:.25,distanceMax:1e3,distanceMin:1,touchScale:.1,wheelScale:.01,friction:.1,target:new c.Vector3,allowZoom:!0};this.options=f(e,d),this.mouse={x:0,y:0},this.mouseOnDown={x:0,y:0},this.rotation={x:0,y:0},this.target={x:3*Math.PI/2,y:Math.PI/6},this.targetOnDown={x:0,y:0},this.overRenderer=!1,this.mouseMove=this.onMouseMove.bind(this),this.mouseUp=this.onMouseUp.bind(this),this.mouseOut=this.onMouseOut.bind(this),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.options.allowZoom&&this.canvas.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.touches=[],this.touchDelta=0,this.touchMove=this.onTouchMove.bind(this),this.touchEnd=this.onTouchEnd.bind(this),this.touchLeave=this.onTouchLeave.bind(this),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this),!1);var g=this;this.canvas.addEventListener("mouseover",function(){g.overRenderer=!0},!1),this.canvas.addEventListener("mouseout",function(){g.overRenderer=!1},!1)};return g.prototype.updateTargets=function(){var c=this.distance<b?this.distance:Math.log(this.distance),d=c/this.options.zoomDamp;this.target.x=this.targetOnDown.x+.005*(this.mouse.x-this.mouseOnDown.x)*d,this.target.y=this.targetOnDown.y+.005*(this.mouse.y-this.mouseOnDown.y)*d,this.target.y=this.target.y>a?a:this.target.y,this.target.y=this.target.y<-a?-a:this.target.y},g.prototype.onMouseDown=function(a){a.preventDefault(),this.canvas.addEventListener("mousemove",this.mouseMove,!1),this.canvas.addEventListener("mouseup",this.mouseUp,!1),this.canvas.addEventListener("mouseout",this.mouseOut,!1),this.mouseOnDown.x=-a.clientX,this.mouseOnDown.y=a.clientY,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y,this.canvas.style.cursor="move"},g.prototype.onMouseMove=function(a){this.mouse.x=-a.clientX,this.mouse.y=a.clientY,this.updateTargets()},g.prototype.onMouseUp=function(a){this.onMouseOut(a),this.canvas.style.cursor="auto"},g.prototype.onMouseOut=function(){this.canvas.removeEventListener("mousemove",this.mouseMove,!1),this.canvas.removeEventListener("mouseup",this.mouseUp,!1),this.canvas.removeEventListener("mouseout",this.mouseOut,!1)},g.prototype.updateCamera=function(a){this.rotation.x+=(this.target.x-this.rotation.x)*this.options.friction,this.rotation.y+=(this.target.y-this.rotation.y)*this.options.friction,this.distance+=(this.distanceTarget-this.distance)*this.options.distanceScale,a.position.x=this.distance*Math.sin(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target.x,a.position.y=this.distance*Math.sin(this.rotation.y)+this.options.target.y,a.position.z=this.distance*Math.cos(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target.z,a.lookAt(this.options.target)},g.prototype.onMouseWheel=function(a){return a.preventDefault(),this.overRenderer&&this.zoom(a.wheelDeltaY*this.options.wheelScale*(this.distance<b?this.distance:Math.log(this.distance))),!1},g.prototype.onTouchStart=function(a){a.preventDefault(),0==this.touches.length&&(this.canvas.addEventListener("touchmove",this.touchMove,!1),this.canvas.addEventListener("touchend",this.touchEnd,!1),this.canvas.addEventListener("touchleave",this.touchLeave,!1));for(var b=0;b<a.changedTouches.length;b++)this.touches.push(d(a.changedTouches[b]));if(1==this.touches.length)this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y;else if(2==this.touches.length&&this.options.allowZoom){var c=Math.abs(this.touches[0].x-this.touches[1].x),e=Math.abs(this.touches[0].y-this.touches[1].y);this.touchDelta=Math.sqrt(c*c+e*e)}this.canvas.style.cursor="move"},g.prototype.onTouchMove=function(a){for(var b=a.changedTouches,c=b.length,f=0;c>f;f++){var g=e(this.touches,b[f]);g>=0?this.touches.splice(g,1,d(b[f])):console.log("could not find event ",b[f])}if(1==this.touches.length)this.mouse.x=-this.touches[0].x,this.mouse.y=this.touches[0].y,this.updateTargets();else if(2==this.touches.length&&this.options.allowZoom){var h=this.touches[0].x-this.touches[1].x,i=this.touches[0].y-this.touches[1].y,j=Math.sqrt(h*h+i*i);this.zoom((j-this.touchDelta)*this.options.touchScale),this.touchDelta=j}},g.prototype.removeTouches=function(a){for(var b=a.changedTouches,c=b.length,d=0;c>d;d++){var f=e(this.touches,b[d]);f>=0&&this.touches.splice(f,1)}0==this.touches.length?(this.canvas.removeEventListener("touchmove",this.touchMove,!1),this.canvas.removeEventListener("touchend",this.touchEnd,!1),this.canvas.removeEventListener("touchleave",this.touchLeave,!1)):1==this.touches.length&&(this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y)},g.prototype.onTouchEnd=function(a){this.removeTouches(a),this.canvas.style.cursor="auto"},g.prototype.onTouchLeave=function(a){this.removeTouches(a)},g.prototype.onTouchCancel=function(a){this.removeTouches(a)},g.prototype.zoom=function(a){this.distanceTarget-=a,this.distanceTarget=Math.min(this.distanceTarget,this.options.distanceMax),this.distanceTarget=Math.max(this.distanceTarget,this.options.distanceMin)},g}(),n=function(a){this.geometry=new c.BufferGeometry,this.transparent=a&&a.transparent||!1,this.attributes={}};n.prototype.getAttributeNames=function(){return Object.keys(this.attributes)};var o=function(){var b=function(a,b,c){for(var d=0;d<Math.floor(a.length/b);d++)c(a.subarray(d*b,(d+1)*b),d)},d=function(a){var b,c,d,e,f,g=new DataView(a),h=0,i=g.getUint32(h);h+=4;for(var j=[],k=0;i>k;k++){for(b=g.getUint32(h),1!=b&&16!=b&&console.warn("unknown type "+b),h+=4,c=g.getUint32(h),h+=4,d=g.getUint16(h),h+=2,f="",e=0;d>e;e++)f+=String.fromCharCode(g.getUint8(h+e));h+=d,j.push({name:f,type:b,size:c})}return j},f=function(e){var f,g,h,i=new a(e.buf),j=i.getStream(),k=j.getContents(),l=k[3].contents.toArray(),m=0,n=d(l),o=n.length,p=k[0].contents.toArray(),q=[];for(f=0;o>f;f++)g=n[f],h="v"+g.size,m+=g.size,e.attributes[g.name]={type:h,values:null};var r=Math.floor(p.length/m);for(f=0;o>f;f++)q.push(new Float32Array(n[f].size*r));var s=new Float32Array(3*r);for(b(p,m,function(a,b){var c,d=0;for(c=0;o>c;c++){for(var e=n[c].size,f=0;e>f;f++)q[c][b*e+f]=a[d+f];d+=e}for(c=0;3>c;c++)s[b+c]=a[c]}),f=0;o>f;f++)g=n[f],e.geometry.addAttribute(g.name,new c.BufferAttribute(q[f],g.size));e.geometry.addAttribute("position",new c.BufferAttribute(s,3));var t=k[1].contents.toArray(),u=new Uint16Array(t.length);u.set(t),e.geometry.addAttribute("index",new c.BufferAttribute(u,1))},g=function(a,b){return n.call(this,b),this.buf=a,f(this),this};return e(g,n),g}(),p=function(){for(var a=9,b=6*a,d=new Array(a),f=new Array(a),g=new Array(a),h=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},i=0;a>i;i++){var j=i/8;d[i]=j,g[i]=3+-1.5*Math.pow(h(2*Math.abs(j-.5)),4),f[i]=h(1-2*Math.abs(j-.5))}var k=new c.Vector4(.46,.18,.18,1),l=new c.Vector3,m=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=4*e;a[3*e+0]=f,a[3*e+1]=g,a[3*e+2]=h,b[n+0]=f,b[n+1]=g,b[n+2]=h,b[n+3]=l,c[n+0]=i,c[n+1]=j,c[n+2]=k.x,c[n+3]=k.z,d[n+0]=m.x,d[n+1]=m.y,d[n+2]=m.z,d[n+3]=m.w},o=function(a){a=a||{},a.transparent=!0,n.call(this,a),this.position=new c.BufferAttribute(new Float32Array,3),this.index=new c.BufferAttribute(new Uint16Array,1),this.a_position=new c.BufferAttribute(new Float32Array,4),this.a_texCoord0=new c.BufferAttribute(new Float32Array,4),this.a_color=new c.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_texCoord0:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.linkCount=0};return e(o,n),o.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},o.prototype.addLink=function(e,h,i,j){j=j||Math.sqrt((h.x-e.x)*(h.x-e.x)+(h.y-e.y)*(h.y-e.y));for(var n=l.y,o=n+Math.min(30,.08*j),p=e.percent,q=h.percent,r=(p+q)/2,s=.01*j,t=.1+.3*r,u=new c.Vector3(h.x,0,h.y).sub(new c.Vector3(e.x,0,e.y)),v=new c.Vector3(0,1,0),w=u.clone().cross(v).normalize(),x=this.extendBuffer(this.a_position,b),y=this.extendBuffer(this.a_texCoord0,b),z=this.extendBuffer(this.a_color,b),A=this.extendBuffer(this.position,b),B=this.linkCount*b,C=2*a,D=0;a>D;D++){var E=d[D],F=p+E*(q-p),G=.6+.35*F,H=E*s,I=e.x+E*u.x,J=e.y+E*u.z,K=n+f[D]*(o-n),L=g[D],M=k.clone();M.lerp(i,.25+.75*F),M.w=G,m(A,x,y,z,B+2*D,I+L*w.x,K,J+L*w.z,0,H,v,t,M),m(A,x,y,z,B+2*D+1,I-L*w.x,K,J-L*w.z,.5,H,v,t,M),m(A,x,y,z,B+C+2*D,I,K+L,J,0,H,w,t,M),m(A,x,y,z,B+C+2*D+1,I,K-L,J,.5,H,w,t,M),m(A,x,y,z,B+2*C+2*D,I,K-L,J,.5,H,w,t,M),m(A,x,y,z,B+2*C+2*D+1,I,0,J,1,H,w,t,M)}var N=new Uint16Array(144*(this.linkCount+1));N.set(this.index.array);var O=this.linkCount*b,P=144*this.linkCount;for(D=0;3>D;D++){for(var Q=0;a-1>Q;Q++)N[P+0]=O+1,N[P+1]=O+0,N[P+2]=O+2,N[P+3]=O+1,N[P+4]=O+2,N[P+5]=O+3,O+=2,P+=6;O+=2}return this.linkCount++,this.index.array=N,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this},o}(),q=function(){for(var a=5,b=4*a,d=new Array(a),f=new Array(a),g=new Array(a),h=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},i=0;a>i;i++){var j=i/4;d[i]=j,g[i]=3.5*Math.max(1-Math.pow(h(2*Math.abs(j-.5)),4),.2),f[i]=h(1-2*Math.abs(j-.5))}var k=new c.Vector4(.78,.31,.31,1),l=new c.Vector3,m=new c.Vector3,o=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=4*e;a[3*e+0]=f,a[3*e+1]=g,a[3*e+2]=h,b[n+0]=f,b[n+1]=g,b[n+2]=h,b[n+3]=l,c[n+0]=i,c[n+1]=j,c[n+2]=k.x,c[n+3]=k.z,d[n+0]=m.x,d[n+1]=m.y,d[n+2]=m.z,d[n+3]=m.w},p=function(a){a=a||{},a.transparent=!0,n.call(this,a),this.position=new c.BufferAttribute(new Float32Array,3),this.index=new c.BufferAttribute(new Uint16Array,1),this.a_position=new c.BufferAttribute(new Float32Array,4),this.a_texCoord0=new c.BufferAttribute(new Float32Array,4),this.a_color=new c.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_texCoord0",this.a_texCoord0),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_texCoord0:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.linkCount=0};return e(p,n),p.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},p.prototype.addLink=function(e,h,i){var j=Math.sqrt((h.x-e.x)*(h.x-e.x)+(h.y-e.y)*(h.y-e.y)),n=m.y,p=l.y,q=h.percent,r=2/30*j,s=.9+.1*q,t=.65+.35*q,u=.75+.25*q,v=.1+.3*q,w=k.clone();w.lerp(i,.1+.85*q),w.w=u*w.w;for(var x=new c.Vector3(h.x,0,h.y).sub(new c.Vector3(e.x,0,e.y)),y=new c.Vector3(0,1,0),z=x.clone().cross(y).normalize(),A=this.extendBuffer(this.a_position,b),B=this.extendBuffer(this.a_texCoord0,b),C=this.extendBuffer(this.a_color,b),D=this.extendBuffer(this.position,b),E=this.linkCount*b,F=2*a,G=5*(e.x+e.y-Math.floor(e.x+e.y)),H=0;a>H;H++){var I=d[H],J=e.x+I*x.x,K=e.y+I*x.z,L=p+I*(n-p)+s*f[H],M=t*g[H],N=I*r;o(D,A,B,C,E+2*H+0,J+M*z.x,L,K+M*z.z,0,N+G,y,v,w),o(D,A,B,C,E+2*H+1,J-M*z.x,L,K-M*z.z,1,N+G,y,v,w),o(D,A,B,C,E+F+2*H+0,J,L+M,K,0,N+G,z,v,w),o(D,A,B,C,E+F+2*H+1,J,L-M,K,1,N+G,z,v,w)}var O=new Uint16Array(48*(this.linkCount+1));O.set(this.index.array);var P=this.linkCount*b,Q=48*this.linkCount;for(H=0;2>H;H++){for(var R=0;a-1>R;R++)O[Q+0]=P+1,O[Q+1]=P+0,O[Q+2]=P+2,O[Q+3]=P+1,O[Q+4]=P+2,O[Q+5]=P+3,P+=2,Q+=6;P+=2}return this.linkCount++,this.index.array=O,this.position.needsUpdate=!0,this.index.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_texCoord0.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this},p}(),r=function(){var a=function(a,b,c,d,e,f,g,h){var i=4*d;return a[3*d+0]=e.x,a[3*d+1]=0,a[3*d+2]=e.y,b[i+0]=e.x,b[i+1]=e.y,b[i+2]=f,b[i+3]=g,c[i+0]=h.x,c[i+1]=h.y,c[i+2]=h.z,c[i+3]=h.w,d+1},b=function(b,c,d,e,f,g,h,i,j,k,l){return a(b,c,d,a(b,c,d,a(b,c,d,e,f,0,g,l),h,0,i,l),j,((h.x-f.x)*(f.y-j.y)-(h.y-f.y)*(f.x-j.x))/f.distanceTo(h),k,l)},d=function(a){a=a||{},a.transparent=!0,n.call(this,a),this.position=new c.BufferAttribute(new Float32Array,3),this.index=new c.BufferAttribute(new Uint16Array,1),this.a_position=new c.BufferAttribute(new Float32Array,4),this.a_color=new c.BufferAttribute(new Float32Array,4),this.geometry.addAttribute("position",this.position),this.geometry.addAttribute("index",this.index),this.geometry.addAttribute("a_position",this.a_position),this.geometry.addAttribute("a_color",this.a_color),this.attributes={a_position:{type:"v4",values:null},a_color:{type:"v4",values:null}},this.fieldCount=0,this.lastOffset=0};return e(d,n),d.prototype.extendBuffer=function(a,b){var c=new Float32Array(a.length+b*a.itemSize);return c.set(a.array),a.array=c,c},d.prototype.addField=function(a,d,e,f,g){g=1;var h=1.1,i=a.percent,j=d.percent,k=e.percent,l=this.extendBuffer(this.position,9),m=this.extendBuffer(this.a_position,9),n=this.extendBuffer(this.a_color,9);if(1>g){var o=Math.max(0,g);h=1.1*o;var p=o*o;i*=p,j*=p,k*=p}var q=new c.Vector2(a.x,a.y),r=new c.Vector2(d.x,d.y),s=new c.Vector2(e.x,e.y),t=q.clone().add(r).add(s).multiplyScalar(.333333333333),u=this.lastOffset;this.lastOffset=b(l,m,n,this.lastOffset,q,i,r,j,t,h,f),this.lastOffset=b(l,m,n,this.lastOffset,r,j,s,k,t,h,f),this.lastOffset=b(l,m,n,this.lastOffset,s,k,q,i,t,h,f);var v=new Uint16Array(9*(this.fieldCount+1));v.set(this.index.array);for(var w=0;9>w;w++)v[u+w]=u+w;return this.index.array=v,this.index.needsUpdate=!0,this.position.needsUpdate=!0,this.a_position.needsUpdate=!0,this.a_color.needsUpdate=!0,this.geometry.needsUpdate=!0,this.fieldCount++,this.fieldCount},d}(),s=function(){var a=function(a,b){return[a,0,b]},b=function(b,d){n.call(this,d),b=b||a,d=d||{};var e={slices:1,paramSize:3};this.options=f(e,d);var g=b(0,0);if(!g.length||g.length!=this.options.paramSize)throw"Parametric function returned invalid results, must be array of length "+this.options.paramSize;this.attributes={a_position:{type:"v"+this.options.paramSize,values:null},a_texCoord0:{type:"v2",values:null}};for(var h=this.options.slices,i=this.options.paramSize,j=(h+1)*(h+1),k=new Float32Array(3*j),l=new Float32Array(j*i),m=new Float32Array(2*j),o=new Uint16Array(h*h*3*2),p=0,q=0;h>=q;q++)for(var r=0;h>=r;r++){var s=q/h,t=r/h,u=b(s,t),v=q*(h+1)+r;m[2*v]=s,m[2*v+1]=t;for(var w=0;i>w;w++)l[v*i+w]=u[w],3>w&&(k[v*i+w]=u[w]);3>i&&(k[3*v+2]=0),h>q&&h>r&&(o[p++]=v,o[p++]=v+1,o[p++]=v+h+1,o[p++]=v+h+1,o[p++]=v+1,o[p++]=v+h+2)}this.geometry.addAttribute("a_position",new c.BufferAttribute(l,i)),this.geometry.addAttribute("a_texCoord0",new c.BufferAttribute(m,2)),this.geometry.addAttribute("position",new c.BufferAttribute(k,3)),this.geometry.addAttribute("index",new c.BufferAttribute(o,1))};return e(b,n),b}(),t=function(a,b){this.base=a,b=b||n,this.geometries=new l("arraybuffer",function(a,c){return new b(a,c)})};t.prototype.loadAsset=function(a,b,c){this.geometries.loadAsset(a,this.base+b.path,c,b)},t.prototype.getAsset=function(a){return this.geometries.getAsset(a)};var u=function(){var a={mat4:"m4",vec4:"v4",vec3:"v3",vec2:"v2","float":"f",sampler2D:"t","int":"i"},b=function(b){for(var c,d=/uniform ([^ ]+) ([^;]+);/gi,e={};null!==(c=d.exec(b));){var f=c[1];a.hasOwnProperty(f)?f=a[f]:console.warn("no known conversion from "+f),e[c[2]]={type:f}}return e},c=function(b){for(var c,d=/attribute ([^ ]+) ([^;]+);/gi,e={};null!==(c=d.exec(b));){var f=c[1];a.hasOwnProperty(f)?f=a[f]:console.warn("no known conversion from "+f),e[c[2]]={type:f}}return e},d=function(a,d){this.vertex=a,this.fragment=d,this.uniforms=b(a+"\n"+d),this.attributes=c(a+"\n"+d)};return d.prototype.getUniformsList=function(){return Object.keys(this.uniforms)},d.prototype.getAttributesList=function(){return Object.keys(this.attributes)},d}(),v=function(a){this.base=a,this.vertex=new l("text"),this.fragment=new l("text")};v.prototype.loadAsset=function(a,b,c){var d={},e=!1,f=function(){!e&&d.fragment&&d.vertex&&(e=!0,c(null,new u(d.vertex,d.fragment)))};this.vertex.loadAsset(a,this.base+b.vertex,function(a,b){return a?void c(a,null):(d.vertex=b,void f())}),this.fragment.loadAsset(a,this.base+b.fragment,function(a,b){return a?void c(a,null):(d.fragment=b,void f())})},v.prototype.getAsset=function(a){var b=this.vertex.getAsset(a),c=this.fragment.getAsset(a);return b&&c?new u(b,c):null};var w=function(){var a={MipMapLinearLinear:c.LinearMipMapLinearFilter,Linear:c.LinearFilter,MipMapLinearNearest:c.LinearMipMapNearestFilter,MipMapNearestLinear:c.NearestMipMapLinearFilter,Nearest:c.NearestFilter,Repeat:c.RepeatWrapping,ClampToEdge:c.ClampToEdgeWrapping},d=function(b){return a.hasOwnProperty(b)?b=a[b]:console.warn("unknown type "+b),b},e=function(a){this.base=a,this.metadata={},this.textures=new l("image",function(a,e){var f=d(e.magFilter),g=d(e.minFilter),h=d(e.wrapS),i=d(e.wrapT),j=new c.Texture(a,b,h,i,f,g);return j.flipY=!1,j.needsUpdate=!0,j})};return e.prototype.loadAsset=function(a,b,c){this.textures.loadAsset(a,this.base+b.path,c,b)},e.prototype.getAsset=function(a){return this.textures.getAsset(a)},e}(),x=function(){var a=function(a,b,d){this.geometry=a,this.texture=b,this.texture.needsUpdate=!0,this.shaders=d,this.uniforms={},this.uniforms.u_texture={type:"t",value:this.texture};var e={uniforms:this.uniforms,attributes:this.geometry.attributes,vertexShader:this.shaders.vertex,fragmentShader:this.shaders.fragment,transparent:this.geometry.transparent,side:c.DoubleSide,depthWrite:!this.geometry.transparent};this.material=new c.RawShaderMaterial(e),this.mesh=new c.Mesh(this.geometry.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.updateMatrix(),this.mesh.matrixAutoUpdate=!1,this.id=null};return a.prototype.setUniform=function(a,b){return a in this.material.uniforms&&b.type!=this.material.uniforms[a].type?(console.warn("uniform type mismatch"),!1):(this.uniforms[a]=b,this.material.needsUpdate=!0,this)},a.prototype.clone=function(){var b=j(this.uniforms,{u_texture:1,u_modelViewProject:1});return new a(this.geometry,this.texture,this.shaders,b,this.options)},a}(),y=function(a,b){var c=b||{},d={model:new t(a,o),texture:new w(a),shaders:new v(a)},e=Object.keys(d);return this.loadModel=function(a,b){var f,g={},h=!1,i=function(){!h&&g.model&&g.texture&&g.shaders&&(h=!0,b(null,new x(g.model,g.texture,g.shaders)))};for(f=0;f<e.length;f++){var j=e[f];if(!(a[j]in c[j]))return console.warn("unknown "+j+": "+a[j]),!1}for(f=0;f<e.length;f++)!function(e){d[e].loadAsset(a[e],c[e][a[e]],function(a,c){return a?void b(a,null):(g[e]=c,void i())})}(e[f]);return this},this.setAssets=function(a){return c=a,this},this.addAssets=function(a){c=g(c,a)},this.getAsset=function(a,b){return a in d?d[a].getAsset(b):null},this.getModel=function(a,b,c){var e=d.model.getAsset(a),f=d.texture.getAsset(b),g=d.shaders.getAsset(c);return e&&f&&g?new x(e,f,g):null},this.getRawShader=function(a){return c&&"rawShaders"in c&&a in c.rawShaders?new u(c.rawShaders[a].vertex,c.rawShaders[a].fragment):void 0},this.preloadAssets=function(a){for(var b={},f=function(){for(var c=!0,d=0;d<e.length;d++)c=c&&b[e[d]].i>=b[e[d]].n;c&&setTimeout(a,0)},g=0;g<e.length;g++)!function(a){var e=Object.keys(c[a]);b[a]={i:0,n:e.length};var g=function(){if(b[a].i>=b[a].n)return void f();var h=b[a].i++;d[a].loadAsset(e[h],c[a][e[h]],function(a){a&&console.warn("Unable to load asset: "+a),setTimeout(g,0)})};g()}(e[g]);return function(){for(var a=Object.keys(b),c=a.length,d=0,e=0;c>e;e++)d+=b[a[e]].i/b[a[e]].n/c;return d}},this},z=function(a,b){b=b||{};var e={cameraOptions:{fov:75,aspect:1,near:.01,far:50},shaderPrecision:"mediump",premultipliedAlpha:!0,alpha:!1,preserveDrawingBuffer:!1,assetsBase:"/assets/"};this.options=f(e,b,!0);var g=new c.Matrix4,h=new c.Vector3,i={u_color0:{type:"v4",value:new c.Vector4},u_color1:{type:"v4",value:new c.Vector4(235/256,179/256,.890625,1)},u_rotation:{type:"f",value:0},u_rampTarget:{type:"f",value:.5},u_alpha:{type:"f",value:.6},u_baseColor:{type:"v4",value:(new c.Vector4).copy(d.teamColors.RESISTANCE)},u_altColor:{type:"v4",value:new c.Vector4(.6,.4,.6,.8)},u_teamColor:{type:"v4",value:new c.Vector4(235/256,179/256,.890625,1)},u_elapsedTime:{type:"f",value:0},u_color:{type:"v4",value:(new c.Vector4).copy(d.teamColors.RESISTANCE)},u_rampTargetInvWidth:{type:"v2",value:new c.Vector2(.5,1.5)},u_contributionsAndAlpha:{type:"v3",value:new c.Vector3(.5,.5,.5)},u_modelViewProject:{type:"m4",value:g},u_cameraFwd:{type:"v3",value:h},u_modelToTexScale:{type:"v2",value:new c.Vector2(.00666666667,.00666666667)},u_modelToTexOrigin:{type:"v2",value:new c.Vector2(0,0)},u_texCoordOffset0:{type:"v2",value:new c.Vector2(0,0)},u_texCoordOffset1:{type:"v2",value:new c.Vector2(0,0)},u_texture:{type:"t",value:null}};this.getUniform=function(a){return i[a]},this.setUniform=function(a,b){return a in i&&(i[a].value=b),this},this.replaceGlobalUniform=function(a,b){return a in i&&i[a].type==b.type&&(i[a]=b),this.updateModels(),this};var j={};this.updateModels=function(){for(var a in j)j.hasOwnProperty(a)&&(j[a].material.needsUpdate=!0)};var k=0;this.ensureDefaultUniforms=function(a){for(var b=a.shaders.getUniformsList(),c=0;c<b.length;c++){var d=b[c];i.hasOwnProperty(d)?a.uniforms.hasOwnProperty(d)||a.setUniform(d,i[d]):console.log("unknown uniform: "+d)}},this.addModel=function(a,b){if(!(a instanceof x))throw"Object must be of type Model";if(a.id)j[a.id]=a;else{var d=k++;j[d]=a,a.id=d,a.setUniform("u_modelViewProject",{type:"m4",value:new c.Matrix4}),this.ensureDefaultUniforms(a)}b||this.scene.add(a.mesh)},this.removeModel=function(a){var b=a.id;return b in j&&(this.scene.remove(j[b].mesh),delete j[b]),this},this.hideModel=function(a){var b=a.id;return b in j&&this.scene.remove(j[b].mesh),this},this.showModel=function(a){var b=a.id;return b in j&&this.scene.add(j[b].mesh),this},this.clearScene=function(){for(var a in j)j.hasOwnProperty(a)&&this.scene.remove(j[a].mesh);return this},this.scene=new c.Scene,this.camera=new c.PerspectiveCamera(this.options.cameraOptions.fov,this.options.cameraOptions.aspect,this.options.cameraOptions.near,this.options.cameraOptions.far),this.renderer=new c.WebGLRenderer({canvas:a,precision:this.options.shaderPrecision,premultipliedAlpha:this.options.premultipliedAlpha,alpha:this.options.alpha,preserveDrawingBuffer:this.options.preserveDrawingBuffer,antialias:!0}),this.updateViewport=function(a,b){this.camera.aspect=a/b,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,b)};var l=0,m=this,n=[];this.getTick=function(){return l},this.registerPeriodic=function(a){return n.push(a),this},this.unregisterPeriodic=function(a){for(var b=0;b<n.length;b++)n[b]===a&&n.splice(b,1);return this};var o=!1,p=!1,q=function(){if(o)return void(p=!0);requestAnimationFrame(q),g.multiplyMatrices(m.camera.projectionMatrix,m.camera.matrixWorldInverse),h.set(0,0,-1).applyQuaternion(m.camera.quaternion);var a;for(a in j)j.hasOwnProperty(a)&&"u_modelViewProject"in j[a].uniforms&&(j[a].uniforms.u_modelViewProject.value.copy(g),j[a].uniforms.u_modelViewProject.value.multiply(j[a].mesh.matrixWorld),j[a].material.needsUpdate=!0);m.renderer.render(m.scene,m.camera);var b=n.length;for(a=0;b>a;a++)n[a](l);l++};return this.suspend=function(){o||(o=!0,p=!1)},this.resume=function(){o=!1,p&&(p=!1,q())},q(),this},A={AssetLoader:l,Geometry:{IngressGeometry:o,ParametricGeometry:s,Geometry:n,ResonatorLinkGeometry:q,PortalLinkGeometry:p,FieldGeometry:r},Model:x,Controls:{OrbitControls:m},ShaderSet:u,AssetManager:y,Engine:z,Constants:d,Utilities:{cloneUniforms:i,copyUniforms:j,loadResource:h,asyncForeach:k,setParams:f,inherits:e},VERSION:"0.0.0"};return A}(JavaDeserializer,THREE);a.IMV=c}(this);