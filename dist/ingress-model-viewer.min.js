/*! ingress-model-viewer 20-04-2015 */

!function(a,b){"use strict";var c={};if(!JavaDeserializer||!glMatrix||!libtga)throw"Missing dependencies";var d=window.console||{log:function(){},warn:function(){},info:function(){}};!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var e={teamColors:{RESISTANCE:vec4.fromValues(0,.7607843137254902,1,1),ENLIGHTENED:vec4.fromValues(.1568627450980392,.9568627450980393,.1568627450980392,1),NEUTRAL:vec4.fromValues(.9764705882352941,.9764705882352941,.9764705882352941,1),LOKI:vec4.fromValues(1,.1568627450980392,.1568627450980392,1)},qualityColors:{EXTREMELY_RARE:vec4.fromValues(.9803921568627451,.39215686274509803,.39215686274509803,1),VERY_RARE:vec4.fromValues(.9568627450980393,.5215686274509804,.9254901960784314,1),MORE_RARE:vec4.fromValues(.7647058823529411,0,1,1),RARE:vec4.fromValues(.6666666666666666,.5372549019607843,.984313725490196,1),LESS_COMMON:vec4.fromValues(.45098039215686275,.6588235294117647,1,1),COMMON:vec4.fromValues(.5098039215686274,.9529411764705882,.7058823529411765,1),VERY_COMMON:vec4.fromValues(.6980392156862745,.6980392156862745,.6980392156862745,1),L1:vec4.fromValues(.996078431372549,.807843137254902,.35294117647058826,1),L2:vec4.fromValues(1,.6509803921568628,.18823529411764706,1),L3:vec4.fromValues(1,.45098039215686275,.08235294117647059,1),L4:vec4.fromValues(.8941176470588236,0,0,1),L5:vec4.fromValues(.9921568627450981,.1607843137254902,.5725490196078431,1),L6:vec4.fromValues(.9215686274509803,.14901960784313725,.803921568627451,1),L7:vec4.fromValues(.7568627450980392,.1411764705882353,.8784313725490196,1),L8:vec4.fromValues(.5882352941176471,.15294117647058825,.9568627450980393,1)},anomalyColors:{1:vec4.fromValues(1,.5686274509803921,.21176470588235294,1),2:vec4.fromValues(1,.3215686274509804,.9058823529411765,1),3:vec4.fromValues(.6196078431372549,.35294117647058826,1,1),4:vec4.fromValues(.8431372549019608,.27058823529411763,.27058823529411763,1),5:vec4.fromValues(1,.9450980392156862,0,1),6:vec4.fromValues(.6509803921568628,1,.9019607843137255,1),7:vec4.fromValues(.5725490196078431,.5803921568627451,.592156862745098,1)},artifactGlowColors:{Helios:{Red:vec4.fromValues(.92,.51,.14,1),Purple:vec4.fromValues(1,.87,.55,1),Target:vec4.fromValues(1,.72,0,1)},Amar:{Target:vec4.fromValues(.62,.22,.62,1),Red:vec4.fromValues(.79,.11,.49,1),Purple:vec4.fromValues(.58,.17,1,1)},Jarvis:{Target:vec4.fromValues(.62,.22,.62,1),Red:vec4.fromValues(.79,.11,.49,1),Purple:vec4.fromValues(.58,.17,1,1)},Shonin:{Red:vec4.fromValues(.78,.84,1,1),Purple:vec4.fromValues(.25,.81,1,1),Target:vec4.fromValues(.7,.7,.7,1)},Lightman:{Red:vec4.fromValues(1,.44,.45,1),Purple:vec4.fromValues(1,.24,.25,1),Target:vec4.fromValues(.74,0,.02,1)}},xmColors:{coreGlow:vec4.fromValues(.92,.7,.89,1),coreGlowAlt:vec4.fromValues(.6,.4,.6,.8),coreGlowAda:vec4.fromValues(0,.7607843137254902,1,1),coreGlowJarvis:vec4.fromValues(.1568627450980392,.9568627450980393,.1568627450980392,1)},Mesh:{Inventory:{Xmp:"XmpMesh",XmpXm:"XmpXMMesh",Ultrastrike:"UltrastrikeMesh",UltrastrikeXm:"UltrastrikeXMMesh",ResShield:"ResShieldMesh",ResShieldXm:"ResShieldXMMesh",PowerCube:"PowerCubeMesh",PowerCubeXm:"PowerCubeXmMesh",LinkAmp:"LinkAmpMesh",LinkAmpXm:"LinkAmpXmMesh",HeatSink:"HeatSinkMesh",HeatSinkXm:"HeatSinkXmMesh",MultiHack:"MultiHackMesh",MultiHackXm:"MultiHackXmMesh",ForceAmp:"ForceAmpMesh",ForceAmpXm:"ForceAmpXmMesh",Turret:"TurretMesh",TurretXm:"TurretXmMesh",FlipCardAda:"FlipCardMeshAda",FlipCardJarvis:"FlipCardMeshJarvis",FlipCardXm:"FlipCardXmMesh",Resonator:"ResonatorMesh",ResonatorXm:"ResonatorXMMesh",Capsule:"CapsuleMesh",CapsuleXm:"CapsuleXmMesh",ExtraShield:"ExtraShieldMesh",MediaCube:"MediaCubeMesh",MediaPlaneMesh:"MediaPlaneMesh"},Resource:{Xmp:"XmpResourceUnitMesh",PortalKeyResourceUnit:"PortalKeyResourceUnit",Ultrastrike:"UltrastrikeResourceUnitMesh",PowerCube:"PowerCubeResourceUnitMesh",LinkAmp:"LinkAmpResourceUnitMesh",HeatSink:"HeatSinkResourceUnitMesh",MultiHack:"MultiHackResourceUnitMesh",ForceAmp:"ForceAmpResourceUnitMesh",Turret:"TurretResourceUnitMesh",FlipCardAda:"FlipCardResourceUnitMeshAda",FlipCardJarvis:"FlipCardResourceUnitMeshJarvis",Resonator:"ResonatorResourceUnitMesh",PortalShield:"PortalShieldResourceUnitMesh",Capsule:"CapsuleResourceUnitMesh",ExtraShield:"ExtraShieldResourceUnitMesh"},Player:{Player:"PlayerMesh",PlayerEdge:"PlayerMeshEdge",PlayerReflection:"PlayerMeshReflection",PlayerGlow:"PlayerMeshGlow",BreadCrumb:"BreadCrumbMesh",Compass:"CompassMesh"},Ornament:{MeetupPoint:"OrnamentMeetupPointMesh",FinishPoint:"OrnamentFinishPointMesh",Cluster:"OrnamentClusterMesh",Volatile:"OrnamentVolatileMesh"},Artifact:{Helios:{Helios1:"Helios1",HeliosFrozen1:"HeliosFrozen1",Helios2:"Helios2",HeliosFrozen2:"HeliosFrozen2",Helios3:"Helios3",HeliosFrozen3:"HeliosFrozen3",Helios4:"Helios4",HeliosFrozen4:"HeliosFrozen4",Helios5:"Helios5",HeliosFrozen5:"HeliosFrozen5",Helios6:"Helios6",HeliosFrozen6:"HeliosFrozen6",Helios7:"Helios7",HeliosFrozen7:"HeliosFrozen7",Helios8:"Helios8",HeliosFrozen8:"HeliosFrozen8",Helios9:"Helios9",HeliosFrozen9:"HeliosFrozen9",Helios10:"Helios10",HeliosFrozen10:"HeliosFrozen10",Helios11:"Helios11",HeliosFrozen11:"HeliosFrozen11",Helios12:"Helios12",HeliosFrozen12:"HeliosFrozen12",Helios13:"Helios13",HeliosFrozen13:"HeliosFrozen13",Helios14:"Helios14",HeliosFrozen14:"HeliosFrozen14",Helios15:"Helios15",HeliosFrozen15:"HeliosFrozen15",Helios16:"Helios16",HeliosFrozen16:"HeliosFrozen16",Helios17:"Helios17",HeliosFrozen17:"HeliosFrozen17",Helios18:"Helios18",HeliosFrozen18:"HeliosFrozen18",Helios19:"Helios19",HeliosFrozen19:"HeliosFrozen19",Helios20:"Helios20",HeliosFrozen20:"HeliosFrozen20",Helios21:"Helios21",HeliosFrozen21:"HeliosFrozen21",Helios22:"Helios22",HeliosFrozen22:"HeliosFrozen22",Helios23:"Helios23",HeliosFrozen23:"HeliosFrozen23",Helios24:"Helios24",HeliosFrozen24:"HeliosFrozen24",Helios25:"Helios25",HeliosFrozen25:"HeliosFrozen25",Helios26:"Helios26",HeliosFrozen26:"HeliosFrozen26",Helios27:"Helios27",HeliosFrozen27:"HeliosFrozen27",Helios28:"Helios28",HeliosFrozen28:"HeliosFrozen28",Helios29:"Helios29",HeliosFrozen29:"HeliosFrozen29",Helios30:"Helios30",HeliosFrozen30:"HeliosFrozen30",Helios31:"Helios31",HeliosFrozen31:"HeliosFrozen31",Helios32:"Helios32",HeliosFrozen32:"HeliosFrozen32",Helios33:"Helios33",HeliosFrozen33:"HeliosFrozen33",Helios34:"Helios34",HeliosFrozen34:"HeliosFrozen34",Helios35:"Helios35",HeliosFrozen35:"HeliosFrozen35",Helios36:"Helios36",HeliosFrozen36:"HeliosFrozen36",Helios37:"Helios37",HeliosFrozen37:"HeliosFrozen37",Helios38:"Helios38",HeliosFrozen38:"HeliosFrozen38",Helios39:"Helios39",HeliosFrozen39:"HeliosFrozen39",Helios40:"Helios40",HeliosFrozen40:"HeliosFrozen40"},Amar:{Amar1:"Amar1",AmarFrozen1:"AmarFrozen1",Amar2:"Amar2",AmarFrozen2:"AmarFrozen2",Amar3:"Amar3",AmarFrozen3:"AmarFrozen3",Amar4:"Amar4",AmarFrozen4:"AmarFrozen4",Amar5:"Amar5",AmarFrozen5:"AmarFrozen5",Amar6:"Amar6",AmarFrozen6:"AmarFrozen6",Amar7:"Amar7",AmarFrozen7:"AmarFrozen7",Amar8:"Amar8",AmarFrozen8:"AmarFrozen8",Amar9:"Amar9",AmarFrozen9:"AmarFrozen9",Amar10:"Amar10",AmarFrozen10:"AmarFrozen10",Amar11:"Amar11",AmarFrozen11:"AmarFrozen11",Amar12:"Amar12",AmarFrozen12:"AmarFrozen12",Amar13:"Amar13",AmarFrozen13:"AmarFrozen13",Amar14:"Amar14",AmarFrozen14:"AmarFrozen14",Amar15:"Amar15",AmarFrozen15:"AmarFrozen15",Amar16:"Amar16",AmarFrozen16:"AmarFrozen16",Amar17:"Amar17",AmarFrozen17:"AmarFrozen17"},Jarvis:{Jarvis1:"Jarvis1",Jarvis2:"Jarvis2",Jarvis3:"Jarvis3",Jarvis4:"Jarvis4",Jarvis5:"Jarvis5",Jarvis6:"Jarvis6",Jarvis7:"Jarvis7",Jarvis8:"Jarvis8",Jarvis9:"Jarvis9",Jarvis10:"Jarvis10",Jarvis11:"Jarvis11",Jarvis12:"Jarvis12",Jarvis13:"Jarvis13"},Shonin:{Shonin1:"Shonin1",ShoninFrozen1:"ShoninFrozen1",Shonin2:"Shonin2",ShoninFrozen2:"ShoninFrozen2",Shonin3:"Shonin3",ShoninFrozen3:"ShoninFrozen3",Shonin4:"Shonin4",ShoninFrozen4:"ShoninFrozen4",Shonin5:"Shonin5",ShoninFrozen5:"ShoninFrozen5",Shonin6:"Shonin6",ShoninFrozen6:"ShoninFrozen6",Shonin7:"Shonin7",ShoninFrozen7:"ShoninFrozen7",Shonin8:"Shonin8",ShoninFrozen8:"ShoninFrozen8",Shonin9:"Shonin9",ShoninFrozen9:"ShoninFrozen9",Shonin10:"Shonin10",ShoninFrozen10:"ShoninFrozen10",Shonin11:"Shonin11",ShoninFrozen11:"ShoninFrozen11",Shonin12:"Shonin12",ShoninFrozen12:"ShoninFrozen12",Shonin13:"Shonin13",ShoninFrozen13:"ShoninFrozen13",Shonin14:"Shonin14",ShoninFrozen14:"ShoninFrozen14",Shonin15:"Shonin15",ShoninFrozen15:"ShoninFrozen15",Shonin16:"Shonin16",ShoninFrozen16:"ShoninFrozen16",Shonin17:"Shonin17",ShoninFrozen17:"ShoninFrozen17",Shonin18:"Shonin18",ShoninFrozen18:"ShoninFrozen18",Shonin19:"Shonin19",ShoninFrozen19:"ShoninFrozen19",Shonin20:"Shonin20",ShoninFrozen20:"ShoninFrozen20",Shonin21:"Shonin21",ShoninFrozen21:"ShoninFrozen21",Shonin22:"Shonin22",ShoninFrozen22:"ShoninFrozen22",Shonin23:"Shonin23",ShoninFrozen23:"ShoninFrozen23",Shonin24:"Shonin24",ShoninFrozen24:"ShoninFrozen24",Shonin25:"Shonin25",ShoninFrozen25:"ShoninFrozen25",Shonin26:"Shonin26",ShoninFrozen26:"ShoninFrozen26",Shonin27:"Shonin27",ShoninFrozen27:"ShoninFrozen27",Shonin28:"Shonin28",ShoninFrozen28:"ShoninFrozen28",Shonin29:"Shonin29",ShoninFrozen29:"ShoninFrozen29",Shonin30:"Shonin30",ShoninFrozen30:"ShoninFrozen30",Shonin31:"Shonin31",ShoninFrozen31:"ShoninFrozen31"},Lightman:{Lightman1:"Lightman1",LightmanFrozen1:"LightmanFrozen1",Lightman2:"Lightman2",LightmanFrozen2:"LightmanFrozen2",Lightman3:"Lightman3",LightmanFrozen3:"LightmanFrozen3",Lightman4:"Lightman4",LightmanFrozen4:"LightmanFrozen4",Lightman5:"Lightman5",LightmanFrozen5:"LightmanFrozen5",Lightman6:"Lightman6",LightmanFrozen6:"LightmanFrozen6",Lightman7:"Lightman7",LightmanFrozen7:"LightmanFrozen7",Lightman8:"Lightman8",LightmanFrozen8:"LightmanFrozen8",Lightman9:"Lightman9",LightmanFrozen9:"LightmanFrozen9",Lightman10:"Lightman10",LightmanFrozen10:"LightmanFrozen10",Lightman11:"Lightman11",LightmanFrozen11:"LightmanFrozen11",Lightman12:"Lightman12",LightmanFrozen12:"LightmanFrozen12",Lightman13:"Lightman13",LightmanFrozen13:"LightmanFrozen13",Lightman14:"Lightman14",LightmanFrozen14:"LightmanFrozen14",Lightman15:"Lightman15",LightmanFrozen15:"LightmanFrozen15",Lightman16:"Lightman16",LightmanFrozen16:"LightmanFrozen16",Lightman17:"Lightman17",LightmanFrozen17:"LightmanFrozen17",Lightman18:"Lightman18",LightmanFrozen18:"LightmanFrozen18",Lightman19:"Lightman19",LightmanFrozen19:"LightmanFrozen19",Lightman20:"Lightman20",LightmanFrozen20:"LightmanFrozen20",Lightman21:"Lightman21",LightmanFrozen21:"LightmanFrozen21",Lightman22:"Lightman22",LightmanFrozen22:"LightmanFrozen22",Lightman23:"Lightman23",LightmanFrozen23:"LightmanFrozen23",Lightman24:"Lightman24",LightmanFrozen24:"LightmanFrozen24",Lightman25:"Lightman25",LightmanFrozen25:"LightmanFrozen25",Lightman26:"Lightman26",LightmanFrozen26:"LightmanFrozen26",Lightman27:"Lightman27",LightmanFrozen27:"LightmanFrozen27",Lightman28:"Lightman28",LightmanFrozen28:"LightmanFrozen28",Lightman29:"Lightman29",LightmanFrozen29:"LightmanFrozen29",Lightman30:"Lightman30",LightmanFrozen30:"LightmanFrozen30",Lightman31:"Lightman31",LightmanFrozen31:"LightmanFrozen31",Lightman32:"Lightman32",LightmanFrozen32:"LightmanFrozen32",Lightman33:"Lightman33",LightmanFrozen33:"LightmanFrozen33",Lightman34:"Lightman34",LightmanFrozen34:"LightmanFrozen34",Lightman35:"Lightman35",LightmanFrozen35:"LightmanFrozen35",Lightman36:"Lightman36",LightmanFrozen36:"LightmanFrozen36",Lightman37:"Lightman37",LightmanFrozen37:"LightmanFrozen37",Lightman38:"Lightman38",LightmanFrozen38:"LightmanFrozen38",Lightman39:"Lightman39",LightmanFrozen39:"LightmanFrozen39",Lightman40:"Lightman40",LightmanFrozen40:"LightmanFrozen40",Lightman41:"Lightman41",LightmanFrozen41:"LightmanFrozen41"}},World:{Shield:"PortalShieldMesh",Portal:"TexturedPortalMesh",Waypoint:"TexturedScannerFTMesh",Resonator:"ResonatorUnitLowResMesh",XmpRing:"XmpRingMesh",UltraStrikeRing:"UltraStrikeRingMesh",UltraStrikeColumn:"UltraStrikeColumnMesh",ArtifactsRedGlow:"ArtifactsRedGlow",ArtifactsGreenGlow:"ArtifactsGreenGlow",ArtifactsPurpleGlow:"ArtifactsPurpleGlow",ArtifactsTargetGlow:"ArtifactsTargetGlow",SingleResonator:"SingleResonatorMesh"}},Program:{Bicolored:"bicolor_textured",Textured:"textured",Glowramp:"portal_scanner",Xm:"xm",ShieldEffect:"shield",Atmosphere:"atmosphere"},Texture:{FlipCard:"FlipCardTexture",Xm:"ObjectXMTexture",Glowramp:"GlowrampTexture",Media:"MediaCubeTexture",Waypoint:"FtWaypointTexture",ShieldEffect:"PortalShieldTexture",MediaCube:"MediaCubeTexture",ColorGlow:"ColorGlowTexture",TargetGlow:"TargetGlowTexture",ArtifactHelios:"ArtifactHeliosTexture",ArtifactAmar:"ArtifactAmarTexture",ArtifactJarvis:"ArtifactJarvisTexture",ArtifactShonin:"ArtifactShoninTexture",ArtifactLightman:"ArtifactLightmanTexture"}};c.Constants=e;var f=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a},g=function(a){a.lineWidth(1),a.enable(a.CULL_FACE),a.frontFace(a.CCW),a.cullFace(a.BACK),a.enable(a.DEPTH_TEST),a.blendEquation(a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.disable(a.BLEND),a.depthMask(!0)},h=function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(a[d]=c&&"object"==typeof a[d]&&"object"==typeof b[d]?h(a[d],b[d],c):b[d]);return a};c.Utilities=c.Utilities||{},c.Utilities.inherits=f,c.Utilities.resetGL=g,c.Utilities.setParams=h;var i=function(a,b,c){if("image"===b||"image.co"===b)if(/\.tga$/.test(a))libtga.loadFile(a,function(a,b){if(a)return void c(a,null);var d=document.createElement("canvas"),e=d.getContext("2d"),f=e.createImageData(b.width,b.height);f.data.set(b.imageData),d.height=b.height,d.width=b.width,e.putImageData(f,0,0);var g=new Image;g.onload=function(){c(null,this)},g.onerror=function(a){c(a,null)},g.src=d.toDataURL()});else{var d=new Image;"image.co"===b&&(d.crossOrigin="anoymous"),d.onload=function(){c(null,this)},d.onerror=function(a){c(a,null)},d.src=a}else{var e=new XMLHttpRequest;e.open("GET",a),e.responseType=b,e.onload=function(){c(null,this.response)},e.onerror=function(a){c(a,null)},e.send()}},j=function(){var a={},c={};this.loadAsset=function(b,d,e){var f="_"+encodeURIComponent(b);return c[f]?void e(null,c[f]):(a[f]=a[f]||[],a[f].push(e),void(c.hasOwnProperty(f)||(c[f]=!1,i(b,d,function(b,d){b||(c[f]=d);for(var e;e=a[f].shift();)e(b,d)}))))},this.loadAssetGroup=function(a,c,d){if(a.length!==c.length)throw"Incompatible types: types.length = "+c.length+"; urls.length = "+a.length;for(var e=a.length,f=new Array(e),g=function(a,b,c){if(b)return void d(b,null);f[a]=c;var g,h=!0;for(g=0;e>g;g++)h=h&&f[g];h&&d(null,f)},h=0;h<a.length;h++)this.loadAsset(a[h],c[h],g.bind(b,h))},this.getAsset=function(a){return c[a]}};c.AssetLoader=j,c.Utilities=c.Utilities||{},c.Utilities.loadResource=i;var k=function(a){this._gl=a};c.GLBound=k;var l=function(a,b,c){return k.call(this,a),this.target=b||a.ARRAY_BUFFER,this.usage=c||a.STATIC_DRAW,this.glBuf=null,this.values=null,this};f(l,k),l.prototype.bindBuffer=function(){return this.values?(this.glBuf||(this.glBuf=this._gl.createBuffer()),this._gl.bindBuffer(this.target,this.glBuf),this):(d.warn("trying to update a buffer with no values."),!1)},l.prototype.unbindBuffer=function(){return this},l.prototype.update=function(){return this.bindBuffer(),this._gl.bufferData(this.target,this.values,this.usage),this},l.prototype.setValues=function(a,b){return this.values?this.values.set(a,b):this.values=a,this},l.prototype.updateBuffer=function(a){return this.values=a,this.update()},c.GL=c.GL||{},c.GL.Buffer=l;var m=function(){var a=function(a,b,c,d){return d=d||a.STATIC_DRAW,l.call(this,a,a.ARRAY_BUFFER,d),this.attributes=b,this.values=c,this.size=this.count=null,this.validate=!1,this.getSize(),this};return f(a,l),a.prototype.getSize=function(){this.size=0;for(var a,b=0,c=0;c<this.attributes.length;c++)a=this.attributes[c],this.size+=4*a.size,b+=a.size},a.prototype.validate=function(){if(this.validate){var a=this.attributes.reduce(function(a,b){return a+b.size},0);this.values.length%a!==0&&d.warn("values array length is not an even multiple of the total size of the attributes")}},a.prototype.updateValues=function(a){return this.values=a,this.validate(),this.update()},a.prototype.draw=function(a){var b,c=this._gl,d=0;this.glBuf?this.bindBuffer():this.update();for(var e=0;e<this.attributes.length;e++)b=this.attributes[e],b.name in a&&(c.enableVertexAttribArray(a[b.name]),c.vertexAttribPointer(a[b.name],b.size,c.FLOAT,!1,this.size,d),d+=4*b.size);return this},a}();c.GL=c.GL||{},c.GL.Attribute=m;var n=function(){var a=function(a,b,c,d){return d=d||a.STATIC_DRAW,l.call(this,a,a.ELEMENT_ARRAY_BUFFER,d),this.mode=c,this.values=b,this.count=null,this};return f(a,l),a.prototype.draw=function(){var a=this._gl;return this.glBuf?this.bindBuffer():this.update(),a.drawElements(this.mode,this.values.length,a.UNSIGNED_SHORT,0),this},a}();c.GL=c.GL||{},c.GL.Index=n;var o=function(a,b,c){k.call(this,a),this.info=b;var d={MipMapLinearLinear:a.LINEAR_MIPMAP_LINEAR,Linear:a.LINEAR,MipMapLinearNearest:a.LINEAR_MIPMAP_NEAREST,MipMapNearestLinear:a.NEAREST_MIPMAP_LINEAR,Repeat:a.REPEAT,ClampToEdge:a.CLAMP_TO_EDGE},e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d[b.minFilter]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d[b.magFilter]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d[b.wrapS]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d[b.wrapT]),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),/MipMap/.test(b.minFilter)&&a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null),this.texture=e};o.prototype.use=function(a){var b=this._gl;a=a||0,b.bindTexture(b.TEXTURE_2D,this.texture),b.activeTexture(b.TEXTURE0+a)},c.Texture=o;var p=function(a,b){this.name=a,this.size=b};c.VertexAttribute=p;var q=function(){var a="triangles",b="lines",c=function(b,c,d,e){k.call(this,b),this.attributes=c,this.faces=d,this.lines=e,this.mode=a};return f(c,k),c.MODE_LINES=b,c.MODE_TRIANGLES=a,c.prototype.draw=function(c){this.attributes.draw(c),this.mode===a?this.faces.draw():this.mode===b&&this.lines.draw()},c}();c.Mesh=q;var r=function(){var a=function(a){var b,c,e,f,g,h=new DataView(a),i=0,j=h.getUint32(i);i+=4;for(var k=[],l=0;j>l;l++){for(b=h.getUint32(i),1!=b&&16!=b&&d.warn("unknown type "+b),i+=4,c=h.getUint32(i),i+=4,e=h.getUint16(i),i+=2,g="",f=0;e>f;f++)g+=String.fromCharCode(h.getUint8(i+f));i+=e,k.push(new p(g,c))}return k},b=function(b,c){var d=new JavaDeserializer(c),e=d.getStream(),f=e.getContents(),g=f[0].contents.toArray(),h=f[3].contents.toArray(),i=a(h),j=new n(b,f[1].contents.toArray(),b.TRIANGLES),k=new m(b,i,g),l=new n(b,f[2].contents.toArray(),b.LINES);q.call(this,b,k,j,l)};return f(b,q),b}();c.Meshes=c.Meshes||{},c.Meshes.File=r;var s=function(){var a=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=2*Math.PI,q=Math.PI,r=new Float32Array((b+1)*(c+1)*8),s=[],t=[],u=0,v=[];for(b=Math.max(3,b||8),c=Math.max(2,c||6),d=0;b>=d;d++){for(m=[],e=0;c>=e;e++)f=e/b,g=d/c,h=vec3.fromValues(-a*Math.cos(f*o)*Math.sin(g*q),a*Math.cos(g*q),a*Math.sin(f*o)*Math.sin(g*q)),r[8*u+0]=h[0],r[8*u+1]=h[1],r[8*u+2]=h[2],r[8*u+3]=f,r[8*u+4]=g,vec3.normalize(h,h),r[8*u+5]=h[0],r[8*u+6]=h[1],r[8*u+7]=h[2],m.push(u++);t.push(m)}for(d=0;b>d;d++)for(e=0;c>e;e++)i=t[d][e+1],j=t[d][e],k=t[d+1][e],l=t[d+1][e+1],Math.abs(r[8*i+1])===a?(s.push.apply(s,[i,k,l]),r[8*i+3]=(r[8*i+3]+r[8*j+3])/2):Math.abs(r[8*k+1])===a?(s.push.apply(s,[i,j,k]),r[8*k+3]=(r[8*k+3]+r[8*l+3])/2):(s.push.apply(s,[i,j,l]),s.push.apply(s,[j,k,l]));return n=new Uint16Array(s.length),s.forEach(function(a,b){n[b]=a}),v.push(new p("a_position",3)),v.push(new p("a_texCoord0",2)),v.push(new p("a_normal",3)),{values:r,faces:n,attributes:v}},b=function(b,c,d,e){var f=a(c,d,e),g=new m(b,f.attributes,f.values),h=new n(b,f.faces,b.TRIANGLES);q.call(this,b,g,h)};return f(b,q),b}();c.Meshes=c.Meshes||{},c.Meshes.Sphere=s;var t=function(){for(var a=9,c=6*a,d=12,e=new Array(a),g=new Array(a),h=new Array(a),i=100,j=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},k=0;a>k;k++){var l=k/8;e[k]=l,h[k]=3+-1.5*Math.pow(j(2*Math.abs(l-.5)),4),g[k]=j(1-2*Math.abs(l-.5))}var o=vec4.fromValues(.46,.18,.18,1),r=vec4.create(),s=function(a,b,c,e,f,g,h,i,j,k){var l=b*d;a[l+0]=c,a[l+1]=e,a[l+2]=f,a[l+3]=j,a[l+4]=g,a[l+5]=h,a[l+6]=i[0],a[l+7]=i[2],a[l+8]=k[0],a[l+9]=k[1],a[l+10]=k[2],a[l+11]=k[3]},t=function(f,i,j,k,l){k=k===b?1:Math.max(Math.min(k,1),0),l=l===b?1:Math.max(Math.min(l,1),0);var m=new Float32Array(c*d),n=Math.sqrt((i[0]-f[0])*(i[0]-f[0])+(i[1]-f[1])*(i[1]-f[1])),p=r[1],q=p+Math.min(30,.08*n),t=(k+l)/2,u=.01*n,v=.1+.3*t,w=vec3.fromValues(i[0],0,i[1]);vec3.subtract(w,w,vec3.fromValues(f[0],0,f[1]));var x=vec3.fromValues(0,1,0),y=vec3.cross(vec3.create(),w,x);vec3.normalize(y,y);for(var z=2*a,A=0;a>A;A++){var B=e[A],C=k+B*(l-k),D=.6+.35*C,E=B*u,F=f[0]+B*w[0],G=f[1]+B*w[2],H=p+g[A]*(q-p),I=h[A],J=vec4.lerp(vec4.create(),o,j,.25+.75*C);J[3]=D,s(m,2*A,F+I*y[0],H,G+I*y[2],0,E,x,v,J),s(m,2*A+1,F-I*y[0],H,G-I*y[2],.5,E,x,v,J),s(m,z+2*A,F,H+I,G,0,E,y,v,J),s(m,z+2*A+1,F,H-I,G,.5,E,y,v,J),s(m,2*z+2*A,F,H-I,G,.5,E,y,v,J),s(m,2*z+2*A+1,F,0,G,1,E,y,v,J)}return m},u=function(b){for(var c=new Uint16Array(144),d=0,e=0;3>e;e++){for(var f=0;a-1>f;f++)c[d+0]=b+1,c[d+1]=b+0,c[d+2]=b+2,c[d+3]=b+1,c[d+4]=b+2,c[d+5]=b+3,b+=2,d+=6;b+=2}return c},v=function(a){var b=new Float32Array(c*d*i),e=[];e.push(new p("a_position",4)),e.push(new p("a_texCoord0",4)),e.push(new p("a_color",4));var f=new m(a,e,b,a.DYNAMIC_DRAW),g=new n(a,new Uint16Array(144*i),a.TRIANGLES);q.call(this,a,f,g),this.nLinks=0};return f(v,q),v.prototype.addLink=function(a,b,e,f,g){var h=t(a,b,e,f,g),i=this.nLinks*c,j=u(i);return this.attributes.setValues(h,i*d),this.faces.setValues(j,144*this.nLinks),this.nFaces+=144,this.nLinks++},v}();c.Meshes=c.Meshes||{},c.Meshes.PortalLink=t;var u=function(){var a=13,c=50,d=25,e=function(a){return Math.sin(Math.PI*Math.max(Math.min(1,a),0)/2)},g=function(a,b){var c=a[0],d=b[0],e=b[1]-a[1],f=Math.sin(e)*Math.cos(d),g=Math.cos(c)*Math.sin(d)-Math.sin(c)*Math.cos(d)*Math.cos(e);return(Math.atan2(f,g)+2*Math.PI)%(2*Math.PI)},h=function(a,b,c){var d=Math.asin(Math.sin(a[0])*Math.cos(c)+Math.cos(a[0])*Math.sin(c)*Math.cos(b)),e=a[1]+Math.atan2(Math.sin(b)*Math.sin(c)*Math.cos(a[0]),Math.cos(c)-Math.sin(a[0])*Math.sin(d));return e=(e+3*Math.PI)%(2*Math.PI)-Math.PI,vec2.fromValues(d,e)},i=function(a,b,c){var d=mat4.create();return mat4.rotateY(d,d,a[1]),mat4.rotateZ(d,d,a[0]-Math.PI/2),mat4.rotateY(d,d,-g(a,b)),mat4.translate(d,d,[0,c,0]),d},j=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a[0])*Math.cos(b[0])*Math.sin(d/2)*Math.sin(d/2);return 2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e))},k=function(a){return vec2.fromValues(a[0]*Math.PI/180,a[1]*Math.PI/180)},l=vec4.fromValues(.46,.18,.18,1),o=vec4.create(),r=function(b,c,d,e,f,g,h){var i=c*a;vec3.normalize(f,f),b[i+0]=d[0],b[i+1]=d[1],b[i+2]=d[2],b[i+3]=g,b[i+4]=e[0],b[i+5]=e[1],b[i+6]=f[0],b[i+7]=f[1],b[i+8]=f[2],b[i+9]=h[0],b[i+10]=h[1],b[i+11]=h[2],b[i+12]=h[3]},s=function(c,d,f,m,n,p){var q=k(d),s=k(f),t=j(q,s),u=g(q,s),v=t*c,w=Math.max(Math.floor(t/Math.PI*50)+1,2);n=n===b?1:Math.max(Math.min(n,1),0),p=p===b?1:Math.max(Math.min(p,1),0);for(var x=new Float32Array(w*a*6),y=o[1],z=y+Math.min(.01*c,.08*v),A=(n+p)/2,B=.01*v,C=.1+.3*A,D=vec3.fromValues(0,1,0),E=vec3.fromValues(0,0,1),F=2*w,G=0;w>G;G++){var H=G/(w-1),I=n+H*(p-n),J=.6+.35*I,K=H*B,L=0===H?q:h(q,u,t*H),M=h(q,u,t*(H+1/(w-1))),N=i(L,M,c),O=vec3.fromValues(0,y+(3+-1.5*Math.pow(e(2*Math.abs(H-.5)),4))*(z-y),0),P=.01*c*e(1-2*Math.abs(H-.5)),Q=vec3.fromValues(0,P,0),R=vec3.fromValues(0,0,P),S=vec4.lerp(vec4.create(),l,m,.25+.75*I);S[3]=J,r(x,2*G,vec3.transformMat4(vec3.create(),vec3.add(vec3.create(),O,R),N),vec2.fromValues(0,K),vec3.transformMat4(vec3.create(),D,N),C,S),r(x,2*G+1,vec3.transformMat4(vec3.create(),vec3.subtract(vec3.create(),O,R),N),vec2.fromValues(.5,K),vec3.transformMat4(vec3.create(),D,N),C,S),r(x,F+2*G,vec3.transformMat4(vec3.create(),vec3.add(vec3.create(),O,Q),N),vec2.fromValues(0,K),vec3.transformMat4(vec3.create(),E,N),C,S),r(x,F+2*G+1,vec3.transformMat4(vec3.create(),vec3.subtract(vec3.create(),O,Q),N),vec2.fromValues(.5,K),vec3.transformMat4(vec3.create(),E,N),C,S),r(x,2*F+2*G,vec3.transformMat4(vec3.create(),vec3.subtract(vec3.create(),O,Q),N),vec2.fromValues(.5,K),vec3.transformMat4(vec3.create(),E,N),C,S),r(x,2*F+2*G+1,vec3.transformMat4(vec3.create(),vec3.fromValues(0,0,0),N),vec2.fromValues(1,K),vec3.transformMat4(vec3.create(),E,N),C,S)}return x},t=function(a,b){for(var c=new Uint16Array(6*(b-1)*3),d=0,e=0;3>e;e++){for(var f=0;b-1>f;f++)c[d+0]=a+1,c[d+1]=a+0,c[d+2]=a+2,c[d+3]=a+1,c[d+4]=a+2,c[d+5]=a+3,a+=2,d+=6;a+=2}return c},u=function(b,e){var f=new Float32Array(d*a*c),g=[];g.push(new p("a_position",4)),g.push(new p("a_texCoord0",2)),g.push(new p("a_normal",3)),g.push(new p("a_color",4));var h=new m(b,g,f,b.DYNAMIC_DRAW),i=new n(b,new Uint16Array(18*d*c),b.TRIANGLES);return this.radius=e,this.vertexOffset=0,this.faceOffset=0,q.call(this,b,h,i),this};return f(u,q),u.prototype.addLink=function(b,c,d,e,f){var g=s(this.radius,b,c,d,e,f),h=g.length,i=Math.floor(h/a/6),j=t(this.vertexOffset/a,i);return this.attributes.setValues(g,this.vertexOffset),this.vertexOffset+=h,this.faces.setValues(j,this.faceOffset),this.faceOffset+=j.length,this},u}();c.Meshes=c.Meshes||{},c.Meshes.SphericalPortalLink=u;var v=function(){var a=function(a){if(/precision mediump float/g.test(a))return a;var b=a.split("\n");return b.splice(1,0,"#ifdef GL_ES","precision mediump float;","#endif"),b.join("\n")},b=function(a,b,c,d){var e,f,g=c.name,h=a.getUniformLocation(b,g),i=c.type,j=!1,k=!0;if(c.size>1&&d)switch(i){case a.FLOAT:e=a.uniform1fv,f=Float32Array,k=!1;break;case a.INT:case a.BOOL:case a.SAMPLER_2D:case a.SAMPLER_CUBE:e=a.uniform1iv,f=Uint16Array,k=!1}if(k)switch(i){case a.FLOAT:e=a.uniform1f;break;case a.FLOAT_VEC2:e=a.uniform2fv,f=d?Float32Array:new Float32Array(2);break;case a.FLOAT_VEC3:e=a.uniform3fv,f=d?Float32Array:new Float32Array(3);break;case a.FLOAT_VEC4:e=a.uniform4fv,f=d?Float32Array:new Float32Array(4);break;case a.INT:case a.BOOL:case a.SAMPLER_2D:case a.SAMPLER_CUBE:e=a.uniform1i;break;case a.INT_VEC2:case a.BOOL_VEC2:e=a.uniform2iv,f=d?Uint16Array:new Uint16Array(2);break;case a.INT_VEC3:case a.BOOL_VEC3:e=a.uniform3iv,f=d?Uint16Array:new Uint16Array(3);break;case a.INT_VEC4:case a.BOOL_VEC4:e=a.uniform4iv,f=d?Uint16Array:new Uint16Array(4);break;case a.FLOAT_MAT2:j=!0,e=a.uniformMatrix2fv;break;case a.FLOAT_MAT3:j=!0,e=a.uniformMatrix3fv;break;case a.FLOAT_MAT4:j=!0,e=a.uniformMatrix4fv}if(e.bind)e=e.bind(a);else{var l=e;e=function(){l.apply(a,arguments)}}return d&&f?function(a){e(h,new f(a))}:j?function(a){e(h,!1,a)}:f?function(a){f.set(a.toFloat32Array?a.toFloat32Array():a),e(h,f)}:function(a){e(h,a)}},c=function(b,c,d){k.call(this,b),this.program=null,this.vertexSource=a(c),this.fragmentSource=d,this.attributes={},this.uniforms={}};return f(c,k),c.prototype.setupLocations=function(){for(var a,c,d=this._gl,e=this.program,f=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES),g=0;f>g;g++)a=d.getActiveAttrib(e,g),this.attributes[a.name]=d.getAttribLocation(e,a.name);for(f=d.getProgramParameter(e,d.ACTIVE_UNIFORMS),g=0;f>g;g++)a=d.getActiveUniform(e,g),c=a.name,c="]"==c[c.length-1]?c.substr(0,c.length-3):c,this.uniforms[c]=b(d,e,a,a.name!=c)},c.prototype.init=function(){var a,b,c=this._gl;if(a=c.createShader(c.VERTEX_SHADER),c.shaderSource(a,this.vertexSource),c.compileShader(a),!c.getShaderParameter(a,c.COMPILE_STATUS))throw d.warn(c.getShaderInfoLog(a)),d.error("could not compile vertex shader: "+this.vertexSource),"Vertex shader compile error!";if(b=c.createShader(c.FRAGMENT_SHADER),c.shaderSource(b,this.fragmentSource),c.compileShader(b),!c.getShaderParameter(b,c.COMPILE_STATUS))throw d.warn(c.getShaderInfoLog(b)),d.error("could not compile fragment shader: "+this.fragmentSource),"Fragment shader compile error!";if(this.program=c.createProgram(),c.attachShader(this.program,a),c.attachShader(this.program,b),c.linkProgram(this.program),!c.getProgramParameter(this.program,c.LINK_STATUS))throw"Could not link program";c.useProgram(this.program),this.setupLocations()},c.prototype.use=function(a){var b=this._gl;this.program?b.useProgram(this.program):this.init(),a(this.attributes,this.uniforms)},c}();c.Program=v;var w=function(){var a=function(a,b,c){v.call(this,a,b,c)};return f(a,v),a.prototype.use=function(a){this.program||this.init();var b=this._gl;b.useProgram(this.program),b.enable(b.DEPTH_TEST),b.enable(b.CULL_FACE),b.frontFace(b.CCW),b.cullFace(b.BACK),b.depthMask(!0),a(this.attributes,this.uniforms),g(b)},a}();c.Programs=c.Programs||{},c.Programs.Opaque=w;var x=function(){var a=function(a,b,c){v.call(this,a,b,c)};return f(a,v),a.prototype.use=function(a){this.program||this.init();var b=this._gl;b.useProgram(this.program),b.disable(b.CULL_FACE),b.enable(b.BLEND),b.depthMask(!1),b.blendEquation(b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA),a(this.attributes,this.uniforms),g(b)},a}();c.Programs=c.Programs||{},c.Programs.Glowramp=x;var y=function(a){this.programName=a,this.program=null,this.uniforms={},this.drawfn=null,this.elapsed=0,this.ready=!1};y.prototype.init=function(a){return this.program=a.getProgram(this.programName),this.program?(this.ready=!0,!0):(d.warn("missing program "+this.programName),!1)},y.prototype.setDrawFn=function(a){this.drawfn=a},y.prototype.draw=function(){return this.ready?void this.program.use(this.drawfn):(d.warn("drawable is not initialized"),!1)},y.prototype.setUniform=function(a,b){this.uniforms[a]=b},y.prototype.updateTime=function(a){return this.elapsed+=a,this.onUpdate?this.onUpdate(a,this.elapsed):!0},c.Drawable=y;var z=function(){var a=function(a,b){for(var c in this.uniforms)this.uniforms.hasOwnProperty(c)&&c in b&&b[c](this.uniforms[c]);this.mesh.draw(a)},b=function(b,c){y.call(this,b),this.meshName=c,this.mesh=null,this.drawfn=a.bind(this)};return f(b,y),b.prototype.init=function(a){return this.mesh=a.getMesh(this.meshName),this.mesh?y.prototype.init.call(this,a):(d.warn("missing mesh "+this.meshName),!1)},b}();c.Drawables=c.Drawables||{},c.Drawables.Mesh=z;var A=function(){var a=function(a,b){z.call(this,a,b),this.viewProject=mat4.create(),this.model=mat4.create(),this.local=mat4.create(),this.world=mat4.create()};return f(a,z),a.prototype.updateMatrix=function(){var a=mat4.create();mat4.multiply(this.model,this.world,this.local),mat4.multiply(a,this.viewProject,this.model),this.uniforms.u_modelViewProject=a},a.prototype.updateView=function(a){this.viewProject=a,this.updateMatrix()},a.prototype.setMatrix=function(a){this.model=a,this.updateMatrix()},a}();c.Drawables=c.Drawables||{},c.Drawables.Model=A;var B=function(a,b,c){A.call(this,a,b),this.textureName=c,this.texture=null};f(B,A),B.prototype.draw=function(){this.texture.use(0),this.uniforms.u_texture=0,A.prototype.draw.call(this)},B.prototype.init=function(a){return this.texture=a.getTexture(this.textureName),this.texture?A.prototype.init.call(this,a):(d.warn("missing texture "+this.textureName),!1)},c.Drawables=c.Drawables||{},c.Drawables.Textured=B;var C=function(){var a=c.Constants.Program.Bicolored,b=vec4.clone(e.qualityColors.VERY_RARE),d=vec4.clone(e.xmColors.coreGlow),g=function(c,e){B.call(this,a,c,e),this.uniforms.u_color0=vec4.clone(b),this.uniforms.u_color1=vec4.clone(d)};return f(g,B),g}();c.Drawables=c.Drawables||{},c.Drawables.Bicolored=C;

var D=function(){var a=c.Constants.Program.Glowramp,b=vec4.clone(c.Constants.teamColors.NEUTRAL),d=function(c,d){B.call(this,a,c,d),this.uniforms.u_baseColor=vec4.clone(b),this.uniforms.u_rotation=0,this.uniforms.u_rampTarget=0,this.uniforms.u_alpha=.6};return f(d,B),d.prototype.updateTime=function(a){var b=A.prototype.updateTime.call(this,a),c=this.elapsed/5e3;return this.uniforms.u_rotation=c,this.uniforms.u_rampTarget=Math.sin(Math.PI/2*(c-Math.floor(c))),this.uniforms.u_alpha=.05*Math.sin(c)+.75,b},d}();c.Drawables=c.Drawables||{},c.Drawables.Glowramp=D;var E=function(){var a=c.Constants.Program.Xm,b=vec4.clone(e.xmColors.coreGlow),d=vec4.clone(e.xmColors.coreGlowAlt),g=function(c,e,f){B.call(this,a,c,e),this.uniforms.u_elapsedTime=0,this.uniforms.u_teamColor=vec4.clone(f||b),this.uniforms.u_altColor=vec4.clone(d)};return f(g,B),g.prototype.updateTime=function(a){var b=z.prototype.updateTime.call(this,a);return this.uniforms.u_elapsedTime=this.elapsed/1e3%300*.1,b},g}();c.Drawables=c.Drawables||{},c.Drawables.Xm=E;var F=function(){var a=c.Constants.Program.ShieldEffect,b=vec4.clone(c.Constants.teamColors.NEUTRAL),d=vec2.fromValues(.5,1.3),e=vec3.fromValues(.5,.5,.5),g=function(c,f){B.call(this,a,c,f),this.uniforms.u_color=vec4.clone(b),this.uniforms.u_rampTargetInvWidth=vec2.clone(d),this.uniforms.u_contributionsAndAlpha=vec3.clone(e)};return f(g,B),g.prototype.updateTime=function(a){var b=A.prototype.updateTime.call(this,a),c=this.elapsed/1e4;return this.uniforms.u_rampTargetInvWidth[0]=-2*(c-Math.floor(c))+1,this.uniforms.u_rampTargetInvWidth[1]=2*(c-Math.floor(c)),b},g}();c.Drawables=c.Drawables||{},c.Drawables.ShieldEffect=F,function(){var a=c.Constants.Mesh.Inventory,b=c.Constants.Texture;c.Drawables=c.Drawables||{},c.Drawables.Inventory=c.Drawables.Inventory||{};var d=function(c){var d=function(){C.call(this,a[c],b.FlipCard)};return f(d,C),d},e=function(c){var d=function(){E.call(this,a[c],b.Xm)};return f(d,E),d},g=function(b){var d=function(){B.call(this,c.Constants.Program.Textured,a[b],c.Constants.Texture.MediaCube)};return f(d,B),d};for(var h in a)if(/^Media/.test(h)){if("MediaPlane"===h)continue;c.Drawables.Inventory[h]=g(h)}else c.Drawables.Inventory[h]=/Xm$/.test(h)?e(h):d(h)}(),function(){var a=c.Constants.Mesh.Resource;c.Drawables=c.Drawables||{},c.Drawables.Resource=c.Drawables.Resource||{};var b=function(b){var d=function(){C.call(this,a[b],c.Constants.Texture.FlipCard)};f(d,C),c.Drawables.Resource[b]=d};for(var d in a)b(d)}(),function(){var a=c.Constants.Mesh.World,b=c.Constants.Texture;c.Drawables=c.Drawables||{},c.Drawables.World=c.Drawables.World||{};var d=function(){D.call(this,a.Portal,b.Glowramp)};f(d,D),c.Drawables.World.Portal=d;var e=function(){F.call(this,a.Shield,b.ShieldEffect)};f(e,F),c.Drawables.World.Shield=e;var g=function(){D.call(this,a.Waypoint,b.Waypoint)};f(g,D),c.Drawables.World.Waypoint=g;var h=function(){C.call(this,a.Resonator,b.FlipCard)};f(h,C),c.Drawables.World.Resonator=h;var i=function(){D.call(this,a.ArtifactsRedGlow,b.ColorGlow)};f(i,D),c.Drawables.World.ArtifactsRedGlow=i;var j=function(){D.call(this,a.ArtifactsGreenGlow,b.ColorGlow)};f(j,D),c.Drawables.World.ArtifactsGreenGlow=j;var k=function(){D.call(this,a.ArtifactsPurpleGlow,b.ColorGlow)};f(k,D),c.Drawables.World.ArtifactsPurpleGlow=k;var l=function(){D.call(this,a.ArtifactsTargetGlow,b.TargetGlow)};f(l,D),c.Drawables.World.ArtifactsTargetGlow=l}(),function(){var a,b,d=c.Constants.Mesh.Artifact,e=c.Constants.Texture;c.Drawables=c.Drawables||{},c.Drawables.Artifact=c.Drawables.Artifact||{};var g=function(a,b){var d=function(){B.call(this,c.Constants.Program.Textured,b,e["Artifact"+a])};return f(d,B),d};for(a in d){var h=d[a];c.Drawables.Artifact[a]=c.Drawables.Artifact[a]||{};for(b in h)c.Drawables.Artifact[a][b]=g(a,b)}}();var G=function(){var a=function(a,b){for(var c in this.uniforms)this.uniforms.hasOwnProperty(c)&&c in b&&b[c](this.uniforms[c]);this.mesh.draw(a)},b=function(b,c){y.call(this,b),this.mesh=c,this.drawfn=a.bind(this)};return f(b,y),b}();c.Drawables=c.Drawables||{},c.Drawables.Dynamic=G;var H=function(){var a=function(a,b){G.call(this,a,b),this.viewProject=mat4.create(),this.model=mat4.create(),this.local=mat4.create(),this.world=mat4.create()};return f(a,G),a.prototype.updateMatrix=function(){var a=mat4.create();mat4.multiply(this.model,this.world,this.local),mat4.multiply(a,this.viewProject,this.model),this.uniforms.u_modelViewProject=a},a.prototype.updateView=function(a){this.viewProject=a,this.updateMatrix()},a.prototype.setMatrix=function(a){this.model=a,this.updateMatrix()},a}();c.Drawables=c.Drawables||{},c.Drawables.DynamicModel=H;var I=function(a,b,c){H.call(this,a,b),this.textureName=c,this.texture=null};f(I,H),I.prototype.draw=function(){this.texture.use(0),this.uniforms.u_texture=0,H.prototype.draw.call(this)},I.prototype.init=function(a){return this.texture=a.getTexture(this.textureName),this.texture?H.prototype.init.call(this,a):(d.warn("missing texture "+this.textureName),!1)},c.Drawables=c.Drawables||{},c.Drawables.DynamicTextured=I;var J=function(){var a=function(a,b,c){I.call(this,a,b,c),this.uniforms.u_cameraFwd=vec3.fromValues(0,0,-1),this.uniforms.u_elapsedTime=0};return f(a,I),a.prototype.updateView=function(a,b,c){if(I.prototype.updateView.call(this,a,b,c),b){var d=mat3.fromMat4(mat3.create(),b),e=quat.fromMat3(quat.create(),d),f=vec3.transformQuat(vec3.create(),vec3.fromValues(0,0,-1),e);vec3.normalize(f,f),this.uniforms.u_cameraFwd=f}},a.prototype.updateTime=function(a){var b=I.prototype.updateTime.call(this,a);return this.uniforms.u_elapsedTime=this.elapsed/1e3%300*.1,b},a.prototype.addLink=function(a,b,c,d,e){if(!this.mesh)throw"Mesh not ready yet!";return this.mesh.addLink(a,b,c,d,e)},a}(),K=function(a,b){J.call(this,"LinkShader",a,b)};f(K,J);var L=function(a,b){J.call(this,"link3d",a,b)};f(L,J),L.prototype.updateView=function(a,b,c){J.prototype.updateView.call(this,a,b,c),this.uniforms.u_model=this.model},c.Drawables=c.Drawables||{},c.Drawables.Link=J,c.Drawables.PortalLink=K,c.Drawables.SphericalLink=L;var M=function(){var a=c.Constants.Program.Atmosphere,b=function(b,c){H.call(this,a,b),this.uniforms.u_normalMatrix=mat3.create(),this.scaleFactor=c||1.1,mat4.scale(this.local,this.local,[this.scaleFactor,this.scaleFactor,this.scaleFactor])};return f(b,H),b.prototype.updateView=function(a){H.prototype.updateView.call(this,a);var b=mat4.invert(mat4.create(),a),c=mat4.transpose(mat4.create(),b);this.uniforms.u_normalMatrix=mat3.fromMat4(mat3.create(),c)},b}();c.Drawables=c.Drawables||{},c.Drawables.Atmosphere=M;var N=function(){this.drawables={},this.transform=mat4.create()};N.prototype.addDrawable=function(a,b){this.drawables[a]=b},N.prototype.removeDrawable=function(){},N.prototype.applyTransform=function(){for(var a in this.drawables)this.drawables[a].setMatrix(this.transform)},N.prototype.translate=function(a){mat4.translate(this.transform,this.transform,a),this.applyTransform()},N.prototype.rotate=function(a){var b=mat4.create();mat4.fromQuat(b,a),mat4.multiply(this.transform,this.transform,b),this.applyTransform()},N.prototype.setAnimation=function(a){for(var b in this.drawables)this.drawables[b].onUpdate=a},c.Entity=N,function(){c.Entities=c.Entities||{},c.Entities.Inventory=c.Entities.Inventory||{};var a={Xmp:"L8",Ultrastrike:"L8",ResShield:"VERY_RARE",PowerCube:"L8",LinkAmp:"EXTREMELY_RARE",HeatSink:"VERY_RARE",MultiHack:"VERY_RARE",ForceAmp:"RARE",Turret:"RARE",Resonator:"L8",Capsule:"RARE"},b=function(a,b){var d=function(){N.call(this),this.addDrawable(a,new c.Drawables.Inventory[a]),this.addDrawable(a+"Xm",new c.Drawables.Inventory[a+"Xm"]),this.drawables[a].uniforms.u_color0=vec4.clone(b)};return f(d,N),d};for(var d in a)c.Entities.Inventory[d]=b(d,c.Constants.qualityColors[a[d]]);var e=function(){N.call(this),this.addDrawable("FlipCardAda",new c.Drawables.Inventory.FlipCardAda),this.addDrawable("FlipCardXm",new c.Drawables.Inventory.FlipCardXm),this.drawables.FlipCardXm.uniforms.u_teamColor=vec4.clone(c.Constants.teamColors.RESISTANCE),this.drawables.FlipCardAda.uniforms.u_color1=vec4.clone(c.Constants.teamColors.RESISTANCE),this.drawables.FlipCardAda.uniforms.u_color0=vec4.clone(c.Constants.qualityColors.VERY_RARE)};f(e,N),c.Entities.Inventory.FlipCardAda=e;var g=function(){N.call(this),this.addDrawable("FlipCardJarvis",new c.Drawables.Inventory.FlipCardJarvis),this.addDrawable("FlipCardXm",new c.Drawables.Inventory.FlipCardXm),this.drawables.FlipCardXm.uniforms.u_teamColor=vec4.clone(c.Constants.teamColors.ENLIGHTENED),this.drawables.FlipCardJarvis.uniforms.u_color1=vec4.clone(c.Constants.teamColors.ENLIGHTENED),this.drawables.FlipCardJarvis.uniforms.u_color0=vec4.clone(c.Constants.qualityColors.VERY_RARE)};f(g,N),c.Entities.Inventory.FlipCardJarvis=g;var h=function(){N.call(this),this.addDrawable("ExtraShield",new c.Drawables.Inventory.ExtraShield),this.addDrawable("ResShieldXm",new c.Drawables.Inventory.ResShieldXm),this.drawables.ExtraShield.uniforms.u_color0=vec4.clone(c.Constants.qualityColors.VERY_RARE)};f(h,N),c.Entities.Inventory.ExtraShield=h}();var O=function(){N.call(this),this.color=vec4.clone(c.Constants.teamColors.LOKI),this.addDrawable("Portal",new c.Drawables.World.Portal),this.drawables.Portal.onUpdate=function(a,b){var c=b/1e3;return this.uniforms.u_baseColor[0]=Math.sin(c),this.uniforms.u_baseColor[1]=Math.sin(c+2*Math.PI/3),this.uniforms.u_baseColor[2]=Math.sin(c+4*Math.PI/3),!0}};f(O,N),O.prototype.setColor=function(a){this.color=vec4.clone(a),this.drawables.Portal&&(this.drawables.Portal.onUpdate=b,this.drawables.Portal.uniforms.u_baseColor=this.color),this.drawables.Shield&&(this.drawables.Shield.uniforms.u_color=this.color),this.drawables.ArtifactsGreenGlow&&(this.drawables.ArtifactsGreenGlow.u_baseColor=this.color)},O.prototype.addShield=function(){"Shield"in this.drawables||this.addDrawable("Shield",new c.Drawables.World.Shield),this.drawables.Shield.uniforms.u_color=this.color,this.applyTransform()},O.prototype.addArtifact=function(a,b,d){var e=function(a){return mat4.rotateY(this.model,this.model,a/1e3),this.updateMatrix(),!0},f=a+(d?"Frozen":"")+b;f in this.drawables||this.addDrawable(f,new c.Drawables.Artifact[a][f]),this.drawables[f].onUpdate=e,this.applyTransform()},O.prototype.addGlowMarker=function(a,b){var d="Artifacts"+a+"Glow";d in this.drawables||this.addDrawable(d,new c.Drawables.World[d]),this.drawables[d].uniforms.u_baseColor=vec4.clone(b)},c.Entities=c.Entities||{},c.Entities.World=c.Entities.World||{},c.Entities.World.Portal=O;var P=function(){var a=function(a,b){return 0===b&&a++,a},b=function(a,b){return b>0&&a++,a},e=function(a,b){return 0>b&&a++,a},g=function(c){return{total:c.length,loading:c.reduce(a,0),loaded:c.reduce(b,0),error:c.reduce(e,0)}},h=function(a,b){k.call(this,a),this.manifest=b,this.loader=new j,this.textures={},this.meshes={},this.programs={},this.queues={texture:[],mesh:[],program:[]},this.stats={texture:{},mesh:{},program:{},rawProgram:{}},this.complete=null,this.path="/assets/"};f(h,k);var i=function(){var a=this.getStatus();this.complete&&0===a.texture.loading&&0===a.mesh.loading&&0===a.program.loading&&this.complete()};return h.prototype.addTexture=function(a,b){this.textures[a]=b},h.prototype.addMesh=function(a,b){this.meshes[a]=b},h.prototype.addProgram=function(a,b){this.programs[a]=b},h.prototype.handleTexture=function(a,b,c,e,f){if(e)throw this.queues.texture[a]=-1,d.error(e),"Could not load "+b;this.addTexture(b,new o(this._gl,c,f)),this.queues.texture[a]=1,d.info("loaded texture "+b),i.call(this)},h.prototype.handleMesh=function(a,b,c,e,f){if(e)throw this.queues.mesh[a]=-1,d.error(e),"Could not load "+b;this.addMesh(b,new r(this._gl,f)),this.queues.mesh[a]=1,d.info("loaded mesh "+b),i.call(this)},h.prototype.createProgram=function(a,b){var e=v;b.program in c.Programs&&(e=c.Programs[b.program]),this.addProgram(a,new e(this._gl,b.vertex,b.fragment)),d.log("created program "+a)},h.prototype.handleProgram=function(a,b,e,f,g){if(f)throw this.queues.program[a]=-1,d.error(f),"Could not load "+b;var h=v;e.program in c.Programs&&(h=c.Programs[e.program]),this.addProgram(b,new h(this._gl,g[0],g[1])),this.queues.program[a]=1,d.info("loaded program "+b),i.call(this)},h.prototype.getTexture=function(a){var b=this.textures[a];return b&&(this.stats.texture[a]=(this.stats.texture[a]||0)+1),b},h.prototype.getMesh=function(a){var b=this.meshes[a];return b&&(this.stats.mesh[a]=(this.stats.mesh[a]||0)+1),b},h.prototype.getProgram=function(a){var b=this.programs[a];return b&&(this.stats.rawProgram.hasOwnProperty(a)?this.stats.rawProgram[a]++:this.stats.program[a]=(this.stats.program[a]||0)+1),b},h.prototype.loadAll=function(a){var b,c,d=this.manifest;this.complete=a;for(b in d.texture)!d.texture.hasOwnProperty(b)||b in this.textures||(this.textures[b]=null,c=d.texture[b],this.loader.loadAsset((c["static"]?"":this.path)+c.path,"image",this.handleTexture.bind(this,this.queues.texture.length,b,c)),this.queues.texture.push(0));for(b in d.mesh)!d.mesh.hasOwnProperty(b)||b in this.meshes||(this.meshes[b]=null,c=d.mesh[b],this.loader.loadAsset((c["static"]?"":this.path)+c.path,"arraybuffer",this.handleMesh.bind(this,this.queues.mesh.length,b,c)),this.queues.mesh.push(0));for(b in d.program)!d.program.hasOwnProperty(b)||b in this.programs||(this.programs[b]=null,c=d.program[b],this.loader.loadAssetGroup([(c["static"]?"":this.path)+c.vertex,(c["static"]?"":this.path)+c.fragment],["text","text"],this.handleProgram.bind(this,this.queues.program.length,b,c)),this.queues.program.push(0));for(b in d.rawProgram)!d.rawProgram.hasOwnProperty(b)||b in this.programs||(this.stats.rawProgram[b]=0,this.createProgram(b,d.rawProgram[b]));return this.getStatus.bind(this)},h.prototype.getStatus=function(){return{texture:g(this.queues.texture),mesh:g(this.queues.mesh),program:g(this.queues.program)}},h.prototype.generateManifest=function(){var a={},b=["texture","mesh","rawProgram","program"];return b.forEach(function(b){a[b]={};for(var c in this.stats[b])this.stats[b].hasOwnProperty(c)&&this.stats[b][c]>0&&(a[b][c]=this.manifest[b][c])}.bind(this)),a},h}();c.AssetManager=P;var Q=function(a,b){k.call(this,a),this.manager=b,this.viewProject=mat4.create(),this.view=mat4.create(),this.project=mat4.create(),this.elapsed=0};f(Q,k),Q.prototype.updateView=function(a,b){this.view=a,this.project=b,mat4.multiply(this.viewProject,b,a)},Q.prototype.render=function(){d.warn("base class renders nothing.")},Q.prototype.updateTime=function(a){this.elapsed+=a},c.Renderer=Q;var R=function(a,b){Q.call(this,a,b),this.drawables=[]};f(R,Q),R.prototype.addDrawable=function(a){if(!a instanceof y)throw"Drawables must always inherit from the base Drawable";return a.init(this.manager)?(a.updateView&&a.updateView(this.viewProject,this.view,this.project),void this.drawables.push(a)):(d.warn("could not initialize drawable: ",a),!1)},R.prototype.removeDrawable=function(a){for(var b=0;b<this.drawables.length;b++)if(this.drawables[b]===a)return void this.drawables.splice(b,1)},R.prototype.addEntity=function(a){for(var b in a.drawables)this.addDrawable(a.drawables[b])},R.prototype.updateView=function(a,b){Q.prototype.updateView.call(this,a,b);var c,d=this.drawables.length;for(c=0;d>c;c++)this.drawables[c].updateView&&this.drawables[c].updateView(this.viewProject,a,b)},R.prototype.render=function(){var a,b=this.drawables.length;for(a=0;b>a;a++)this.drawables[a].draw()},R.prototype.updateTime=function(a){Q.prototype.updateTime.call(this,a);var b,c=this.drawables.length;for(b=0;c>b;b++)this.drawables[b].updateTime(a)||(this.drawables.splice(b,1),b--,c--)},c.Renderers=c.Renderers||{},c.Renderers.Object=R;var S=function(a,b){Q.call(this,a,b),this.portals=[],this.links=null,this.particles=null};f(S,Q),S.prototype.updateView=function(a,b){Q.prototype.updateView.call(this,a,b);var c,d=this.portals.length;for(c=0;d>c;c++)this.portals[c].updateView(this.viewProject,a,b)},S.prototype.render=function(){var a,b=this.portals.length;for(a=0;b>a;a++)this.portals[a].draw()},S.prototype.updateTime=function(a){Q.prototype.updateTime.call(this,a);var b,c=this.portals.length;for(b=0;c>b;b++)this.portals[b].updateTime(a)||(this.portals.splice(b,1),b--,c--)},c.Renderers=c.Renderers||{},c.Renderers.Portal=S;var T=function(){var a=Math.PI/2,b=5,c=function(a){return{identifier:a.identifier,x:a.clientX,y:a.clientY}},e=function(a,b){for(var c=0;c<a.length;c++)if(a[c].identifier==b.identifier)return c;return-1},f=function(a,b,c){c=c||{},this.canvas=a,this.distance=b||2,this.distanceTarget=this.distance;var d={zoomDamp:.5,distanceScale:.5,distanceMax:1e3,distanceMin:1,touchScale:.1,wheelScale:.01,friction:.2,target:vec3.create(),allowZoom:!0};this.options=h(d,c),this.mouse={x:0,y:0},this.mouseOnDown={x:0,y:0},this.rotation={x:0,y:0},this.target={x:3*Math.PI/2,y:Math.PI/6},this.targetOnDown={x:0,y:0},this.overRenderer=!1,this.mouseMove=this.onMouseMove.bind(this),this.mouseUp=this.onMouseUp.bind(this),this.mouseOut=this.onMouseOut.bind(this),this.mouseDown=this.onMouseDown.bind(this),this.mouseWheel=this.onMouseWheel.bind(this),this.touches=[],this.touchDelta=0,this.touchMove=this.onTouchMove.bind(this),this.touchEnd=this.onTouchEnd.bind(this),this.touchLeave=this.onTouchLeave.bind(this),this.touchStart=this.onTouchStart.bind(this),this.mouseOver=function(){this.overRenderer=!0}.bind(this),this.mouseOut=function(){this.overRenderer=!1}.bind(this),this.enabled=!1};return f.prototype.disable=function(){this.canvas.removeEventListener("mousedown",this.mouseDown,!1),this.canvas.removeEventListener("mousemove",this.mouseMove,!1),this.canvas.removeEventListener("mouseup",this.mouseUp,!1),this.canvas.removeEventListener("mouseout",this.mouseOut,!1),this.canvas.removeEventListener("touchstart",this.touchStart,!1),this.canvas.removeEventListener("touchmove",this.touchMove,!1),this.canvas.removeEventListener("touchend",this.touchEnd,!1),this.canvas.removeEventListener("touchleave",this.touchLeave,!1),this.canvas.removeEventListener("mousewheel",this.mouseWheel,!1),this.canvas.removeEventListener("mouseover",this.mouseOver,!1),this.canvas.removeEventListener("mouseout",this.mouseOut,!1),this.enabled=!1},f.prototype.enable=function(){this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.options.allowZoom&&this.canvas.addEventListener("mousewheel",this.mouseWheel,!1),this.canvas.addEventListener("touchstart",this.touchStart,!1),this.canvas.addEventListener("mouseover",this.mouseOver,!1),this.canvas.addEventListener("mouseout",this.mouseOut,!1),this.enabled=!0},f.prototype.updateTargets=function(){var c=this.distance<b?this.distance:Math.log(this.distance),d=c/this.options.zoomDamp;this.target.x=this.targetOnDown.x+.005*(this.mouse.x-this.mouseOnDown.x)*d,this.target.y=this.targetOnDown.y+.005*(this.mouse.y-this.mouseOnDown.y)*d,this.target.y=this.target.y>a?a:this.target.y,this.target.y=this.target.y<-a?-a:this.target.y},f.prototype.onMouseDown=function(a){a.preventDefault(),this.canvas.addEventListener("mousemove",this.mouseMove,!1),this.canvas.addEventListener("mouseup",this.mouseUp,!1),this.canvas.addEventListener("mouseout",this.mouseOut,!1),this.mouseOnDown.x=-a.clientX,this.mouseOnDown.y=a.clientY,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y,this.canvas.style.cursor="move"},f.prototype.onMouseMove=function(a){this.mouse.x=-a.clientX,this.mouse.y=a.clientY,this.updateTargets()},f.prototype.onMouseUp=function(a){this.onMouseOut(a),this.canvas.style.cursor="auto"},f.prototype.onMouseOut=function(){this.canvas.removeEventListener("mousemove",this.mouseMove,!1),this.canvas.removeEventListener("mouseup",this.mouseUp,!1),this.canvas.removeEventListener("mouseout",this.mouseOut,!1)},f.prototype.updateView=function(a){var b=this.target.x-this.rotation.x,c=this.target.y-this.rotation.y,d=this.distanceTarget-this.distance,e=vec3.create();(Math.abs(b)>1e-5||Math.abs(c)>1e-5||Math.abs(d)>1e-5)&&(this.rotation.x+=b*this.options.friction,this.rotation.y+=c*this.options.friction,this.distance+=d*this.options.distanceScale,e[0]=this.distance*Math.sin(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target[0],e[1]=this.distance*Math.sin(this.rotation.y)+this.options.target[1],e[2]=this.distance*Math.cos(this.rotation.x)*Math.cos(this.rotation.y)+this.options.target[2],mat4.lookAt(a,e,this.options.target,[0,1,0]))},f.prototype.onMouseWheel=function(a){return a.preventDefault(),this.overRenderer&&this.zoom(a.wheelDeltaY*this.options.wheelScale*(this.distance<b?this.distance:Math.log(this.distance))),!1},f.prototype.onTouchStart=function(a){a.preventDefault(),0===this.touches.length&&(this.canvas.addEventListener("touchmove",this.touchMove,!1),this.canvas.addEventListener("touchend",this.touchEnd,!1),this.canvas.addEventListener("touchleave",this.touchLeave,!1));for(var b=0;b<a.changedTouches.length;b++)this.touches.push(c(a.changedTouches[b]));if(1===this.touches.length)this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y;else if(2===this.touches.length&&this.options.allowZoom){var d=Math.abs(this.touches[0].x-this.touches[1].x),e=Math.abs(this.touches[0].y-this.touches[1].y);this.touchDelta=Math.sqrt(d*d+e*e)}this.canvas.style.cursor="move"},f.prototype.onTouchMove=function(a){for(var b=a.changedTouches,f=b.length,g=0;f>g;g++){var h=e(this.touches,b[g]);h>=0?this.touches.splice(h,1,c(b[g])):d.log("could not find event ",b[g])}if(1===this.touches.length)this.mouse.x=-this.touches[0].x,this.mouse.y=this.touches[0].y,this.updateTargets();else if(2===this.touches.length&&this.options.allowZoom){var i=this.touches[0].x-this.touches[1].x,j=this.touches[0].y-this.touches[1].y,k=Math.sqrt(i*i+j*j);this.zoom((k-this.touchDelta)*this.options.touchScale),this.touchDelta=k}},f.prototype.removeTouches=function(a){for(var b=a.changedTouches,c=b.length,d=0;c>d;d++){var f=e(this.touches,b[d]);f>=0&&this.touches.splice(f,1)}0===this.touches.length?(this.canvas.removeEventListener("touchmove",this.touchMove,!1),this.canvas.removeEventListener("touchend",this.touchEnd,!1),this.canvas.removeEventListener("touchleave",this.touchLeave,!1)):1===this.touches.length&&(this.mouseOnDown.x=-this.touches[0].x,this.mouseOnDown.y=this.touches[0].y,this.targetOnDown.x=this.target.x,this.targetOnDown.y=this.target.y)},f.prototype.onTouchEnd=function(a){this.removeTouches(a),this.canvas.style.cursor="auto"},f.prototype.onTouchLeave=function(a){this.removeTouches(a)},f.prototype.onTouchCancel=function(a){this.removeTouches(a)},f.prototype.zoom=function(a){this.distanceTarget-=a,this.distanceTarget=Math.min(this.distanceTarget,this.options.distanceMax),this.distanceTarget=Math.max(this.distanceTarget,this.options.distanceMin)},f}();c.Controls=c.Controls||{},c.Controls.Orbit=T;var U=function(a,b,c){this.canvas=a;var d={};c&&(d.preserveDrawingBuffer=!0);var e=a.getContext("webgl",d)||a.getContext("experimental-webgl",d);if(!e)throw"Could not initialize webgl";e.clearColor(0,0,0,1),this.gl=e,this.view=mat4.create(),mat4.lookAt(this.view,[0,20,25],[0,10,0],[0,1,0]),this.hFoV=Math.PI/4,this.far=100,this.project=mat4.create(),this.assetManager=new P(this.gl,b),this.objectRenderer=new R(this.gl,this.assetManager),this.resize(a.width,a.height),this.start=this.last=null,this.paused=!1,this.cleared=!1,this.frame=null};U.prototype.resize=function(a,b){this.canvas.width=a,this.canvas.height=b,this.gl.viewport(0,0,a,b),this.updateView()},U.prototype.updateView=function(){this.project=mat4.create(),mat4.perspective(this.project,this.hFoV,this.canvas.width/this.canvas.height,.1,this.far),this.objectRenderer.updateView(this.view,this.project)},U.prototype.stop=function(){this.paused=!0,this.cleared=!1,this.frame&&window.cancelAnimationFrame(this.frame)},U.prototype.demoEntities=function(){var a,b,e=-5,f=0,g=4;for(a in c.Entities.Inventory)b=new c.Entities.Inventory[a],b&&(b.translate(vec3.fromValues(e,f,g)),e++,e>5&&(e=-5,g--),this.objectRenderer.addEntity(b),d.log("added "+a));var h=new c.Entities.World.Portal;h.translate(vec3.fromValues(e,f,g)),this.objectRenderer.addEntity(h)},U.prototype.demo=function(){var a,b,e,f=-5,g=0,h=4;for(a in c.Drawables.Inventory)e=new c.Drawables.Inventory[a],e&&(mat4.translate(e.world,e.world,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a));for(a in c.Drawables.Resource)e=new c.Drawables.Resource[a],e&&(mat4.translate(e.world,e.world,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a));for(a in c.Drawables.World)e=new c.Drawables.World[a],e&&(mat4.translate(e.world,e.world,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a));for(a in c.Drawables.Artifact)for(b in c.Drawables.Artifact[a])e=new c.Drawables.Artifact[a][b],e&&(mat4.translate(e.world,e.world,vec3.fromValues(f,g,h)),f++,f>5&&(f=-5,h--),this.objectRenderer.addDrawable(e),d.log("added "+a+": "+b))},U.prototype.draw=function(a){var b=this.gl;b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),g(b),this.objectRenderer.render(),this.objectRenderer.updateTime(a)},U.prototype.render=function(a){if(this.paused)return this.cleared=!0,void(this.paused=!1);var b=0;this.start?(b=a-this.last,this.last=a):(this.start=a,this.last=a),this.draw(b),this.frame=window.requestAnimationFrame(this.render.bind(this))},U.prototype.preload=function(a){this.assetManager.loadAll(a)},c.Engine=U,c.VERSION="0.14.0",a.IMV=c}(this);
//# sourceMappingURL=ingress-model-viewer.min.js.map